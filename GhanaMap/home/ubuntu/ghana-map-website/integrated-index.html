<!DOCTYPE html>
<html>

<head>
    <title>PowerGridX - Integrated Platform</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PowerGridX - Smart Infrastructure for Africa's Power Grid">

    <!-- Favicon -->
    <link rel="icon" href="favicon/favicon.ico" sizes="32x32">
    <link rel="icon" href="favicon/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="favicon/apple-touch-icon.png">
    <link rel="manifest" href="favicon/site.webmanifest">

    <!-- amCharts -->
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Dark.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/geodata/ghanaLow.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    <!-- Flaticon CSS -->
    <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css">
    <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/uicons-solid-rounded/css/uicons-solid-rounded.css">

    <style>
        /* Clean View Isolation System */
        .main-content {
            position: relative;
            width: 100%;
            height: calc(100vh - 72px);
            overflow: hidden;
            background: #f8f9fa;
        }

        /* Base view container - hidden by default */
        .view-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffffff;
            z-index: 1;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            display: none;
        }

        /* Only active view is visible */
        .view-container.active {
            display: block;
            opacity: 1;
            visibility: visible;
            z-index: 10;
        }

        /* Ensure complete isolation */
        .view-container:not(.active) {
            display: none;
            opacity: 0;
            visibility: hidden;
            z-index: -1;
        }

        /* Ensure all elements don't float outside their container */
        .dispatch-container,
        .dispatch-header,
        .dispatch-content,
        .dispatch-stats,
        .dispatch-filters,
        .dispatch-requests,
        .audit-container,
        .audit-header,
        .audit-content,
        .transformers-container,
        .transformers-header,
        .transformers-content,
        #chartdiv,
        #sidebar {
            position: relative !important;
            z-index: inherit !important;
        }

        /* Specific isolation for Ghana map */
        #grid-view:not(.active) #chartdiv,
        #grid-view:not(.active) #sidebar {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }

        /* Ensure each view takes full space independently */
        .view-container.full-screen {
            width: 100%;
            height: 100%;
        }

        /* Enhanced hover effects for map regions */
        #chartdiv {
            position: relative;
            overflow: visible;
        }

        .floating-region-label {
            animation: fadeInScale 0.2s ease-out;
            transition: all 0.2s ease;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: translate(-50%, -100%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -100%) scale(1);
            }
        }

        /* Enhanced tooltip styles */
        .am5-tooltip {
            border-radius: 8px !important;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3) !important;
        }

        /* Map region hover effects */
        .am5-map-polygon {
            transition: all 0.2s ease !important;
        }

        .am5-map-polygon:hover {
            filter: brightness(1.1) !important;
        }

        /* Enhanced transformer card styles */
        .transformer-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .transformer-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .transformer-card.active {
            border-left: 4px solid #4CAF50;
        }

        .transformer-card.maintenance {
            border-left: 4px solid #FF9800;
        }

        .transformer-card.fault {
            border-left: 4px solid #F44336;
        }

        .transformer-header-card {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .transformer-icon-custom {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #F97316, #FF6B35);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .transformer-info {
            flex: 1;
        }

        .transformer-info h4 {
            margin: 0 0 5px 0;
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }

        .transformer-info p {
            margin: 0 0 8px 0;
            color: #666;
            font-size: 14px;
        }

        .category-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .category-badge.urban {
            background: #E3F2FD;
            color: #1976D2;
        }

        .category-badge.peri-urban {
            background: #F3E5F5;
            color: #7B1FA2;
        }

        .category-badge.rural {
            background: #E8F5E8;
            color: #388E3C;
        }

        .transformer-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .transformer-status.active {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .transformer-status.maintenance {
            background: #FFF3E0;
            color: #E65100;
        }

        .transformer-status.fault {
            background: #FFEBEE;
            color: #C62828;
        }

        .transformer-details {
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-row span:first-child {
            color: #666;
            font-weight: 500;
        }

        .detail-row span:last-child {
            color: #333;
            font-weight: 600;
        }

        .transformer-meters-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .meters-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .meter-stat {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }

        .meter-number {
            font-size: 20px;
            font-weight: bold;
            color: #F97316;
            margin-bottom: 4px;
        }

        .meter-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        .transformer-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            min-width: 120px;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background: #f0f0f0;
            color: #333;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .action-btn:hover {
            background: #F97316;
            color: white;
            transform: translateY(-1px);
        }

        .transformers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .full-screen-content {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            box-sizing: border-box;
        }

        /* Reset any inherited styles */
        .view-container * {
            box-sizing: border-box;
        }

        /* Specific view isolation */
        #dashboard-view {
            background: #ffffff;
        }

        #grid-view {
            background: #222222;
            display: flex;
        }

        #grid-view #chartdiv {
            width: 70%;
            height: 100%;
            position: relative;
            z-index: 1;
        }

        #grid-view #sidebar {
            width: 30%;
            height: 100%;
            background-color: #1a1a1a;
            color: white;
            padding: 0;
            box-sizing: border-box;
            overflow-y: auto;
            border-left: 2px solid #333;
            position: relative;
            z-index: 1;
        }

        /* Info Card Styles */
        .info-card {
            background: #1a1a1a;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .card-header {
            border-bottom: 1px solid #333;
            margin-bottom: 0;
        }

        .stat-item {
            text-align: center;
            padding: 8px;
            background: #2a2a2a;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .stat-item:hover {
            background: #333;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 20px 0;
        }

        .instruction-box {
            background: #2a2a2a;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #F97316;
            margin-top: 20px;
        }

        .recent-activity {
            margin-top: 20px;
        }

        .activity-item {
            margin: 8px 0;
            padding: 8px;
            background: #2a2a2a;
            border-radius: 4px;
            font-size: 12px;
            color: #999;
            line-height: 1.6;
        }

        /* Live Dashboard Animations */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        /* Interactive Card Styles */
        .dashboard-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .dashboard-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .live-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4CAF50;
            border-radius: 50%;
            animation: pulse 2s infinite;
            margin-right: 8px;
        }

        /* Modal Styles for Interactive Popups */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: #1a1a1a;
            color: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #333;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }

        .modal-close {
            background: #333;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .modal-close:hover {
            background: #555;
        }

        .live-data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .live-data-table th,
        .live-data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #333;
        }

        .live-data-table th {
            background: #2a2a2a;
            color: #F97316;
            font-weight: bold;
        }

        .status-indicator-table {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #4CAF50;
        }

        .status-warning {
            background: #FF9800;
        }

        .status-offline {
            background: #F44336;
        }

        #transformers-view,
        #audit-view,
        #dispatch-view {
            background: #f8f9fa;
        }

        /* Ensure no content bleeds between views */
        .view-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: inherit;
            z-index: -1;
        }

        .iframe-container {
            width: 100%;
            height: calc(100vh - 72px);
            border: none;
            background: #f5f5f5;
        }

        .loading-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #666;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #F97316;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* NUCLEAR VIEW ISOLATION - Override everything */
        .view-container {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            background: #ffffff !important;
            overflow: hidden !important;
        }

        .view-container:not(.active) {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
            z-index: -1000 !important;
            pointer-events: none !important;
        }

        .view-container:not(.active) * {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none !important;
        }

        .view-container.active {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
            z-index: 1000 !important;
            pointer-events: auto !important;
        }

        /* Ensure map elements are completely isolated */
        #chartdiv,
        #sidebar {
            position: relative !important;
        }

        /* Force hide elements when not in their proper view */
        body:not([data-current-view="grid"]) #chartdiv,
        body:not([data-current-view="grid"]) #sidebar {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
            z-index: -1000 !important;
        }

        /* Force sidebar to be visible when in grid view */
        body[data-current-view="grid"] #sidebar {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
            z-index: 1000 !important;
            width: 30% !important;
            height: 100% !important;
            background-color: #1a1a1a !important;
            color: white !important;
        }

        /* Ensure grid view container is flex */
        body[data-current-view="grid"] #grid-view {
            display: flex !important;
        }

        body:not([data-current-view="dispatch"]) .dispatch-container,
        body:not([data-current-view="dispatch"]) .dispatch-header,
        body:not([data-current-view="dispatch"]) .dispatch-content {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
        }

        body:not([data-current-view="audit"]) .audit-container,
        body:not([data-current-view="audit"]) .audit-header,
        body:not([data-current-view="audit"]) .audit-content {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
        }

        body:not([data-current-view="transformers"]) .transformers-container,
        body:not([data-current-view="transformers"]) .transformers-header,
        body:not([data-current-view="transformers"]) .transformers-content {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
        }

        /* Enhanced Navigation */
        .nav-btn {
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        /* Status Indicators */
        .status-indicator {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10B981;
            border: 2px solid #ffffff;
        }

        .status-indicator.loading {
            background: #F59E0B;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        /* Audit Log Styles */
        .audit-container {
            padding: 24px;
            height: 100%;
            overflow-y: auto;
            background: #f8f9fa;
            position: relative;
            z-index: 1;
            width: 100%;
            box-sizing: border-box;
        }

        .audit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .audit-header h2 {
            margin: 0;
            color: #1f2937;
        }

        .audit-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .audit-select,
        .audit-date {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            font-size: 14px;
        }

        .audit-btn {
            padding: 8px 16px;
            background: #F97316;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .audit-btn:hover {
            background: #ea580c;
        }

        .audit-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #F97316;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: #6b7280;
            font-weight: 500;
        }

        .audit-log {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .log-entry {
            padding: 16px 20px;
            border-bottom: 1px solid #e5e7eb;
            display: grid;
            grid-template-columns: 140px 100px 1fr 200px 150px;
            gap: 16px;
            align-items: center;
            font-size: 14px;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-entry.critical {
            border-left: 4px solid #ef4444;
            background: #fef2f2;
        }

        .log-entry.maintenance {
            border-left: 4px solid #10b981;
            background: #f0fdf4;
        }

        .log-entry.installation {
            border-left: 4px solid #3b82f6;
            background: #eff6ff;
        }

        .log-entry.fault {
            border-left: 4px solid #f59e0b;
            background: #fffbeb;
        }

        .log-time {
            font-family: monospace;
            color: #6b7280;
            font-size: 12px;
        }

        .log-type {
            font-weight: bold;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            text-align: center;
        }

        .log-entry.critical .log-type {
            background: #ef4444;
            color: white;
        }

        .log-entry.maintenance .log-type {
            background: #10b981;
            color: white;
        }

        .log-entry.installation .log-type {
            background: #3b82f6;
            color: white;
        }

        .log-entry.fault .log-type {
            background: #f59e0b;
            color: white;
        }

        .log-message {
            font-weight: 500;
            color: #1f2937;
        }

        .log-location {
            color: #6b7280;
            font-size: 12px;
        }

        .log-user {
            color: #6b7280;
            font-size: 12px;
        }

        /* Dispatch Request Styles */
        .dispatch-container {
            padding: 24px;
            height: 100%;
            overflow-y: auto;
            background: #f8f9fa;
            position: relative;
            z-index: 1;
            width: 100%;
            box-sizing: border-box;
        }

        .dispatch-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .dispatch-header h2 {
            margin: 0;
            color: #1f2937;
        }

        .dispatch-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .dispatch-btn.primary {
            background: #F97316;
            color: white;
        }

        .dispatch-btn.primary:hover {
            background: #ea580c;
        }

        .dispatch-btn.secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .dispatch-btn.secondary:hover {
            background: #d1d5db;
        }

        .dispatch-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card.pending .stat-number {
            color: #f59e0b;
        }

        .stat-card.active .stat-number {
            color: #3b82f6;
        }

        .stat-card.completed .stat-number {
            color: #10b981;
        }

        .stat-card.contractors .stat-number {
            color: #8b5cf6;
        }

        .dispatch-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .dispatch-select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            flex: 1;
        }

        .dispatch-requests {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .dispatch-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .dispatch-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .dispatch-card.urgent {
            border-left: 4px solid #ef4444;
        }

        .dispatch-card.normal {
            border-left: 4px solid #3b82f6;
        }

        .dispatch-card.low {
            border-left: 4px solid #10b981;
        }

        .dispatch-header-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }

        .dispatch-id {
            font-family: monospace;
            font-weight: bold;
            color: #374151;
        }

        .dispatch-priority,
        .dispatch-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .dispatch-priority.urgent {
            background: #fef2f2;
            color: #dc2626;
        }

        .dispatch-priority.normal {
            background: #eff6ff;
            color: #2563eb;
        }

        .dispatch-priority.low {
            background: #f0fdf4;
            color: #16a34a;
        }

        .dispatch-status.pending {
            background: #fffbeb;
            color: #d97706;
        }

        .dispatch-status.assigned {
            background: #eff6ff;
            color: #2563eb;
        }

        .dispatch-status.in-progress {
            background: #f0f9ff;
            color: #0284c7;
        }

        .dispatch-details {
            padding: 20px;
        }

        .dispatch-details h4 {
            margin: 0 0 12px 0;
            color: #1f2937;
            font-size: 18px;
        }

        .dispatch-location {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #6b7280;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .dispatch-description {
            color: #374151;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .dispatch-meta {
            display: flex;
            gap: 24px;
            font-size: 12px;
            color: #6b7280;
        }

        .dispatch-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .dispatch-actions {
            padding: 16px 20px;
            background: #f9fafb;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Transformers Section Styles */
        .transformers-container {
            width: 100%;
            height: 100%;
            background: #f8f9fa;
            overflow-y: auto;
        }

        .transformers-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            background: white;
            border-bottom: 1px solid #e5e7eb;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .transformers-header h2 {
            margin: 0;
            color: #1f2937;
        }

        .transformers-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .transformers-select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            font-size: 14px;
        }

        .transformers-btn {
            padding: 10px 16px;
            background: #F97316;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .transformers-btn:hover {
            background: #ea580c;
        }

        .transformers-content {
            padding: 24px;
        }

        .transformers-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card.active .stat-number {
            color: #10b981;
        }

        .stat-card.maintenance .stat-number {
            color: #f59e0b;
        }

        .stat-card.fault .stat-number {
            color: #ef4444;
        }

        .transformers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
        }

        .transformer-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .transformer-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .transformer-card.active {
            border-left: 4px solid #10b981;
        }

        .transformer-card.maintenance {
            border-left: 4px solid #f59e0b;
        }

        .transformer-card.fault {
            border-left: 4px solid #ef4444;
        }

        .transformer-header-card {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }

        .transformer-info {
            flex: 1;
            margin-left: 16px;
        }

        .transformer-info h4 {
            margin: 0 0 4px 0;
            color: #1f2937;
            font-size: 16px;
        }

        .transformer-info p {
            margin: 0;
            color: #6b7280;
            font-size: 14px;
        }

        .transformer-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .transformer-status.active {
            background: #d1fae5;
            color: #065f46;
        }

        .transformer-status.maintenance {
            background: #fef3c7;
            color: #92400e;
        }

        .transformer-status.fault {
            background: #fee2e2;
            color: #991b1b;
        }

        .transformer-details {
            padding: 20px;
        }

        .transformer-details .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .transformer-details .detail-row span:first-child {
            color: #6b7280;
            font-weight: 500;
        }

        .transformer-details .detail-row span:last-child {
            color: #1f2937;
            font-weight: 600;
        }

        .transformer-actions {
            padding: 16px 20px;
            background: #f9fafb;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 12px;
        }

        .action-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            color: #374151;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .action-btn.urgent {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }

        .action-btn.urgent:hover {
            background: #dc2626;
        }

        /* Update audit and dispatch containers for full screen */
        .audit-container.full-screen-content {
            padding: 24px;
            height: 100%;
            background: #f8f9fa;
            overflow-y: auto;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .dispatch-container.full-screen-content {
            padding: 0;
            height: 100%;
            background: #f8f9fa;
        }

        .audit-header,
        .dispatch-header {
            position: sticky;
            top: 0;
            z-index: 10;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="pgx-header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">
                    <svg width="32" height="32" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- PowerGridX New Logo - Modern Circuit Design -->
                        <g>
                            <!-- Background circle for better visibility -->
                            <circle cx="50" cy="50" r="48" fill="#f8f9fa" stroke="#e5e7eb" stroke-width="1" />

                            <!-- Left side diagonal circuit lines -->
                            <rect x="8" y="15" width="16" height="3" rx="1.5" fill="#374151"
                                transform="rotate(-30 16 16.5)" />
                            <rect x="8" y="22" width="12" height="3" rx="1.5" fill="#374151"
                                transform="rotate(-30 14 23.5)" />
                            <rect x="8" y="29" width="14" height="3" rx="1.5" fill="#374151"
                                transform="rotate(-30 15 30.5)" />
                            <rect x="8" y="36" width="10" height="3" rx="1.5" fill="#374151"
                                transform="rotate(-30 13 37.5)" />
                            <rect x="8" y="43" width="18" height="3" rx="1.5" fill="#374151"
                                transform="rotate(-30 17 44.5)" />
                            <rect x="8" y="50" width="8" height="3" rx="1.5" fill="#374151"
                                transform="rotate(-30 12 51.5)" />
                            <rect x="8" y="57" width="16" height="3" rx="1.5" fill="#374151"
                                transform="rotate(-30 16 58.5)" />
                            <rect x="8" y="64" width="12" height="3" rx="1.5" fill="#374151"
                                transform="rotate(-30 14 65.5)" />
                            <rect x="8" y="71" width="14" height="3" rx="1.5" fill="#374151"
                                transform="rotate(-30 15 72.5)" />
                            <rect x="8" y="78" width="10" height="3" rx="1.5" fill="#374151"
                                transform="rotate(-30 13 79.5)" />

                            <!-- Right side diagonal circuit lines -->
                            <rect x="76" y="15" width="16" height="3" rx="1.5" fill="#374151"
                                transform="rotate(30 84 16.5)" />
                            <rect x="80" y="22" width="12" height="3" rx="1.5" fill="#374151"
                                transform="rotate(30 86 23.5)" />
                            <rect x="78" y="29" width="14" height="3" rx="1.5" fill="#374151"
                                transform="rotate(30 85 30.5)" />
                            <rect x="82" y="36" width="10" height="3" rx="1.5" fill="#374151"
                                transform="rotate(30 87 37.5)" />
                            <rect x="74" y="43" width="18" height="3" rx="1.5" fill="#374151"
                                transform="rotate(30 83 44.5)" />
                            <rect x="84" y="50" width="8" height="3" rx="1.5" fill="#374151"
                                transform="rotate(30 88 51.5)" />
                            <rect x="76" y="57" width="16" height="3" rx="1.5" fill="#374151"
                                transform="rotate(30 84 58.5)" />
                            <rect x="80" y="64" width="12" height="3" rx="1.5" fill="#374151"
                                transform="rotate(30 86 65.5)" />
                            <rect x="78" y="71" width="14" height="3" rx="1.5" fill="#374151"
                                transform="rotate(30 85 72.5)" />
                            <rect x="82" y="78" width="10" height="3" rx="1.5" fill="#374151"
                                transform="rotate(30 87 79.5)" />

                            <!-- Corner connection dots -->
                            <circle cx="18" cy="18" r="2" fill="#374151" />
                            <circle cx="82" cy="18" r="2" fill="#374151" />
                            <circle cx="18" cy="82" r="2" fill="#374151" />
                            <circle cx="82" cy="82" r="2" fill="#374151" />

                            <!-- Additional circuit dots -->
                            <circle cx="25" cy="35" r="1.5" fill="#374151" />
                            <circle cx="75" cy="35" r="1.5" fill="#374151" />
                            <circle cx="25" cy="65" r="1.5" fill="#374151" />
                            <circle cx="75" cy="65" r="1.5" fill="#374151" />

                            <!-- Central lightning bolt - Modern orange design -->
                            <path d="M55 20 L40 48 H48 L35 80 L65 52 H57 L70 20 H55 Z" fill="#F97316" stroke="#ffffff"
                                stroke-width="1" />

                            <!-- Lightning bolt highlight -->
                            <path d="M55 20 L40 48 H48 L35 80 L65 52 H57 L70 20 H55 Z" fill="url(#lightningGradient)" />

                            <!-- Gradient definition -->
                            <defs>
                                <linearGradient id="lightningGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#FF6B35;stop-opacity:1" />
                                    <stop offset="50%" style="stop-color:#F97316;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#EA580C;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                        </g>
                    </svg>
                </div>
                <div class="logo-text">
                    <h1>PowerGridX</h1>
                    <span>Smart Infrastructure Platform</span>
                </div>
            </div>
            <nav class="header-nav">
                <button class="nav-btn active" onclick="showView('dashboard')" id="dashboard-btn">
                    <i class="fi fi-rr-dashboard"></i>
                    Dashboard
                    <div class="status-indicator loading"></div>
                </button>
                <button class="nav-btn" onclick="showView('grid')" id="grid-btn">
                    <i class="fi fi-rr-map"></i>
                    Smart Grid Management
                    <div class="status-indicator"></div>
                </button>
                <button class="nav-btn" onclick="showView('transformers')" id="transformers-btn">
                    <i class="fi fi-rr-bolt"></i>
                    Transformers
                    <div class="status-indicator"></div>
                </button>
                <button class="nav-btn" onclick="showView('audit')" id="audit-btn">
                    <i class="fi fi-rr-document"></i>
                    Audit Log
                    <div class="status-indicator"></div>
                </button>
                <button class="nav-btn" onclick="showView('dispatch')" id="dispatch-btn">
                    <i class="fi fi-rr-truck"></i>
                    Dispatch Request
                    <div class="status-indicator"></div>
                </button>

            </nav>
        </div>
    </header>

    <!-- Main Content Views -->
    <main class="main-content">
        <!-- Dashboard View - Full Screen -->
        <div id="dashboard-view" class="view-container active full-screen">
            <div style="position: relative; height: 100%;">
                <div class="loading-overlay" id="dashboard-loading">
                    <div class="loading-spinner"></div>
                    <p>Loading PowerGridX Dashboard...</p>
                    <small>Starting React application...</small>
                </div>
                <iframe id="dashboard-iframe" class="iframe-container" src="about:blank" onload="handleDashboardLoad()"
                    style="opacity: 0;">
                </iframe>
            </div>
        </div>

        <!-- Smart Grid Management View - Full Screen -->
        <div id="grid-view" class="view-container full-screen">
            <div id="chartdiv" style="width: 70%; height: 100%;"></div>
            <div id="sidebar"
                style="width: 30%; height: 100%; background-color: #1a1a1a; color: white; padding: 0; box-sizing: border-box; overflow-y: auto; border-left: 2px solid #333;">
                <div style="padding: 20px; border-bottom: 1px solid #333;">
                    <h2 style="margin: 0; color: #F97316; font-size: 24px;">Smart Grid Management</h2>
                    <p style="margin: 8px 0 0 0; color: #ccc; font-size: 14px;">Ghana Power Infrastructure</p>
                    <button onclick="showNoSelection()"
                        style="margin-top: 10px; padding: 6px 12px; background: #F97316; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                        ðŸ”„ Initialize Navigation
                    </button>
                    <button onclick="emergencyShowSidebar()"
                        style="margin-top: 10px; margin-left: 8px; padding: 6px 12px; background: #FF0000; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                        ðŸš¨ EMERGENCY TEST
                    </button>
                </div>
                <div id="district-info" style="padding: 20px;"></div>
            </div>
        </div>

        <!-- Transformers View - Full Screen with Hierarchical Navigation -->
        <div id="transformers-view" class="view-container full-screen">
            <div class="transformers-container">
                <div class="transformers-header">
                    <h2>âš¡ Transformer Management System</h2>
                    <div class="transformers-controls">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="color: #666; font-size: 14px;">Navigate:</span>
                            <span style="color: #F97316; font-size: 14px; font-weight: 500;">Districts â†’ Places â†’ Transformers â†’ Customers</span>
                        </div>
                        <button class="transformers-btn" onclick="showTransformersOverview()">
                            <i class="fi fi-rr-refresh"></i>
                            Reset to Districts
                        </button>
                    </div>
                </div>
                <div class="transformers-content">
                    <div class="transformers-stats">
                        <div class="stat-card">
                            <div class="stat-number">156</div>
                            <div class="stat-label">Total Transformers</div>
                        </div>
                        <div class="stat-card active">
                            <div class="stat-number">142</div>
                            <div class="stat-label">Active</div>
                        </div>
                        <div class="stat-card maintenance">
                            <div class="stat-number">8</div>
                            <div class="stat-label">Maintenance</div>
                        </div>
                        <div class="stat-card fault">
                            <div class="stat-number">6</div>
                            <div class="stat-label">Faults</div>
                        </div>
                    </div>
                    <div class="transformers-grid" id="transformers-grid">
                        <!-- Interactive transformer cards will be generated here -->
                    </div>
                                <div class="detail-row">
                                    <span>Voltage:</span>
                                    <span>33/11 kV</span>
                                </div>
                                <div class="detail-row">
                                    <span>Load:</span>
                                    <span>0% (Offline)</span>
                                </div>
                                <div class="detail-row">
                                    <span>Connected Meters:</span>
                                    <span>78</span>
                                </div>
                                <div class="detail-row">
                                    <span>Monitoring Nodes:</span>
                                    <span>18</span>
                                </div>
                            </div>
                            <div class="transformer-actions">
                                <button class="action-btn" onclick="viewTransformerDetails('TR-KMA-001')">View
                                    Details</button>
                                <button class="action-btn" onclick="contactMaintenance('TR-KMA-001')">Contact
                                    Maintenance</button>
                            </div>
                        </div>

                        <div class="transformer-card fault">
                            <div class="transformer-header-card">
                                <div class="transformer-icon-custom"></div>
                                <div class="transformer-info">
                                    <h4>TR-STM-001</h4>
                                    <p>Takoradi Port Transformer</p>
                                </div>
                                <div class="transformer-status fault">FAULT</div>
                            </div>
                            <div class="transformer-details">
                                <div class="detail-row">
                                    <span>Location:</span>
                                    <span>Takoradi Port Area, Western</span>
                                </div>
                                <div class="detail-row">
                                    <span>Capacity:</span>
                                    <span>2000 kVA</span>
                                </div>
                                <div class="detail-row">
                                    <span>Voltage:</span>
                                    <span>161/33 kV</span>
                                </div>
                                <div class="detail-row">
                                    <span>Load:</span>
                                    <span>0% (Fault)</span>
                                </div>
                                <div class="detail-row">
                                    <span>Connected Meters:</span>
                                    <span>95</span>
                                </div>
                                <div class="detail-row">
                                    <span>Fault Type:</span>
                                    <span>Overload Protection</span>
                                </div>
                            </div>
                            <div class="transformer-actions">
                                <button class="action-btn urgent" onclick="dispatchRepair('TR-STM-001')">Dispatch
                                    Repair</button>
                                <button class="action-btn" onclick="viewFaultDetails('TR-STM-001')">Fault
                                    Details</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audit Log View - Full Screen -->
        <div id="audit-view" class="view-container full-screen">
            <div class="audit-container full-screen-content">
                <div class="audit-header">
                    <h2>Audit Log</h2>
                    <div class="audit-controls">
                        <select id="audit-filter" class="audit-select">
                            <option value="all">All Activities</option>
                            <option value="installation">Installations</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="fault">Fault Reports</option>
                            <option value="tampering">Tampering Detected</option>
                        </select>
                        <input type="date" id="audit-date" class="audit-date">
                        <button class="audit-btn" onclick="exportAuditLog()">Export</button>
                    </div>
                </div>
                <div class="audit-content"></div>
                <div class="audit-stats">
                    <div class="stat-card">
                        <div class="stat-number">1,247</div>
                        <div class="stat-label">Total Activities</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">23</div>
                        <div class="stat-label">Critical Events</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">156</div>
                        <div class="stat-label">Maintenance Tasks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">89</div>
                        <div class="stat-label">Installations</div>
                    </div>
                </div>
                <div class="audit-log">
                    <div class="log-entry critical" style="cursor: pointer; transition: all 0.3s ease;"
                        onmouseover="this.style.backgroundColor='#fef2f2'; this.style.transform='translateX(4px)'"
                        onmouseout="this.style.backgroundColor=''; this.style.transform='translateX(0)'"
                        onclick="showLogDetails('LOG-001', 'critical')">
                        <div class="log-time">2024-01-31 14:23:15</div>
                        <div class="log-type">CRITICAL</div>
                        <div class="log-message">Tampering detected at TR-ACC-001 (Osu Primary Transformer)</div>
                        <div class="log-location">Greater Accra â†’ Accra Metropolitan â†’ Osu Zone</div>
                        <div class="log-user">System Alert</div>
                    </div>
                    <div class="log-entry maintenance" style="cursor: pointer; transition: all 0.3s ease;"
                        onmouseover="this.style.backgroundColor='#f0fdf4'; this.style.transform='translateX(4px)'"
                        onmouseout="this.style.backgroundColor=''; this.style.transform='translateX(0)'"
                        onclick="showLogDetails('LOG-002', 'maintenance')">
                        <div class="log-time">2024-01-31 13:45:32</div>
                        <div class="log-type">MAINTENANCE</div>
                        <div class="log-message">Scheduled maintenance completed on TR-KMA-001</div>
                        <div class="log-location">Ashanti â†’ Kumasi Metropolitan â†’ Kumasi Central Zone</div>
                        <div class="log-user">Contractor: John Mensah</div>
                    </div>
                    <div class="log-entry installation" style="cursor: pointer; transition: all 0.3s ease;"
                        onmouseover="this.style.backgroundColor='#eff6ff'; this.style.transform='translateX(4px)'"
                        onmouseout="this.style.backgroundColor=''; this.style.transform='translateX(0)'"
                        onclick="showLogDetails('LOG-003', 'installation')">
                        <div class="log-time">2024-01-31 11:20:18</div>
                        <div class="log-type">INSTALLATION</div>
                        <div class="log-message">New smart meter installed at Labadi Beach Area</div>
                        <div class="log-location">Greater Accra â†’ Accra Metropolitan â†’ Osu Zone</div>
                        <div class="log-user">Contractor: Sarah Asante</div>
                    </div>
                    <div class="log-entry fault" style="cursor: pointer; transition: all 0.3s ease;"
                        onmouseover="this.style.backgroundColor='#fffbeb'; this.style.transform='translateX(4px)'"
                        onmouseout="this.style.backgroundColor=''; this.style.transform='translateX(0)'"
                        onclick="showLogDetails('LOG-004', 'fault')">
                        <div class="log-time">2024-01-31 09:15:44</div>
                        <div class="log-type">FAULT</div>
                        <div class="log-message">Power outage reported in Effia-Kuma Village</div>
                        <div class="log-location">Western â†’ Sekondi-Takoradi Metropolitan â†’ Takoradi Industrial Zone
                        </div>
                        <div class="log-user">Customer Report</div>
                    </div>
                    <div class="log-entry installation" style="cursor: pointer; transition: all 0.3s ease;"
                        onmouseover="this.style.backgroundColor='#eff6ff'; this.style.transform='translateX(4px)'"
                        onmouseout="this.style.backgroundColor=''; this.style.transform='translateX(0)'"
                        onclick="showLogDetails('LOG-005', 'installation')">
                        <div class="log-time">2024-01-30 16:30:22</div>
                        <div class="log-type">INSTALLATION</div>
                        <div class="log-message">Smart pole activated with monitoring nodes</div>
                        <div class="log-location">Ashanti â†’ Kumasi Metropolitan â†’ Kumasi Central Zone</div>
                        <div class="log-user">Contractor: Michael Osei</div>
                    </div>
                    <div class="log-entry maintenance" style="cursor: pointer; transition: all 0.3s ease;"
                        onmouseover="this.style.backgroundColor='#f0fdf4'; this.style.transform='translateX(4px)'"
                        onmouseout="this.style.backgroundColor=''; this.style.transform='translateX(0)'"
                        onclick="showLogDetails('LOG-006', 'maintenance')">
                        <div class="log-time">2024-01-30 14:12:55</div>
                        <div class="log-type">MAINTENANCE</div>
                        <div class="log-message">Monitoring nodes calibration completed</div>
                        <div class="log-location">Greater Accra â†’ Tema Metropolitan â†’ Tema Industrial Zone</div>
                        <div class="log-user">Contractor: Grace Adjei</div>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- Dispatch Request View - Full Screen -->
        <div id="dispatch-view" class="view-container full-screen">
            <div class="dispatch-container full-screen-content">
                <div class="dispatch-header">
                    <h2>Dispatch Request</h2>
                    <button class="dispatch-btn primary" onclick="createNewDispatch()">
                        <i class="fi fi-rr-plus"></i>
                        New Dispatch Request
                    </button>
                </div>
                <div class="dispatch-content">
                    <div class="dispatch-stats">
                        <div class="stat-card pending">
                            <div class="stat-number">12</div>
                            <div class="stat-label">Pending Requests</div>
                        </div>
                        <div class="stat-card active">
                            <div class="stat-number">8</div>
                            <div class="stat-label">Active Dispatches</div>
                        </div>
                        <div class="stat-card completed">
                            <div class="stat-number">45</div>
                            <div class="stat-label">Completed Today</div>
                        </div>
                        <div class="stat-card contractors">
                            <div class="stat-number">23</div>
                            <div class="stat-label">Available Contractors</div>
                        </div>
                    </div>
                    <div class="dispatch-filters">
                        <select class="dispatch-select">
                            <option value="all">All Requests</option>
                            <option value="pending">Pending</option>
                            <option value="assigned">Assigned</option>
                            <option value="in-progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                        <select class="dispatch-select">
                            <option value="all">All Regions</option>
                            <option value="GH-AA">Greater Accra</option>
                            <option value="GH-AH">Ashanti</option>
                            <option value="GH-WP">Western</option>
                        </select>
                        <select class="dispatch-select">
                            <option value="all">All Types</option>
                            <option value="installation">Installation</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="repair">Repair</option>
                            <option value="inspection">Inspection</option>
                        </select>
                    </div>
                    <div class="dispatch-requests">
                        <div class="dispatch-card urgent">
                            <div class="dispatch-header-card">
                                <div class="dispatch-id">#DR-2024-0156</div>
                                <div class="dispatch-priority urgent">URGENT</div>
                                <div class="dispatch-status pending">PENDING</div>
                            </div>
                            <div class="dispatch-details">
                                <h4>Transformer Fault Repair</h4>
                                <p class="dispatch-location">
                                    <i class="fi fi-rr-map-marker"></i>
                                    TR-ACC-001, Osu Castle Area, Greater Accra
                                </p>
                                <p class="dispatch-description">Critical transformer fault detected. Power outage
                                    affecting 150+ households. Immediate repair required.</p>
                                <div class="dispatch-meta">
                                    <span><i class="fi fi-rr-clock"></i> Created: 2024-01-31 14:25</span>
                                    <span><i class="fi fi-rr-user"></i> Requested by: System Alert</span>
                                </div>
                            </div>
                            <div class="dispatch-actions">
                                <button class="dispatch-btn secondary"
                                    onclick="viewDispatchDetails('DR-2024-0156')">View
                                    Details</button>
                                <button class="dispatch-btn primary" onclick="assignContractor('DR-2024-0156')">Assign
                                    Contractor</button>
                            </div>
                        </div>

                        <div class="dispatch-card normal">
                            <div class="dispatch-header-card">
                                <div class="dispatch-id">#DR-2024-0155</div>
                                <div class="dispatch-priority normal">NORMAL</div>
                                <div class="dispatch-status assigned">ASSIGNED</div>
                            </div>
                            <div class="dispatch-details">
                                <h4>Smart Meter Installation</h4>
                                <p class="dispatch-location">
                                    <i class="fi fi-rr-map-marker"></i>
                                    Bantama Residential, Ashanti
                                </p>
                                <p class="dispatch-description">Install 5 new smart meters in residential area. Standard
                                    installation procedure.</p>
                                <div class="dispatch-meta">
                                    <span><i class="fi fi-rr-clock"></i> Created: 2024-01-31 10:15</span>
                                    <span><i class="fi fi-rr-user"></i> Assigned to: John Mensah</span>
                                </div>
                            </div>
                            <div class="dispatch-actions">
                                <button class="dispatch-btn secondary"
                                    onclick="viewDispatchDetails('DR-2024-0155')">View
                                    Details</button>
                                <button class="dispatch-btn secondary" onclick="trackProgress('DR-2024-0155')">Track
                                    Progress</button>
                            </div>
                        </div>

                        <div class="dispatch-card low">
                            <div class="dispatch-header-card">
                                <div class="dispatch-id">#DR-2024-0154</div>
                                <div class="dispatch-priority low">LOW</div>
                                <div class="dispatch-status in-progress">IN PROGRESS</div>
                            </div>
                            <div class="dispatch-details">
                                <h4>Routine Maintenance</h4>
                                <p class="dispatch-location">
                                    <i class="fi fi-rr-map-marker"></i>
                                    TR-STM-002, Effia-Kuma Village, Western
                                </p>
                                <p class="dispatch-description">Scheduled quarterly maintenance check on rural
                                    transformer and monitoring nodes.</p>
                                <div class="dispatch-meta">
                                    <span><i class="fi fi-rr-clock"></i> Started: 2024-01-31 08:30</span>
                                    <span><i class="fi fi-rr-user"></i> Contractor: Sarah Asante</span>
                                </div>
                            </div>
                            <div class="dispatch-actions">
                                <button class="dispatch-btn secondary"
                                    onclick="viewDispatchDetails('DR-2024-0154')">View
                                    Details</button>
                                <button class="dispatch-btn secondary"
                                    onclick="contactContractor('DR-2024-0154')">Contact
                                    Contractor</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </main>

    <script src="script.js"></script>
    <script>
        // Integration JavaScript
        let currentView = 'dashboard';
        let dashboardLoaded = false;

        let mapInitialized = false;
        let dashboardLoading = false;

        function showView(viewName) {
            console.log('Switching to view:', viewName);

            // Prevent multiple rapid clicks
            if (window.viewSwitching) {
                console.log('View switch already in progress, ignoring...');
                return;
            }
            window.viewSwitching = true;

            // Update navigation immediately
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const targetBtn = document.getElementById(viewName + '-btn');
            if (targetBtn) {
                targetBtn.classList.add('active');
            }

            // NUCLEAR OPTION: Completely destroy and rebuild view visibility
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                // Hide everything in main content
                mainContent.style.visibility = 'hidden';
                mainContent.style.opacity = '0';
            }

            // Force hide ALL views and their content
            document.querySelectorAll('.view-container').forEach(view => {
                view.classList.remove('active');
                view.style.cssText = 'display: none !important; opacity: 0 !important; visibility: hidden !important; z-index: -1 !important; position: absolute !important;';

                // Recursively hide all descendants
                const allDescendants = view.querySelectorAll('*');
                allDescendants.forEach(element => {
                    element.style.cssText = 'display: none !important; opacity: 0 !important; visibility: hidden !important;';
                });
            });

            // Specifically target problematic elements
            const problematicSelectors = [
                '#chartdiv', '#sidebar',
                '.dispatch-container', '.dispatch-header', '.dispatch-content', '.dispatch-stats', '.dispatch-filters', '.dispatch-requests',
                '.audit-container', '.audit-header', '.audit-content', '.audit-stats', '.audit-log',
                '.transformers-container', '.transformers-header', '.transformers-content'
            ];

            problematicSelectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(element => {
                    element.style.cssText = 'display: none !important; opacity: 0 !important; visibility: hidden !important; z-index: -1 !important;';
                });
            });

            // Clean up dashboard intervals when switching away from dashboard
            if (currentView === 'dashboard' && viewName !== 'dashboard') {
                if (window.dashboardIntervals) {
                    window.dashboardIntervals.forEach(interval => clearInterval(interval));
                    window.dashboardIntervals = [];
                    console.log('ðŸ§¹ Cleaned up dashboard intervals');
                }
            }

            // Wait for complete cleanup, then show target view
            setTimeout(() => {
                const targetView = document.getElementById(viewName + '-view');
                if (targetView) {
                    // Show main content first
                    if (mainContent) {
                        mainContent.style.visibility = 'visible';
                        mainContent.style.opacity = '1';
                    }

                    // Reset and show ONLY the target view
                    targetView.style.cssText = 'display: block !important; opacity: 1 !important; visibility: visible !important; z-index: 10 !important; position: absolute !important; top: 0; left: 0; width: 100%; height: 100%;';
                    targetView.classList.add('active');

                    // Restore visibility to target view's children
                    const targetChildren = targetView.querySelectorAll('*');
                    targetChildren.forEach(child => {
                        child.style.display = '';
                        child.style.opacity = '';
                        child.style.visibility = '';
                        child.style.zIndex = '';
                    });

                    // Special handling for dashboard view to ensure clean state
                    if (viewName === 'dashboard') {
                        // Ensure dashboard view has proper styling
                        targetView.style.background = '#ffffff';
                        targetView.style.overflow = 'hidden';

                        // Remove any text content that might have been corrupted
                        const textNodes = [];
                        const walker = document.createTreeWalker(
                            targetView,
                            NodeFilter.SHOW_TEXT,
                            null,
                            false
                        );
                        let node;
                        while (node = walker.nextNode()) {
                            if (node.nodeValue.trim() && node.parentNode.tagName !== 'SCRIPT' && node.parentNode.tagName !== 'STYLE') {
                                textNodes.push(node);
                            }
                        }
                        // Only remove orphaned text nodes (not those inside proper HTML elements)
                        textNodes.forEach(textNode => {
                            if (textNode.parentNode === targetView) {
                                textNode.remove();
                            }
                        });
                    }

                    // Special handling for grid view elements
                    if (viewName === 'grid') {
                        const chartDiv = document.getElementById('chartdiv');
                        const sidebar = document.getElementById('sidebar');
                        if (chartDiv) {
                            chartDiv.style.cssText = 'display: block !important; opacity: 1 !important; visibility: visible !important; width: 70%; height: 100%; position: relative; z-index: 1;';
                        }
                        if (sidebar) {
                            sidebar.style.cssText = 'display: block !important; opacity: 1 !important; visibility: visible !important; width: 30%; height: 100%; position: relative; z-index: 1;';
                        }

                        // Debug sidebar visibility
                        console.log('ðŸ”§ Grid view activated, debugging sidebar...');
                        console.log('Body data-current-view:', document.body.getAttribute('data-current-view'));
                        console.log('Sidebar element:', sidebar);
                        console.log('Sidebar computed style:', window.getComputedStyle(sidebar).display);

                        // Force sidebar to be visible with maximum specificity
                        if (sidebar) {
                            sidebar.style.setProperty('display', 'block', 'important');
                            sidebar.style.setProperty('visibility', 'visible', 'important');
                            sidebar.style.setProperty('opacity', '1', 'important');
                            sidebar.style.setProperty('z-index', '1000', 'important');
                            console.log('Sidebar forced visible, new display:', window.getComputedStyle(sidebar).display);
                        }

                        // Ensure sidebar content is initialized immediately
                        console.log('ðŸ”§ Initializing sidebar content...');
                        showNoSelection();

                        // Also check after a delay
                        setTimeout(() => {
                            const districtInfo = document.getElementById('district-info');
                            console.log('District info element:', districtInfo);
                            console.log('District info content length:', districtInfo?.innerHTML.length || 0);
                            if (districtInfo && districtInfo.innerHTML.trim() === '') {
                                console.log('Grid view loaded but sidebar empty, re-initializing...');
                                showNoSelection();
                            }
                        }, 300);
                    }
                }

                currentView = viewName;

                // Set body data attribute for CSS targeting
                document.body.setAttribute('data-current-view', viewName);

                // Debug logging for audit view
                if (viewName === 'audit') {
                    console.log('Audit view activated');
                    const auditContainer = document.querySelector('.audit-container');
                    const auditHeader = document.querySelector('.audit-header');
                    const auditContent = document.querySelector('.audit-content');
                    console.log('Audit container:', auditContainer);
                    console.log('Audit header:', auditHeader);
                    console.log('Audit content:', auditContent);
                }

                // Load content if needed
                if (viewName === 'dashboard' && !dashboardLoading) {
                    // Always reload dashboard to ensure it displays correctly
                    dashboardLoading = true;
                    setTimeout(() => {
                        loadDashboard();
                        setTimeout(() => {
                            dashboardLoading = false;
                        }, 1000);
                    }, 200);
                } else if (viewName === 'grid') {
                    if (!mapInitialized) {
                        setTimeout(() => {
                            initializeGhanaMap();
                            mapInitialized = true;
                        }, 500);
                    } else {
                        // Map already initialized, just ensure sidebar is showing
                        setTimeout(() => {
                            console.log('Grid view accessed, ensuring sidebar is initialized...');
                            showNoSelection();
                        }, 200);
                    }
                }

                // Allow new view switches
                setTimeout(() => {
                    window.viewSwitching = false;
                }, 300);

                console.log('Successfully switched to view:', viewName);
            }, 100);
        }

        function cleanupViews() {
            console.log('Nuclear cleanup initiated...');

            // Remove body data attribute temporarily
            document.body.removeAttribute('data-current-view');

            // Nuclear option: Hide everything that could possibly interfere
            const problematicSelectors = [
                '.view-container',
                '#chartdiv', '#sidebar',
                '.dispatch-container', '.dispatch-header', '.dispatch-content', '.dispatch-stats', '.dispatch-filters', '.dispatch-requests', '.dispatch-card', '.dispatch-actions',
                '.audit-container', '.audit-header', '.audit-content', '.audit-stats', '.audit-log', '.log-entry',
                '.transformers-container', '.transformers-header', '.transformers-content', '.transformers-stats', '.transformers-grid', '.transformer-card',
                '.dashboard-container', 'iframe'
            ];

            problematicSelectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(element => {
                    element.style.cssText = 'display: none !important; opacity: 0 !important; visibility: hidden !important; z-index: -1000 !important; position: absolute !important;';
                    element.classList.remove('active');
                });
            });

            // Clear any amCharts instances that might be lingering
            if (typeof am5 !== 'undefined' && window.ghanaMapRoot) {
                try {
                    window.ghanaMapRoot.dispose();
                    window.ghanaMapRoot = null;
                } catch (e) {
                    console.log('Map cleanup error (non-critical):', e);
                }
            }

            console.log('Nuclear cleanup completed');
        }

        function initializeGhanaMap() {
            console.log('Initializing Ghana Map...');

            // Ensure we're in grid view
            if (currentView !== 'grid') {
                console.log('Not in grid view, skipping map initialization');
                return;
            }

            // Check if amCharts is available
            if (typeof am5 === 'undefined') {
                console.error('amCharts not loaded');
                return;
            }

            // Check if Ghana geodata is available
            if (typeof am5geodata_ghanaLow === 'undefined') {
                console.error('Ghana geodata not loaded');
                return;
            }

            // Clear any existing map instance
            if (window.ghanaMapRoot) {
                try {
                    window.ghanaMapRoot.dispose();
                    window.ghanaMapRoot = null;
                } catch (e) {
                    console.log('Previous map cleanup error (non-critical):', e);
                }
            }

            // Ensure chartdiv is visible and ready
            const chartDiv = document.getElementById('chartdiv');
            if (!chartDiv) {
                console.error('Chart div not found');
                return;
            }

            // Make sure chartdiv has dimensions
            chartDiv.style.width = '70%';
            chartDiv.style.height = '100%';
            chartDiv.style.display = 'block';

            // Initialize the map using the existing script
            am5.ready(function () {
                console.log('amCharts ready, creating Ghana map...');
                console.log('Ghana geodata available:', typeof am5geodata_ghanaLow !== 'undefined');

                try {
                    var root = am5.Root.new("chartdiv");
                    window.ghanaMapRoot = root; // Store reference for cleanup
                    root.setThemes([am5themes_Animated.new(root), am5themes_Dark.new(root)]);

                    var chart = root.container.children.push(am5map.MapChart.new(root, {
                        panX: "rotateX",
                        panY: "rotateY",
                        projection: am5map.geoMercator()
                    }));

                    var polygonSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {
                        geoJSON: am5geodata_ghanaLow
                    }));

                    console.log('Polygon series created, geodata:', am5geodata_ghanaLow);

                    // Configure polygon appearance with enhanced tooltip
                    polygonSeries.mapPolygons.template.setAll({
                        tooltipText: "{name}",
                        interactive: true,
                        fill: am5.color("#4CAF50"),
                        stroke: am5.color("#ffffff"),
                        strokeWidth: 1,
                        tooltipY: 0,
                        cursorOverStyle: "pointer"
                    });

                    // Enhanced tooltip with region information
                    polygonSeries.mapPolygons.template.set("tooltip", am5.Tooltip.new(root, {
                        labelText: "{name}",
                        getFillFromSprite: false,
                        getStrokeFromSprite: false,
                        autoTextColor: false,
                        pointerOrientation: "vertical",
                        getText: function(target) {
                            const dataItem = target.dataItem;
                            const regionName = dataItem.get("name") || dataItem.dataContext?.name || "Unknown Region";
                            const regionId = dataItem.get("id") || dataItem.dataContext?.id || "";
                            
                            // Get region statistics for tooltip
                            const regionStats = getRegionStats(regionName);
                            
                            return `[bold]${regionName}[/]\n` +
                                   `Region ID: ${regionId}\n` +
                                   `Districts: ${regionStats.districts}\n` +
                                   `Transformers: ${regionStats.transformers}\n` +
                                   `Smart Meters: ${regionStats.smartMeters}\n` +
                                   `Status: ${regionStats.status}`;
                        }
                    }));

                    polygonSeries.mapPolygons.template.get("tooltip").get("background").setAll({
                        fill: am5.color("#1a1a1a"),
                        stroke: am5.color("#F97316"),
                        strokeWidth: 2,
                        cornerRadius: 8
                    });

                    polygonSeries.mapPolygons.template.get("tooltip").label.setAll({
                        fill: am5.color("#ffffff"),
                        fontSize: 12,
                        fontWeight: "400",
                        lineHeight: 1.4
                    });

                    // Enhanced hover state with better visual feedback
                    polygonSeries.mapPolygons.template.states.create("hover", {
                        fill: am5.color("#F97316"),
                        stroke: am5.color("#ffffff"),
                        strokeWidth: 2,
                        scale: 1.02
                    });

                    // Add mouse over event for additional hover effects
                    polygonSeries.mapPolygons.template.on("pointerover", function(ev) {
                        const polygon = ev.target;
                        const regionName = polygon.dataItem.get("name") || polygon.dataItem.dataContext?.name || "Unknown Region";
                        
                        // Add a subtle glow effect
                        polygon.set("fill", am5.color("#F97316"));
                        polygon.set("stroke", am5.color("#ffffff"));
                        polygon.set("strokeWidth", 2);
                        
                        // Show region name in a floating label (optional enhancement)
                        showFloatingRegionName(regionName, ev.point);
                    });

                    // Add mouse out event to reset hover state
                    polygonSeries.mapPolygons.template.on("pointerout", function(ev) {
                        const polygon = ev.target;
                        
                        // Reset to default state
                        polygon.set("fill", am5.color("#4CAF50"));
                        polygon.set("stroke", am5.color("#ffffff"));
                        polygon.set("strokeWidth", 1);
                        
                        // Hide floating label
                        hideFloatingRegionName();
                    });

                    // Add click handler with improved region detection
                    polygonSeries.mapPolygons.template.on("click", function (ev) {
                        var dataItem = ev.target.dataItem;
                        var regionId = dataItem.get("id");
                        var regionName = dataItem.get("name");

                        console.log("Map clicked - Raw data:", { regionId, regionName });
                        console.log("DataItem properties:", dataItem.dataContext);

                        // Try multiple ways to get region info
                        var actualRegionName = regionName || dataItem.dataContext?.name || dataItem.dataContext?.NAME || "Unknown Region";
                        var actualRegionId = regionId || dataItem.dataContext?.id || dataItem.dataContext?.ID;

                        console.log("Processed region info:", { actualRegionName, actualRegionId });

                        // Map the region name to our standard ID
                        var mappedRegionId = findRegionId(actualRegionId, actualRegionName);

                        console.log("Final mapped region ID:", mappedRegionId);

                        if (mappedRegionId) {
                            showRegionDistricts(mappedRegionId);
                        } else {
                            // Show region info even if we can't map it perfectly
                            showRegionInfo(actualRegionName, actualRegionId);
                        }
                    });

                    // Wait for data to load and debug
                    polygonSeries.onPrivate("loaded", function () {
                        console.log('Map data loaded successfully');
                        console.log('Number of regions:', polygonSeries.mapPolygons.length);

                        // Debug: Log all available region data
                        polygonSeries.mapPolygons.each(function (polygon) {
                            const dataContext = polygon.dataItem.dataContext;
                            console.log('Region data:', {
                                name: dataContext.name || dataContext.NAME,
                                id: dataContext.id || dataContext.ID,
                                properties: dataContext.properties,
                                fullContext: dataContext
                            });
                        });
                    });

                    console.log('Ghana map initialized successfully');

                } catch (error) {
                    console.error('Error initializing Ghana map:', error);
                }
            });

            // Initialize sidebar
            console.log('Calling showNoSelection to initialize sidebar...');
            showNoSelection();

            // Double-check sidebar initialization after a delay
            setTimeout(() => {
                const sidebarContent = document.getElementById('district-info');
                if (sidebarContent && sidebarContent.innerHTML.trim() === '') {
                    console.log('Sidebar empty, re-initializing...');
                    showNoSelection();
                }
            }, 1000);
        }

        // Function to get region statistics for tooltips
        function getRegionStats(regionName) {
            // Default statistics for all regions
            const defaultStats = {
                districts: Math.floor(Math.random() * 20) + 10,
                transformers: Math.floor(Math.random() * 50) + 25,
                smartMeters: Math.floor(Math.random() * 200) + 100,
                status: "Operational"
            };

            // Enhanced statistics for known regions
            const regionStats = {
                "Greater Accra": {
                    districts: 16,
                    transformers: 45,
                    smartMeters: 180,
                    status: "Operational"
                },
                "Ashanti": {
                    districts: 27,
                    transformers: 62,
                    smartMeters: 245,
                    status: "Operational"
                },
                "Western": {
                    districts: 22,
                    transformers: 38,
                    smartMeters: 165,
                    status: "Operational"
                },
                "Eastern": {
                    districts: 21,
                    transformers: 41,
                    smartMeters: 178,
                    status: "Operational"
                },
                "Northern": {
                    districts: 18,
                    transformers: 35,
                    smartMeters: 142,
                    status: "Operational"
                },
                "Volta": {
                    districts: 18,
                    transformers: 33,
                    smartMeters: 156,
                    status: "Operational"
                },
                "Central": {
                    districts: 20,
                    transformers: 39,
                    smartMeters: 167,
                    status: "Operational"
                },
                "Upper East": {
                    districts: 15,
                    transformers: 28,
                    smartMeters: 98,
                    status: "Operational"
                },
                "Upper West": {
                    districts: 11,
                    transformers: 22,
                    smartMeters: 76,
                    status: "Operational"
                },
                "Brong Ahafo": {
                    districts: 22,
                    transformers: 44,
                    smartMeters: 189,
                    status: "Operational"
                },
                "Brong-Ahafo": {
                    districts: 22,
                    transformers: 44,
                    smartMeters: 189,
                    status: "Operational"
                }
            };

            // Try to find exact match
            if (regionStats[regionName]) {
                return regionStats[regionName];
            }

            // Try case-insensitive match
            const upperName = regionName?.toUpperCase();
            for (const [key, value] of Object.entries(regionStats)) {
                if (key.toUpperCase() === upperName) {
                    return value;
                }
            }

            // Try partial match
            for (const [key, value] of Object.entries(regionStats)) {
                if (regionName && key.toLowerCase().includes(regionName.toLowerCase())) {
                    return value;
                }
            }

            // Return default stats if no match found
            return defaultStats;
        }

        // Global variable to track floating label
        let floatingRegionLabel = null;

        // Function to show floating region name
        function showFloatingRegionName(regionName, point) {
            // Remove existing label if any
            hideFloatingRegionName();
            
            // Create floating label element
            floatingRegionLabel = document.createElement('div');
            floatingRegionLabel.className = 'floating-region-label';
            floatingRegionLabel.textContent = regionName;
            floatingRegionLabel.style.cssText = `
                position: absolute;
                background: rgba(26, 26, 26, 0.95);
                color: #ffffff;
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 500;
                border: 2px solid #F97316;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                z-index: 1000;
                pointer-events: none;
                transform: translate(-50%, -100%);
                margin-top: -10px;
                white-space: nowrap;
                backdrop-filter: blur(4px);
            `;
            
            // Position the label
            if (point) {
                floatingRegionLabel.style.left = point.x + 'px';
                floatingRegionLabel.style.top = point.y + 'px';
            } else {
                // Fallback positioning
                floatingRegionLabel.style.left = '50%';
                floatingRegionLabel.style.top = '50%';
            }
            
            // Add to chart container
            const chartContainer = document.getElementById('chartdiv');
            if (chartContainer) {
                chartContainer.appendChild(floatingRegionLabel);
            }
        }

        // Function to hide floating region name
        function hideFloatingRegionName() {
            if (floatingRegionLabel) {
                floatingRegionLabel.remove();
                floatingRegionLabel = null;
            }
        }

        // Comprehensive transformer data with district categorization
        const comprehensiveTransformerData = {
            "Greater Accra": {
                districts: {
                    "Accra Metropolitan": {
                        type: "Urban",
                        transformers: [
                            {
                                id: "TR-ACC-001",
                                name: "Osu Primary Transformer",
                                location: "Osu Castle Area",
                                capacity: 500,
                                voltage: "33/11 kV",
                                load: 78,
                                status: "Active",
                                meters: {
                                    singlePhase: 32,
                                    threePhase: 13,
                                    smartMeters: 28,
                                    monitoringNodes: 12
                                },
                                category: "Urban",
                                efficiency: 94,
                                lastMaintenance: "2024-01-15",
                                nextMaintenance: "2024-07-15"
                            },
                            {
                                id: "TR-ACC-002",
                                name: "Tema Industrial Transformer",
                                location: "Tema Industrial Area",
                                capacity: 1000,
                                voltage: "33/11 kV",
                                load: 85,
                                status: "Active",
                                meters: {
                                    singlePhase: 45,
                                    threePhase: 28,
                                    smartMeters: 52,
                                    monitoringNodes: 18
                                },
                                category: "Urban",
                                efficiency: 91,
                                lastMaintenance: "2024-02-20",
                                nextMaintenance: "2024-08-20"
                            }
                        ]
                    },
                    "Ga East Municipal": {
                        type: "Peri-Urban",
                        transformers: [
                            {
                                id: "TR-GAE-001",
                                name: "Madina Central Transformer",
                                location: "Madina Central",
                                capacity: 400,
                                voltage: "33/11 kV",
                                load: 72,
                                status: "Active",
                                meters: {
                                    singlePhase: 28,
                                    threePhase: 8,
                                    smartMeters: 25,
                                    monitoringNodes: 9
                                },
                                category: "Peri-Urban",
                                efficiency: 89,
                                lastMaintenance: "2024-01-30",
                                nextMaintenance: "2024-07-30"
                            }
                        ]
                    }
                }
            },
            "Ashanti": {
                districts: {
                    "Kumasi Metropolitan": {
                        type: "Urban",
                        transformers: [
                            {
                                id: "TR-KMA-001",
                                name: "Kejetia Market Transformer",
                                location: "Kejetia Market Area",
                                capacity: 1000,
                                voltage: "33/11 kV",
                                load: 92,
                                status: "Maintenance",
                                meters: {
                                    singlePhase: 65,
                                    threePhase: 35,
                                    smartMeters: 78,
                                    monitoringNodes: 22
                                },
                                category: "Urban",
                                efficiency: 87,
                                lastMaintenance: "2024-03-10",
                                nextMaintenance: "2024-09-10"
                            }
                        ]
                    },
                    "Obuasi Municipal": {
                        type: "Rural",
                        transformers: [
                            {
                                id: "TR-OBU-001",
                                name: "Obuasi Mining Transformer",
                                location: "Obuasi Mining Area",
                                capacity: 800,
                                voltage: "33/11 kV",
                                load: 68,
                                status: "Active",
                                meters: {
                                    singlePhase: 42,
                                    threePhase: 18,
                                    smartMeters: 38,
                                    monitoringNodes: 15
                                },
                                category: "Rural",
                                efficiency: 92,
                                lastMaintenance: "2024-02-15",
                                nextMaintenance: "2024-08-15"
                            }
                        ]
                    }
                }
            },
            "Western": {
                districts: {
                    "Sekondi-Takoradi Metropolitan": {
                        type: "Urban",
                        transformers: [
                            {
                                id: "TR-SEK-001",
                                name: "Takoradi Port Transformer",
                                location: "Takoradi Port Area",
                                capacity: 1200,
                                voltage: "33/11 kV",
                                load: 88,
                                status: "Active",
                                meters: {
                                    singlePhase: 55,
                                    threePhase: 42,
                                    smartMeters: 67,
                                    monitoringNodes: 25
                                },
                                category: "Urban",
                                efficiency: 90,
                                lastMaintenance: "2024-01-25",
                                nextMaintenance: "2024-07-25"
                            }
                        ]
                    }
                }
            }
        };

        // Function to generate interactive transformer cards
        function generateInteractiveTransformerCards(regionName = null, districtName = null) {
            const grid = document.getElementById('transformers-grid');
            if (!grid) return;

            let allTransformers = [];
            
            if (regionName && districtName) {
                // Show transformers for specific district
                const districtData = comprehensiveTransformerData[regionName]?.districts[districtName];
                if (districtData) {
                    allTransformers = districtData.transformers.map(t => ({
                        ...t,
                        region: regionName,
                        district: districtName
                    }));
                }
            } else if (regionName) {
                // Show transformers for specific region
                const regionData = comprehensiveTransformerData[regionName];
                if (regionData) {
                    Object.entries(regionData.districts).forEach(([district, districtData]) => {
                        districtData.transformers.forEach(transformer => {
                            allTransformers.push({
                                ...transformer,
                                region: regionName,
                                district: district
                            });
                        });
                    });
                }
            } else {
                // Show all transformers
                Object.entries(comprehensiveTransformerData).forEach(([region, regionData]) => {
                    Object.entries(regionData.districts).forEach(([district, districtData]) => {
                        districtData.transformers.forEach(transformer => {
                            allTransformers.push({
                                ...transformer,
                                region: region,
                                district: district
                            });
                        });
                    });
                });
            }

            // Update stats
            updateTransformerStats(allTransformers);

            // Generate cards
            grid.innerHTML = allTransformers.map(transformer => `
                <div class="transformer-card ${transformer.status.toLowerCase()}" 
                     onclick="viewTransformerDetails('${transformer.id}')"
                     style="cursor: pointer; transition: all 0.3s ease;"
                     onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.3)'"
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'">
                    
                    <div class="transformer-header-card">
                        <div class="transformer-icon-custom"></div>
                        <div class="transformer-info">
                            <h4>${transformer.id}</h4>
                            <p>${transformer.name}</p>
                            <div class="category-badge ${transformer.category.toLowerCase()}">
                                ${transformer.category === 'Urban' ? 'ðŸ™ï¸ Urban' : 
                                  transformer.category === 'Peri-Urban' ? 'ðŸ˜ï¸ Peri-Urban' : 'ðŸŒ¾ Rural'}
                            </div>
                        </div>
                        <div class="transformer-status ${transformer.status.toLowerCase()}">${transformer.status.toUpperCase()}</div>
                    </div>
                    
                    <div class="transformer-details">
                        <div class="detail-row">
                            <span>ðŸ“ Location:</span>
                            <span>${transformer.location}, ${transformer.region}</span>
                        </div>
                        <div class="detail-row">
                            <span>âš¡ Capacity:</span>
                            <span>${transformer.capacity} kVA</span>
                        </div>
                        <div class="detail-row">
                            <span>ðŸ”Œ Voltage:</span>
                            <span>${transformer.voltage}</span>
                        </div>
                        <div class="detail-row">
                            <span>ðŸ“Š Load:</span>
                            <span>${transformer.load}% (${Math.round(transformer.capacity * transformer.load / 100)} kVA)</span>
                        </div>
                        <div class="detail-row">
                            <span>ðŸ“ˆ Efficiency:</span>
                            <span>${transformer.efficiency}%</span>
                        </div>
                        <div class="detail-row">
                            <span>ðŸ¢ District:</span>
                            <span>${transformer.district}</span>
                        </div>
                    </div>
                    
                    <div class="transformer-meters-section">
                        <h5 style="margin: 0 0 8px 0; color: #F97316; font-size: 14px;">ðŸ“Š Metering & Monitoring</h5>
                        <div class="meters-grid">
                            <div class="meter-stat">
                                <div class="meter-number">${transformer.meters.singlePhase + transformer.meters.threePhase}</div>
                                <div class="meter-label">Total Meters</div>
                            </div>
                            <div class="meter-stat">
                                <div class="meter-number">${transformer.meters.smartMeters}</div>
                                <div class="meter-label">Smart Meters</div>
                            </div>
                            <div class="meter-stat">
                                <div class="meter-number">${transformer.meters.monitoringNodes}</div>
                                <div class="meter-label">Monitoring Nodes</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="transformer-actions">
                        <button class="action-btn" onclick="event.stopPropagation(); viewTransformerDetails('${transformer.id}')">
                            <i class="fi fi-rr-eye"></i> View Details
                        </button>
                        <button class="action-btn" onclick="event.stopPropagation(); viewSmartMeters('${transformer.id}')">
                            <i class="fi fi-rr-settings"></i> Smart Meters
                        </button>
                        <button class="action-btn" onclick="event.stopPropagation(); scheduleMaintenance('${transformer.id}')">
                            <i class="fi fi-rr-tools"></i> Maintenance
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Function to update transformer statistics
        function updateTransformerStats(transformers) {
            const totalTransformers = transformers.length;
            const activeTransformers = transformers.filter(t => t.status === 'Active').length;
            const maintenanceTransformers = transformers.filter(t => t.status === 'Maintenance').length;
            const faultTransformers = transformers.filter(t => t.status === 'Fault').length;

            // Update stats cards
            const statsContainer = document.querySelector('.transformers-stats');
            if (statsContainer) {
                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${totalTransformers}</div>
                        <div class="stat-label">Total Transformers</div>
                    </div>
                    <div class="stat-card active">
                        <div class="stat-number">${activeTransformers}</div>
                        <div class="stat-label">Active</div>
                    </div>
                    <div class="stat-card maintenance">
                        <div class="stat-number">${maintenanceTransformers}</div>
                        <div class="stat-label">Maintenance</div>
                    </div>
                    <div class="stat-card fault">
                        <div class="stat-number">${faultTransformers}</div>
                        <div class="stat-label">Faults</div>
                    </div>
                `;
            }
        }

        // Function to show transformers overview (default view)
        function showTransformersOverview() {
            generateInteractiveTransformerCards();
        }

        // Function to show transformers for specific region/district
        function showRegionTransformers(regionName, districtName = null) {
            generateInteractiveTransformerCards(regionName, districtName);
        }

        // Initialize transformers view when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize transformers view if it's the active view
            if (document.getElementById('transformers-view').classList.contains('active')) {
                showTransformersOverview();
            }
        });

        // Transformer action functions
        function viewTransformerDetails(transformerId) {
            console.log('Viewing details for transformer:', transformerId);
            showModal('Transformer Details', `
                <div style="padding: 20px;">
                    <h3 style="color: #F97316; margin-bottom: 16px;">${transformerId} - Detailed Information</h3>
                    <p style="color: #666; margin-bottom: 20px;">Detailed transformer information and monitoring data will be displayed here.</p>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <h4 style="margin: 0 0 12px 0; color: #333;">Real-time Monitoring</h4>
                        <p style="color: #666; font-size: 14px;">Advanced monitoring features including load analysis, efficiency metrics, and predictive maintenance alerts will be implemented here.</p>
                    </div>
                </div>
            `);
        }

        function viewSmartMeters(transformerId) {
            console.log('Viewing smart meters for transformer:', transformerId);
            showModal('Smart Meters', `
                <div style="padding: 20px;">
                    <h3 style="color: #F97316; margin-bottom: 16px;">Smart Meters - ${transformerId}</h3>
                    <p style="color: #666; margin-bottom: 20px;">Smart meter data and customer information will be displayed here.</p>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <h4 style="margin: 0 0 12px 0; color: #333;">Meter Management</h4>
                        <p style="color: #666; font-size: 14px;">Individual meter status, consumption patterns, and customer data will be shown here.</p>
                    </div>
                </div>
            `);
        }

        function scheduleMaintenance(transformerId) {
            console.log('Scheduling maintenance for transformer:', transformerId);
            showModal('Schedule Maintenance', `
                <div style="padding: 20px;">
                    <h3 style="color: #F97316; margin-bottom: 16px;">Schedule Maintenance - ${transformerId}</h3>
                    <p style="color: #666; margin-bottom: 20px;">Maintenance scheduling interface will be implemented here.</p>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <h4 style="margin: 0 0 12px 0; color: #333;">Maintenance Planning</h4>
                        <p style="color: #666; font-size: 14px;">Schedule routine maintenance, view maintenance history, and set up automated alerts will be available here.</p>
                    </div>
                </div>
            `);
        }

        function findRegionId(id, name) {
            console.log('Finding region ID for:', { id, name });

            // This function should be loaded from script.js
            if (typeof window.findRegionId === 'function') {
                return window.findRegionId(id, name);
            }

            // Enhanced fallback region mapping with multiple variations
            const nameMap = {
                // Standard names
                "Greater Accra": "GH-AA",
                "Ashanti": "GH-AH",
                "Western": "GH-WP",
                "Eastern": "GH-EP",
                "Northern": "GH-NP",
                "Volta": "GH-TV",
                "Central": "GH-CP",
                "Upper East": "GH-UE",
                "Upper West": "GH-UW",
                "Brong Ahafo": "GH-BA",
                "Brong-Ahafo": "GH-BA",

                // Alternative names that might appear in geodata
                "GREATER ACCRA": "GH-AA",
                "ASHANTI": "GH-AH",
                "WESTERN": "GH-WP",
                "EASTERN": "GH-EP",
                "NORTHERN": "GH-NP",
                "VOLTA": "GH-TV",
                "CENTRAL": "GH-CP",
                "UPPER EAST": "GH-UE",
                "UPPER WEST": "GH-UW",
                "BRONG AHAFO": "GH-BA",
                "BRONG-AHAFO": "GH-BA",

                // Possible short names
                "Accra": "GH-AA",
                "Kumasi": "GH-AH",
                "Takoradi": "GH-WP"
            };

            // Try exact match first
            if (nameMap[name]) {
                console.log('Found exact match:', nameMap[name]);
                return nameMap[name];
            }

            // Try case-insensitive match
            const upperName = name?.toUpperCase();
            if (upperName && nameMap[upperName]) {
                console.log('Found case-insensitive match:', nameMap[upperName]);
                return nameMap[upperName];
            }

            // Try partial match
            for (const [key, value] of Object.entries(nameMap)) {
                if (name && key.toLowerCase().includes(name.toLowerCase())) {
                    console.log('Found partial match:', value);
                    return value;
                }
            }

            // Return the ID if it looks like a region code
            if (id && id.startsWith('GH-')) {
                console.log('Using provided ID:', id);
                return id;
            }

            console.log('No match found, returning null');
            return null;
        }

        function showRegionInfo(regionName, regionId) {
            console.log('Showing generic region info for:', regionName);
            const sidebar = document.getElementById('district-info');
            if (sidebar) {
                sidebar.innerHTML = `
                    <div class="info-card">
                        <div class="card-header">
                            <button onclick="showNoSelection()" style="float: right; background: #333; color: #ccc; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">â† Back</button>
                            <h3 style="margin: 0; color: #F97316; font-size: 18px;">ðŸ“ ${regionName || 'Selected Region'}</h3>
                            <p style="margin: 8px 0 0 0; color: #999; font-size: 14px;">Region Information</p>
                        </div>
                        
                        <div class="region-stats" style="margin: 20px 0;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                <div class="stat-item">
                                    <div class="stat-number" style="color: #4CAF50; font-size: 20px; font-weight: bold;">${Math.floor(Math.random() * 30) + 15}</div>
                                    <div class="stat-label" style="color: #ccc; font-size: 12px;">Districts</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number" style="color: #2196F3; font-size: 20px; font-weight: bold;">${Math.floor(Math.random() * 200) + 100}</div>
                                    <div class="stat-label" style="color: #ccc; font-size: 12px;">Transformers</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number" style="color: #FF9800; font-size: 20px; font-weight: bold;">${Math.floor(Math.random() * 50) + 30}</div>
                                    <div class="stat-label" style="color: #ccc; font-size: 12px;">Zones</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number" style="color: #F97316; font-size: 20px; font-weight: bold;">${Math.floor(Math.random() * 20) + 75}%</div>
                                    <div class="stat-label" style="color: #ccc; font-size: 12px;">Health</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 16px; background: #2a2a2a; border-radius: 8px; border-left: 4px solid #F97316;">
                            <h4 style="margin: 0 0 8px 0; color: #F97316; font-size: 14px;">Region Details</h4>
                            <div style="font-size: 12px; color: #ccc; line-height: 1.6;">
                                <div><strong>Region Name:</strong> ${regionName || 'Unknown'}</div>
                                <div><strong>Region ID:</strong> ${regionId || 'Not available'}</div>
                                <div><strong>Status:</strong> <span style="color: #4CAF50;">Active</span></div>
                                <div><strong>Last Updated:</strong> ${new Date().toLocaleDateString()}</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4 style="margin: 0 0 12px 0; color: #F97316; font-size: 14px;">Infrastructure Overview</h4>
                            <div style="font-size: 12px; color: #999;">
                                <div style="margin: 8px 0; padding: 8px; background: #2a2a2a; border-radius: 4px;">
                                    <span style="color: #4CAF50;">â—</span> Power distribution network operational
                                </div>
                                <div style="margin: 8px 0; padding: 8px; background: #2a2a2a; border-radius: 4px;">
                                    <span style="color: #2196F3;">â—</span> Smart grid monitoring active
                                </div>
                                <div style="margin: 8px 0; padding: 8px; background: #2a2a2a; border-radius: 4px;">
                                    <span style="color: #FF9800;">â—</span> Maintenance schedule up to date
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Comprehensive Ghana Infrastructure Data Structure
        const ghanaInfrastructureData = {
            "GH-AA": {
                name: "Greater Accra",
                population: "5.4M",
                area: "3,245 kmÂ²",
                gridHealth: "92%",
                totalTransformers: 342,
                districts: {
                    "Accra Metropolitan": {
                        type: "urban",
                        population: "2.3M",
                        places: {
                            "Urban": ["Osu", "Adabraka", "Dzorwulu"],
                            "Peri-Urban": ["Dansoman", "Kaneshie", "Achimota"],
                            "Rural": ["Abokobi", "Oyarifa", "Pokuase"]
                        }
                    },
                    "Tema Metropolitan": {
                        type: "industrial",
                        population: "402K",
                        places: {
                            "Urban": ["Tema New Town", "Community 1", "Community 4"],
                            "Peri-Urban": ["Ashaiman", "Kpone", "Dawhenya"],
                            "Rural": ["Prampram", "Sege", "Ada Foah"]
                        }
                    },
                    "Ga East Municipal": {
                        type: "mixed",
                        population: "259K",
                        places: {
                            "Urban": ["Madina", "Adenta", "Pantang"],
                            "Peri-Urban": ["Dome", "Taifa", "Kwabenya"],
                            "Rural": ["Abokobi", "Boi", "Amrahia"]
                        }
                    }
                }
            },
            "GH-AH": {
                name: "Ashanti",
                population: "5.8M",
                area: "24,389 kmÂ²",
                gridHealth: "88%",
                totalTransformers: 298,
                districts: {
                    "Kumasi Metropolitan": {
                        type: "urban",
                        population: "3.3M",
                        places: {
                            "Urban": ["Kejetia", "Adum", "Bantama"],
                            "Peri-Urban": ["Suame", "Tafo", "Ejisu"],
                            "Rural": ["Besease", "Ahwiaa", "Ntonso"]
                        }
                    },
                    "Obuasi Municipal": {
                        type: "mining",
                        population: "175K",
                        places: {
                            "Urban": ["Obuasi Town", "Adansi", "Tutuka"],
                            "Peri-Urban": ["Brahabebome", "Sanso", "Bogoso"],
                            "Rural": ["Kwabenakwa", "Anyinam", "Dunkwa"]
                        }
                    },
                    "Ejisu Municipal": {
                        type: "agricultural",
                        population: "143K",
                        places: {
                            "Urban": ["Ejisu", "Besease", "Fumesua"],
                            "Peri-Urban": ["Onwe", "Kwaso", "Achiase"],
                            "Rural": ["Yawkwei", "Bonwire", "Adukrom"]
                        }
                    }
                }
            },
            "GH-WP": {
                name: "Western",
                population: "2.6M",
                area: "23,921 kmÂ²",
                gridHealth: "85%",
                totalTransformers: 156,
                districts: {
                    "Sekondi-Takoradi Metropolitan": {
                        type: "port",
                        population: "445K",
                        places: {
                            "Urban": ["Sekondi", "Takoradi", "Effia-Kuma"],
                            "Peri-Urban": ["Kansaworodo", "Anaji", "Kwesimintsim"],
                            "Rural": ["Shama", "Inchaban", "Aboadze"]
                        }
                    },
                    "Tarkwa-Nsuaem Municipal": {
                        type: "mining",
                        population: "139K",
                        places: {
                            "Urban": ["Tarkwa", "Nsuta", "Huni-Valley"],
                            "Peri-Urban": ["Bogoso", "Prestea", "Dumasi"],
                            "Rural": ["Wassa Akropong", "Benso", "Simpa"]
                        }
                    },
                    "Prestea Huni-Valley": {
                        type: "mining",
                        population: "159K",
                        places: {
                            "Urban": ["Prestea", "Huni-Valley", "Bogoso"],
                            "Peri-Urban": ["Dumasi", "Teberebie", "Bondaye"],
                            "Rural": ["Wassa Dunkwa", "Wassa Japa", "Benso"]
                        }
                    }
                }
            }
        };

        // Generate transformer and customer data
        function generateTransformerData(regionId, district, placeType, placeName) {
            const transformerCount = Math.floor(Math.random() * 5) + 3; // 3-7 transformers per place
            const transformers = [];

            for (let i = 0; i < transformerCount; i++) {
                const transformerId = `TR-${regionId.split('-')[1]}-${String(i + 1).padStart(3, '0')}`;
                const singlePhaseMeters = Math.floor(Math.random() * 50) + 20;
                const threePhaseMeters = Math.floor(Math.random() * 15) + 5;
                const monitoringNodes = Math.floor(Math.random() * 3) + 2;

                transformers.push({
                    id: transformerId,
                    name: `${placeName} Primary Transformer ${i + 1}`,
                    gpsAddress: generateGPSAddress(regionId, placeName),
                    status: Math.random() > 0.1 ? 'Active' : 'Maintenance',
                    load: Math.floor(Math.random() * 40) + 60,
                    singlePhaseMeters,
                    threePhaseMeters,
                    monitoringNodes,
                    customers: generateCustomerData(singlePhaseMeters + threePhaseMeters, transformerId, monitoringNodes)
                });
            }

            return transformers;
        }

        function generateGPSAddress(regionId, placeName) {
            // Generate realistic GPS coordinates for Ghana regions
            const coordinates = {
                "GH-AA": { lat: 5.6037, lng: -0.1870 }, // Greater Accra
                "GH-AH": { lat: 6.6885, lng: -1.6244 }, // Ashanti
                "GH-WP": { lat: 4.8960, lng: -1.7756 }  // Western
            };

            const base = coordinates[regionId] || coordinates["GH-AA"];
            const lat = base.lat + (Math.random() - 0.5) * 0.5;
            const lng = base.lng + (Math.random() - 0.5) * 0.5;

            return `${lat.toFixed(6)}Â°N, ${lng.toFixed(6)}Â°W`;
        }

        function generateCustomerData(meterCount, transformerId, nodeCount) {
            const customers = [];
            const ghanaNames = [
                "Kwame Asante", "Ama Osei", "Kofi Mensah", "Akosua Boateng", "Yaw Oppong",
                "Efua Adjei", "Kwaku Owusu", "Adwoa Frimpong", "Kojo Antwi", "Abena Sarpong",
                "Kwesi Darko", "Akua Gyasi", "Fiifi Amoah", "Esi Appiah", "Kwabena Nkrumah"
            ];

            for (let i = 0; i < meterCount; i++) {
                const name = ghanaNames[Math.floor(Math.random() * ghanaNames.length)];
                const meterType = Math.random() > 0.7 ? '3-Phase' : 'Single-Phase';
                const nodeId = `MN-${String(Math.floor(Math.random() * nodeCount) + 1).padStart(3, '0')}`;
                const ghanaCardId = `GHA-${Math.floor(Math.random() * 900000000) + 100000000}`;

                customers.push({
                    id: `CUST-${String(i + 1).padStart(4, '0')}`,
                    name,
                    meterNumber: `SM-${transformerId.split('-')[1]}-${String(i + 1).padStart(4, '0')}`,
                    meterType,
                    monitoringNode: nodeId,
                    ghanaCard: ghanaCardId,
                    phone: `+233 ${Math.floor(Math.random() * 900000000) + 100000000}`,
                    emergencyContact: {
                        name: ghanaNames[Math.floor(Math.random() * ghanaNames.length)],
                        phone: `+233 ${Math.floor(Math.random() * 900000000) + 100000000}`,
                        relationship: ['Spouse', 'Parent', 'Sibling', 'Friend', 'Neighbor'][Math.floor(Math.random() * 5)]
                    },
                    address: generateCustomerAddress(),
                    consumption: Math.floor(Math.random() * 300) + 50,
                    status: Math.random() > 0.05 ? 'Active' : 'Inactive'
                });
            }

            return customers;
        }

        function generateCustomerAddress() {
            const areas = ["Residential Area", "Commercial District", "Industrial Zone", "Mixed Development"];
            const streets = ["Main Street", "Market Road", "Station Road", "School Lane", "Church Street"];

            return `${areas[Math.floor(Math.random() * areas.length)]}, ${streets[Math.floor(Math.random() * streets.length)]}`;
        }

        // Enhanced sidebar functions with card-style design and dummy data
        function showNoSelection() {
            console.log('ðŸ”„ showNoSelection called - initializing sidebar...');
            const sidebar = document.getElementById('district-info');
            console.log('Sidebar element found:', !!sidebar);
            if (sidebar) {
                console.log('Setting sidebar innerHTML...');
                sidebar.innerHTML = `
                    <div class="info-card">
                        <div class="card-header" style="text-align: center; padding: 20px; border-bottom: 1px solid #333;">
                            <h3 style="margin: 0; color: #F97316; font-size: 20px;">ðŸ‡¬ðŸ‡­ Ghana Regions</h3>
                            <p style="margin: 8px 0 0 0; color: #999; font-size: 14px;">Select a region to explore</p>
                        </div>
                        
                        <div style="padding: 20px;">
                            <div style="display: flex; flex-direction: column; gap: 16px;">
                                
                                <!-- Greater Accra Region -->
                                <div style="padding: 20px; background: linear-gradient(135deg, #2a2a2a, #333); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; border: 2px solid transparent;" 
                                     onmouseover="this.style.borderColor='#F97316'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(249, 115, 22, 0.3)'" 
                                     onmouseout="this.style.borderColor='transparent'; this.style.transform='translateY(0)'; this.style.boxShadow='none'"
                                     onclick="showRegionDistricts('GH-AA')">
                                    <div style="display: flex; align-items: center; gap: 16px;">
                                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #F97316, #FF6B35); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                                            ðŸ™ï¸
                                        </div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: bold; color: #fff; font-size: 18px; margin-bottom: 4px;">Greater Accra</div>
                                            <div style="font-size: 13px; color: #ccc;">Capital Region â€¢ 342 Transformers</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="background: #4CAF50; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; margin-bottom: 4px;">
                                                92%
                                            </div>
                                            <div style="font-size: 10px; color: #4CAF50;">Healthy</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Ashanti Region -->
                                <div style="padding: 20px; background: linear-gradient(135deg, #2a2a2a, #333); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; border: 2px solid transparent;" 
                                     onmouseover="this.style.borderColor='#4CAF50'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(76, 175, 80, 0.3)'" 
                                     onmouseout="this.style.borderColor='transparent'; this.style.transform='translateY(0)'; this.style.boxShadow='none'"
                                     onclick="showRegionDistricts('GH-AH')">
                                    <div style="display: flex; align-items: center; gap: 16px;">
                                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #4CAF50, #66BB6A); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                                            â›ï¸
                                        </div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: bold; color: #fff; font-size: 18px; margin-bottom: 4px;">Ashanti</div>
                                            <div style="font-size: 13px; color: #ccc;">Mining Region â€¢ 298 Transformers</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="background: #FF9800; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; margin-bottom: 4px;">
                                                88%
                                            </div>
                                            <div style="font-size: 10px; color: #FF9800;">Good</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Western Region -->
                                <div style="padding: 20px; background: linear-gradient(135deg, #2a2a2a, #333); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; border: 2px solid transparent;" 
                                     onmouseover="this.style.borderColor='#2196F3'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(33, 150, 243, 0.3)'" 
                                     onmouseout="this.style.borderColor='transparent'; this.style.transform='translateY(0)'; this.style.boxShadow='none'"
                                     onclick="showRegionDistricts('GH-WP')">
                                    <div style="display: flex; align-items: center; gap: 16px;">
                                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #2196F3, #42A5F5); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                                            ðŸš¢
                                        </div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: bold; color: #fff; font-size: 18px; margin-bottom: 4px;">Western</div>
                                            <div style="font-size: 13px; color: #ccc;">Coastal Region â€¢ 156 Transformers</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="background: #FF9800; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; margin-bottom: 4px;">
                                                85%
                                            </div>
                                            <div style="font-size: 10px; color: #FF9800;">Good</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 25px; padding: 16px; background: #1a1a1a; border-radius: 8px; border-left: 4px solid #F97316;">
                                <p style="margin: 0; color: #ccc; font-size: 14px; line-height: 1.5;">
                                    <strong style="color: #F97316;">ðŸ’¡ Navigation:</strong><br>
                                    Click any region above to explore districts â†’ places â†’ transformers â†’ customers
                                </p>
                            </div>
                        </div>
                    </div>
                `;
                console.log('âœ… Sidebar content set successfully');
            } else {
                console.error('âŒ Sidebar element not found!');
            }
        }

        function showRegionDistricts(regionId) {
            console.log('Showing districts for region:', regionId);
            const sidebar = document.getElementById('district-info');
            if (sidebar) {
                const regionData = ghanaInfrastructureData[regionId];
                if (!regionData) {
                    showRegionInfo(regionId, regionId);
                    return;
                }

                sidebar.innerHTML = `
                    <div class="info-card">
                        <div class="card-header">
                            <button onclick="showNoSelection()" style="float: right; background: #333; color: #ccc; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">â† Back</button>
                            <h3 style="margin: 0; color: #F97316; font-size: 18px;">ðŸ“ ${regionData.name} Region</h3>
                            <p style="margin: 8px 0 0 0; color: #999; font-size: 14px;">Population: ${regionData.population} â€¢ Area: ${regionData.area}</p>
                        </div>
                        
                        <div class="region-stats" style="margin: 20px 0;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                <div class="stat-item">
                                    <div class="stat-number" style="color: #4CAF50; font-size: 20px; font-weight: bold;">${Object.keys(regionData.districts).length}</div>
                                    <div class="stat-label" style="color: #ccc; font-size: 12px;">Districts</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number" style="color: #2196F3; font-size: 20px; font-weight: bold;">${regionData.totalTransformers}</div>
                                    <div class="stat-label" style="color: #ccc; font-size: 12px;">Transformers</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number" style="color: #FF9800; font-size: 20px; font-weight: bold;">9</div>
                                    <div class="stat-label" style="color: #ccc; font-size: 12px;">Zones</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number" style="color: #F97316; font-size: 20px; font-weight: bold;">${regionData.gridHealth}</div>
                                    <div class="stat-label" style="color: #ccc; font-size: 12px;">Grid Health</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="districts-list" style="margin-top: 20px;">
                            <h4 style="margin: 0 0 12px 0; color: #F97316; font-size: 16px;">Districts</h4>
                            <div style="max-height: 300px; overflow-y: auto;">
                                ${Object.entries(regionData.districts).map(([districtName, districtData]) => `
                                    <div style="margin: 8px 0; padding: 12px; background: #2a2a2a; border-radius: 6px; cursor: pointer; transition: all 0.2s;" 
                                         onmouseover="this.style.background='#333'; this.style.transform='translateX(4px)'" 
                                         onmouseout="this.style.background='#2a2a2a'; this.style.transform='translateX(0)'"
                                         onclick="showDistrictPlaces('${regionId}', '${districtName}')">
                                        <div style="font-weight: bold; color: #fff; font-size: 14px;">${districtName}</div>
                                        <div style="font-size: 12px; color: #999; margin-top: 4px;">
                                            Population: ${districtData.population} â€¢ Type: ${districtData.type}
                                        </div>
                                        <div style="font-size: 11px; color: #666; margin-top: 2px;">
                                            Click to view places â†’
                                        </div>
                                    </div>
                                `).join('')}
                                
                                <div style="margin: 8px 0; padding: 12px; background: #2a2a2a; border-radius: 6px; cursor: pointer; transition: all 0.2s; border: 1px dashed #666;" 
                                     onmouseover="this.style.background='#333'; this.style.borderColor='#F97316'" 
                                     onmouseout="this.style.background='#2a2a2a'; this.style.borderColor='#666'"
                                     onclick="showDevelopmentMessage()">
                                    <div style="font-weight: bold; color: #FF9800; font-size: 14px;">+ Other Districts</div>
                                    <div style="font-size: 12px; color: #999; margin-top: 4px;">
                                        Development in Progress...
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="power-status" style="margin-top: 20px; padding: 16px; background: #2a2a2a; border-radius: 8px; border-left: 4px solid ${regionData.gridHealth.replace('%', '') > 85 ? '#4CAF50' : '#FF9800'};">
                            <h4 style="margin: 0 0 8px 0; color: #F97316; font-size: 14px;">Regional Power Status</h4>
                            <div style="font-size: 12px; color: #ccc; line-height: 1.6;">
                                <div><strong>Grid Health:</strong> ${regionData.gridHealth}</div>
                                <div><strong>Active Transformers:</strong> ${Math.floor(regionData.totalTransformers * 0.94)}</div>
                                <div><strong>Last Update:</strong> ${new Date().toLocaleTimeString()}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function showAvailableRegions() {
            console.log('Showing available regions');
            showNoSelection();
        }

        function generateRegionData(regionName) {
            // Generate realistic dummy data based on region
            const baseData = {
                "Greater Accra": { districts: 29, transformers: 342, zones: 85, health: 92, currentLoad: 450, capacity: 520, efficiency: 87 },
                "Ashanti": { districts: 43, transformers: 298, zones: 76, health: 88, currentLoad: 380, capacity: 440, efficiency: 86 },
                "Western": { districts: 22, transformers: 156, zones: 45, health: 85, currentLoad: 220, capacity: 280, efficiency: 79 },
                "Eastern": { districts: 33, transformers: 187, zones: 52, health: 89, currentLoad: 280, capacity: 320, efficiency: 88 },
                "Northern": { districts: 28, transformers: 134, zones: 38, health: 82, currentLoad: 180, capacity: 240, efficiency: 75 },
                "Volta": { districts: 25, transformers: 145, zones: 41, health: 86, currentLoad: 200, capacity: 260, efficiency: 77 },
                "Central": { districts: 22, transformers: 167, zones: 48, health: 87, currentLoad: 240, capacity: 290, efficiency: 83 },
                "Upper East": { districts: 15, transformers: 89, zones: 28, health: 79, currentLoad: 120, capacity: 160, efficiency: 75 },
                "Upper West": { districts: 11, transformers: 67, zones: 22, health: 81, currentLoad: 95, capacity: 130, efficiency: 73 },
                "Brong Ahafo": { districts: 27, transformers: 178, zones: 51, health: 84, currentLoad: 250, capacity: 310, efficiency: 81 }
            };

            const data = baseData[regionName] || baseData["Greater Accra"];

            // Generate major districts
            const districtTemplates = {
                "Greater Accra": ["Accra Metropolitan", "Tema Metropolitan", "Ga East Municipal", "Ga West Municipal"],
                "Ashanti": ["Kumasi Metropolitan", "Obuasi Municipal", "Ejisu Municipal", "Bekwai Municipal"],
                "Western": ["Sekondi-Takoradi Metropolitan", "Tarkwa-Nsuaem Municipal", "Prestea Huni-Valley", "Ellembelle"],
                "Eastern": ["New-Juaben Municipal", "Akuapem North Municipal", "West Akim Municipal", "Kwahu West Municipal"],
                "Northern": ["Tamale Metropolitan", "Yendi Municipal", "Savelugu Municipal", "Gushegu Municipal"]
            };

            const districts = districtTemplates[regionName] || districtTemplates["Greater Accra"];

            data.majorDistricts = districts.map(name => ({
                name,
                transformers: Math.floor(Math.random() * 50) + 20,
                status: Math.random() > 0.8 ? "Maintenance" : Math.random() > 0.9 ? "Alert" : "Operational"
            }));

            return data;
        }

        function showDevelopmentMessage() {
            showModal('Development in Progress', `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">ðŸš§</div>
                    <h3 style="color: #FF9800; margin-bottom: 16px;">Other Districts</h3>
                    <p style="color: #ccc; line-height: 1.6; margin-bottom: 20px;">
                        Additional districts are currently being integrated into the PowerGridX system. 
                        Our team is working to expand coverage across all regions of Ghana.
                    </p>
                    <div style="background: #2a2a2a; padding: 16px; border-radius: 8px; margin-top: 20px;">
                        <h4 style="color: #F97316; margin: 0 0 12px 0;">Coming Soon:</h4>
                        <ul style="text-align: left; color: #ccc; font-size: 14px; line-height: 1.8;">
                            <li>Complete district mapping</li>
                            <li>Enhanced transformer monitoring</li>
                            <li>Advanced analytics dashboard</li>
                            <li>Real-time fault detection</li>
                        </ul>
                    </div>
                </div>
            `);
        }

        function showDistrictPlaces(regionId, districtName) {
            console.log('Showing places for district:', districtName, 'in region:', regionId);
            const sidebar = document.getElementById('district-info');
            if (sidebar) {
                const regionData = ghanaInfrastructureData[regionId];
                const districtData = regionData?.districts[districtName];

                if (!districtData) {
                    showDevelopmentMessage();
                    return;
                }

                sidebar.innerHTML = `
                    <div class="info-card">
                        <div class="card-header">
                            <button onclick="showRegionDistricts('${regionId}')" style="float: right; background: #333; color: #ccc; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">â† Back</button>
                            <h3 style="margin: 0; color: #F97316; font-size: 16px;">ðŸ¢ ${districtName}</h3>
                            <p style="margin: 8px 0 0 0; color: #999; font-size: 14px;">Population: ${districtData.population} â€¢ Type: ${districtData.type}</p>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <h4 style="margin: 0 0 12px 0; color: #F97316; font-size: 16px;">Place Categories</h4>
                            <div style="max-height: 400px; overflow-y: auto;">
                                ${Object.entries(districtData.places).map(([placeType, places]) => `
                                    <div style="margin: 12px 0; padding: 16px; background: #2a2a2a; border-radius: 8px; cursor: pointer; transition: all 0.2s;" 
                                         onmouseover="this.style.background='#333'; this.style.transform='translateX(4px)'" 
                                         onmouseout="this.style.background='#2a2a2a'; this.style.transform='translateX(0)'"
                                         onclick="showPlacesList('${regionId}', '${districtName}', '${placeType}')">
                                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                            <div style="font-size: 24px;">
                                                ${placeType === 'Urban' ? 'ðŸ™ï¸' : placeType === 'Peri-Urban' ? 'ðŸ˜ï¸' : 'ðŸŒ¾'}
                                            </div>
                                            <div>
                                                <div style="font-weight: bold; color: #fff; font-size: 16px;">${placeType}</div>
                                                <div style="font-size: 12px; color: #999;">${places.length} places available</div>
                                            </div>
                                        </div>
                                        <div style="font-size: 11px; color: #666;">
                                            Click to view ${placeType.toLowerCase()} places â†’
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 16px; background: #2a2a2a; border-radius: 8px;">
                            <h4 style="margin: 0 0 12px 0; color: #F97316; font-size: 14px;">District Summary</h4>
                            <div style="font-size: 12px; color: #ccc; line-height: 1.6;">
                                <div><strong>Total Places:</strong> ${Object.values(districtData.places).flat().length}</div>
                                <div><strong>Estimated Transformers:</strong> ${Math.floor(Math.random() * 50) + 20}</div>
                                <div><strong>Coverage:</strong> <span style="color: #4CAF50;">94.2%</span></div>
                                <div><strong>Status:</strong> <span style="color: #4CAF50;">Operational</span></div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function showPlacesList(regionId, districtName, placeType) {
            console.log('Showing places list:', placeType, 'in', districtName);
            const sidebar = document.getElementById('district-info');
            if (sidebar) {
                const regionData = ghanaInfrastructureData[regionId];
                const places = regionData?.districts[districtName]?.places[placeType] || [];

                sidebar.innerHTML = `
                    <div class="info-card">
                        <div class="card-header">
                            <button onclick="showDistrictPlaces('${regionId}', '${districtName}')" style="float: right; background: #333; color: #ccc; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">â† Back</button>
                            <h3 style="margin: 0; color: #F97316; font-size: 16px;">
                                ${placeType === 'Urban' ? 'ðŸ™ï¸' : placeType === 'Peri-Urban' ? 'ðŸ˜ï¸' : 'ðŸŒ¾'} ${placeType} Places
                            </h3>
                            <p style="margin: 8px 0 0 0; color: #999; font-size: 14px;">${districtName} District</p>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <h4 style="margin: 0 0 12px 0; color: #F97316; font-size: 16px;">Available Places</h4>
                            <div style="max-height: 400px; overflow-y: auto;">
                                ${places.map((placeName, index) => `
                                    <div style="margin: 8px 0; padding: 14px; background: #2a2a2a; border-radius: 6px; cursor: pointer; transition: all 0.2s;" 
                                         onmouseover="this.style.background='#333'; this.style.transform='translateX(4px)'" 
                                         onmouseout="this.style.background='#2a2a2a'; this.style.transform='translateX(0)'"
                                         onclick="showPlaceTransformers('${regionId}', '${districtName}', '${placeType}', '${placeName}')">
                                        <div style="font-weight: bold; color: #fff; font-size: 14px;">${placeName}</div>
                                        <div style="font-size: 12px; color: #999; margin-top: 4px;">
                                            ${Math.floor(Math.random() * 5) + 3} transformers â€¢ ${Math.floor(Math.random() * 200) + 50} customers
                                        </div>
                                        <div style="font-size: 11px; color: #666; margin-top: 2px;">
                                            Click to view transformers â†’
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 16px; background: #2a2a2a; border-radius: 8px;">
                            <h4 style="margin: 0 0 12px 0; color: #F97316; font-size: 14px;">${placeType} Area Info</h4>
                            <div style="font-size: 12px; color: #ccc; line-height: 1.6;">
                                <div><strong>Category:</strong> ${placeType}</div>
                                <div><strong>Places Count:</strong> ${places.length}</div>
                                <div><strong>Infrastructure:</strong> ${placeType === 'Urban' ? 'High Density' : placeType === 'Peri-Urban' ? 'Medium Density' : 'Low Density'}</div>
                                <div><strong>Grid Priority:</strong> ${placeType === 'Urban' ? 'Critical' : placeType === 'Peri-Urban' ? 'High' : 'Standard'}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function showPlaceTransformers(regionId, districtName, placeType, placeName) {
            console.log('Showing transformers for place:', placeName);
            const sidebar = document.getElementById('district-info');
            if (sidebar) {
                const transformers = generateTransformerData(regionId, districtName, placeType, placeName);

                sidebar.innerHTML = `
                    <div class="info-card">
                        <div class="card-header">
                            <button onclick="showPlacesList('${regionId}', '${districtName}', '${placeType}')" style="float: right; background: #333; color: #ccc; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">â† Back</button>
                            <h3 style="margin: 0; color: #F97316; font-size: 16px;">âš¡ ${placeName}</h3>
                            <p style="margin: 8px 0 0 0; color: #999; font-size: 14px;">${placeType} â€¢ ${districtName}</p>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <h4 style="margin: 0 0 12px 0; color: #F97316; font-size: 16px;">Transformers (${transformers.length})</h4>
                            <div style="max-height: 400px; overflow-y: auto;">
                                ${transformers.map(transformer => `
                                    <div style="margin: 8px 0; padding: 14px; background: #2a2a2a; border-radius: 6px; cursor: pointer; transition: all 0.2s; border-left: 4px solid ${transformer.status === 'Active' ? '#4CAF50' : '#FF9800'};" 
                                         onmouseover="this.style.background='#333'; this.style.transform='translateX(4px)'" 
                                         onmouseout="this.style.background='#2a2a2a'; this.style.transform='translateX(0)'"
                                         onclick="goToTransformerPage('${transformer.id}')">
                                        <div style="font-weight: bold; color: #fff; font-size: 14px;">${transformer.name}</div>
                                        <div style="font-size: 12px; color: #999; margin-top: 4px;">
                                            ID: ${transformer.id} â€¢ Load: ${transformer.load}% â€¢ Status: ${transformer.status}
                                        </div>
                                        <div style="font-size: 11px; color: #666; margin-top: 4px;">
                                            ðŸ“ ${transformer.gpsAddress}
                                        </div>
                                        <div style="font-size: 11px; color: #4CAF50; margin-top: 2px;">
                                            Click to view in Transformers section â†’
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 16px; background: #2a2a2a; border-radius: 8px;">
                            <h4 style="margin: 0 0 12px 0; color: #F97316; font-size: 14px;">Place Summary</h4>
                            <div style="font-size: 12px; color: #ccc; line-height: 1.6;">
                                <div><strong>Total Transformers:</strong> ${transformers.length}</div>
                                <div><strong>Active:</strong> ${transformers.filter(t => t.status === 'Active').length}</div>
                                <div><strong>Total Customers:</strong> ${transformers.reduce((sum, t) => sum + t.singlePhaseMeters + t.threePhaseMeters, 0)}</div>
                                <div><strong>Monitoring Nodes:</strong> ${transformers.reduce((sum, t) => sum + t.monitoringNodes, 0)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function goToTransformerPage(transformerId) {
            console.log('Navigating to transformer page for:', transformerId);

            // Store the transformer ID for the transformers page
            window.selectedTransformerId = transformerId;

            // Switch to transformers view
            showView('transformers');

            // Small delay to ensure view is loaded, then show transformer details
            setTimeout(() => {
                showTransformerDetails(transformerId);
            }, 500);
        }

        function loadDashboard() {
            console.log('ðŸ”„ Loading/Reloading PowerGridX dashboard...');

            // Clear any existing dashboard content first
            const dashboardView = document.getElementById('dashboard-view');
            if (dashboardView) {
                dashboardView.innerHTML = '';

                // Reset any inline styles that might have been applied
                dashboardView.style.cssText = '';
                dashboardView.className = 'view-container active full-screen';
            }

            // Small delay to ensure clean state
            setTimeout(() => {
                // Always show the custom dashboard with fresh data
                showCustomDashboard();

                // Start live simulation after dashboard loads
                setTimeout(() => {
                    // Clear any existing intervals first
                    if (window.dashboardIntervals) {
                        window.dashboardIntervals.forEach(interval => clearInterval(interval));
                    }
                    window.dashboardIntervals = [];

                    startLiveSimulation();
                }, 500);

                dashboardLoaded = true;
                console.log('âœ… Dashboard loaded successfully');
            }, 100);
        }

        function showCustomDashboard() {
            const dashboardView = document.getElementById('dashboard-view');
            dashboardView.innerHTML = `
                <div style="padding: 24px; background: #f8f9fa; height: 100%; overflow-y: auto;">
                    <!-- Dashboard Header -->
                    <div style="margin-bottom: 32px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h1 style="color: #1f2937; margin: 0 0 8px 0; font-size: 28px; font-weight: 700; display: flex; align-items: center; gap: 12px;">
                                PowerGridX Dashboard
                                <span class="live-indicator"></span>
                                <span style="font-size: 14px; color: #4CAF50; font-weight: 500;">LIVE</span>
                            </h1>
                            <p style="color: #6b7280; margin: 0; font-size: 16px;">Real-time IoT monitoring and analytics</p>
                        </div>
                        <div style="text-align: right;">
                            <div id="last-update" style="color: #999; font-size: 12px; margin-bottom: 4px;">Last updated: ${new Date().toLocaleTimeString()}</div>
                            <div style="color: #4CAF50; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                                <span style="width: 8px; height: 8px; background: #4CAF50; border-radius: 50%; display: inline-block; animation: pulse 2s infinite;"></span>
                                Cloud Connected â€¢ ${1247 + Math.floor(Math.random() * 10)} meters online
                            </div>
                        </div>
                    </div>

                    <!-- Key Metrics Grid -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 32px;">
                        <!-- Total Energy Tracked -->
                        <div id="energy-card" style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #3b82f6; cursor: pointer; transition: all 0.3s ease;" 
                             onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.15)'" 
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'"
                             onclick="showEnergyDetails()">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                                <div style="color: #6b7280; font-size: 14px; font-weight: 500;">Total Energy Tracked</div>
                                <div id="energy-trend" style="background: #dcfce7; color: #16a34a; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <span>â†—</span> <span id="energy-change">2.1%</span> from last hour
                                </div>
                            </div>
                            <div id="energy-value" style="font-size: 32px; font-weight: 700; color: #1f2937; margin-bottom: 4px;">2829.8 kWh</div>
                        </div>

                        <!-- Energy Theft Detected -->
                        <div id="theft-card" style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #ef4444; cursor: pointer; transition: all 0.3s ease;"
                             onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.15)'" 
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'"
                             onclick="showTheftDetails()">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                                <div style="color: #6b7280; font-size: 14px; font-weight: 500;">Energy Theft Detected</div>
                                <div id="theft-trend" style="background: #fef2f2; color: #dc2626; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <span>â†˜</span> <span id="theft-change">0.8%</span> from last hour
                                </div>
                            </div>
                            <div id="theft-value" style="font-size: 32px; font-weight: 700; color: #1f2937; margin-bottom: 4px;">12.6%</div>
                        </div>

                        <!-- Smart Poles Connected -->
                        <div id="poles-card" style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #10b981; cursor: pointer; transition: all 0.3s ease;"
                             onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.15)'" 
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'"
                             onclick="showPolesDetails()">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                                <div style="color: #6b7280; font-size: 14px; font-weight: 500;">Smart Poles Connected</div>
                                <div id="poles-trend" style="background: #dcfce7; color: #16a34a; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                    <span>â†—</span> <span id="poles-change">1.2%</span> from last hour
                                </div>
                            </div>
                            <div id="poles-value" style="font-size: 32px; font-weight: 700; color: #1f2937; margin-bottom: 4px;">60</div>
                        </div>

                        <!-- Active Alerts -->
                        <div id="alerts-card" style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #f59e0b; cursor: pointer; transition: all 0.3s ease;"
                             onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.15)'" 
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'"
                             onclick="showAlertsDetails()">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                                <div style="color: #6b7280; font-size: 14px; font-weight: 500;">Active Alerts</div>
                            </div>
                            <div id="alerts-value" style="font-size: 32px; font-weight: 700; color: #1f2937; margin-bottom: 4px;">2</div>
                            <div style="color: #6b7280; font-size: 12px;">Current system notifications</div>
                        </div>
                    </div>

                    <!-- Charts Grid -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <!-- Energy Tracking Chart -->
                        <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s ease;"
                             onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.15)'" 
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'"
                             onclick="showEnergyTrackingDetails()">
                            <h3 style="color: #1f2937; margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">Energy Tracking (24h)</h3>
                            <p style="color: #6b7280; margin: 0 0 24px 0; font-size: 14px;">Total energy tracked vs theft detected</p>
                            
                            <!-- Chart Container -->
                            <div style="position: relative; height: 300px; background: #f9fafb; border-radius: 8px; padding: 20px;">
                                <!-- Y-axis labels -->
                                <div style="position: absolute; left: 0; top: 20px; bottom: 40px; width: 40px; display: flex; flex-direction: column; justify-content: space-between; font-size: 12px; color: #6b7280;">
                                    <span>600</span>
                                    <span>450</span>
                                    <span>300</span>
                                    <span>150</span>
                                    <span>0</span>
                                </div>
                                
                                <!-- Chart area -->
                                <div style="margin-left: 50px; height: 240px; position: relative; border-bottom: 1px solid #e5e7eb; border-left: 1px solid #e5e7eb;">
                                    <!-- Grid lines -->
                                    <div style="position: absolute; width: 100%; height: 1px; background: #f3f4f6; top: 0;"></div>
                                    <div style="position: absolute; width: 100%; height: 1px; background: #f3f4f6; top: 25%;"></div>
                                    <div style="position: absolute; width: 100%; height: 1px; background: #f3f4f6; top: 50%;"></div>
                                    <div style="position: absolute; width: 100%; height: 1px; background: #f3f4f6; top: 75%;"></div>
                                    
                                    <!-- Energy tracked line (blue) -->
                                    <svg style="position: absolute; width: 100%; height: 100%;" viewBox="0 0 100 100" preserveAspectRatio="none">
                                        <polyline points="0,80 15,75 30,60 45,45 60,50 75,40 100,35" 
                                                  fill="none" stroke="#3b82f6" stroke-width="0.5" opacity="0.8"/>
                                    </svg>
                                    
                                    <!-- Theft detected line (red) -->
                                    <svg style="position: absolute; width: 100%; height: 100%;" viewBox="0 0 100 100" preserveAspectRatio="none">
                                        <polyline points="0,95 15,92 30,90 45,88 60,85 75,82 100,80" 
                                                  fill="none" stroke="#ef4444" stroke-width="0.5" opacity="0.8"/>
                                    </svg>
                                </div>
                                
                                <!-- X-axis labels -->
                                <div style="margin-left: 50px; margin-top: 8px; display: flex; justify-content: space-between; font-size: 12px; color: #6b7280;">
                                    <span>00:00</span>
                                    <span>04:00</span>
                                    <span>08:00</span>
                                    <span>12:00</span>
                                    <span>16:00</span>
                                    <span>20:00</span>
                                    <span>24:00</span>
                                </div>
                                
                                <!-- Legend -->
                                <div style="margin-top: 16px; display: flex; gap: 20px; font-size: 12px;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <div style="width: 12px; height: 2px; background: #3b82f6;"></div>
                                        <span style="color: #6b7280;">Energy Tracked</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <div style="width: 12px; height: 2px; background: #ef4444;"></div>
                                        <span style="color: #6b7280;">Theft Detected</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Theft Detection by Region -->
                        <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s ease;"
                             onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.15)'" 
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'"
                             onclick="showTheftRegionDetails()">
                            <h3 style="color: #1f2937; margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">Theft Detection by Region</h3>
                            <p style="color: #6b7280; margin: 0 0 24px 0; font-size: 14px;">Percentage of theft incidents by location</p>
                            
                            <!-- Pie Chart Container -->
                            <div style="position: relative; height: 300px; display: flex; align-items: center; justify-content: center;">
                                <!-- Pie Chart -->
                                <div style="position: relative; width: 200px; height: 200px;">
                                    <svg width="200" height="200" style="transform: rotate(-90deg);">
                                        <!-- Greater Accra: 35% (126 degrees) -->
                                        <circle cx="100" cy="100" r="80" fill="none" stroke="#ef4444" stroke-width="20" 
                                                stroke-dasharray="175.9 502.7" stroke-dashoffset="0" opacity="0.8"/>
                                        <!-- Ashanti: 28% (101 degrees) -->
                                        <circle cx="100" cy="100" r="80" fill="none" stroke="#f59e0b" stroke-width="20" 
                                                stroke-dasharray="140.7 502.7" stroke-dashoffset="-175.9" opacity="0.8"/>
                                        <!-- Central: 20% (72 degrees) -->
                                        <circle cx="100" cy="100" r="80" fill="none" stroke="#3b82f6" stroke-width="20" 
                                                stroke-dasharray="100.5 502.7" stroke-dashoffset="-316.6" opacity="0.8"/>
                                        <!-- Western: 17% (61 degrees) -->
                                        <circle cx="100" cy="100" r="80" fill="none" stroke="#10b981" stroke-width="20" 
                                                stroke-dasharray="85.5 502.7" stroke-dashoffset="-417.1" opacity="0.8"/>
                                    </svg>
                                    
                                    <!-- Center label -->
                                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                        <div style="font-size: 24px; font-weight: 700; color: #1f2937;">12.6%</div>
                                        <div style="font-size: 12px; color: #6b7280;">Total Theft</div>
                                    </div>
                                </div>
                                
                                <!-- Legend -->
                                <div style="margin-left: 32px; display: flex; flex-direction: column; gap: 12px;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 16px; height: 16px; background: #ef4444; border-radius: 50%; opacity: 0.8;"></div>
                                        <div>
                                            <div style="font-size: 14px; font-weight: 600; color: #1f2937;">Greater Accra</div>
                                            <div style="font-size: 12px; color: #6b7280;">35%</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 16px; height: 16px; background: #f59e0b; border-radius: 50%; opacity: 0.8;"></div>
                                        <div>
                                            <div style="font-size: 14px; font-weight: 600; color: #1f2937;">Ashanti</div>
                                            <div style="font-size: 12px; color: #6b7280;">28%</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 16px; height: 16px; background: #3b82f6; border-radius: 50%; opacity: 0.8;"></div>
                                        <div>
                                            <div style="font-size: 14px; font-weight: 600; color: #1f2937;">Central</div>
                                            <div style="font-size: 12px; color: #6b7280;">20%</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 16px; height: 16px; background: #10b981; border-radius: 50%; opacity: 0.8;"></div>
                                        <div>
                                            <div style="font-size: 14px; font-weight: 600; color: #1f2937;">Western</div>
                                            <div style="font-size: 12px; color: #6b7280;">17%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadWebsite() {
            const iframe = document.getElementById('website-iframe');
            // This would load your full PowerGridX website
            iframe.src = 'http://localhost:5173'; // Same React app, different route
            websiteLoaded = true;
        }

        function handleDashboardLoad() {
            setTimeout(() => {
                document.getElementById('dashboard-loading').style.display = 'none';
                document.getElementById('dashboard-iframe').style.opacity = '1';
                document.querySelector('#dashboard-btn .status-indicator').classList.remove('loading');
            }, 1000);
        }

        function handleWebsiteLoad() {
            setTimeout(() => {
                document.getElementById('website-loading').style.display = 'none';
                document.getElementById('website-iframe').style.opacity = '1';
                document.querySelector('#website-btn .status-indicator').classList.remove('loading');
            }, 1000);
        }

        // Transformers Functions
        function addNewTransformer() {
            console.log('Adding new transformer');
            alert('New Transformer registration form would open here with location mapping and technical specifications.');
        }

        function viewTransformerDetails(transformerId) {
            console.log('Viewing transformer details:', transformerId);
            alert(`Detailed view for ${transformerId} would show real-time monitoring, historical data, and maintenance records.`);
        }

        function scheduleMaintenace(transformerId) {
            console.log('Scheduling maintenance for:', transformerId);
            alert(`Maintenance scheduling interface for ${transformerId} would open with contractor assignment and timing options.`);
        }

        function contactMaintenance(transformerId) {
            console.log('Contacting maintenance for:', transformerId);
            alert(`Communication interface for ${transformerId} maintenance team would open with status updates and contact options.`);
        }

        function dispatchRepair(transformerId) {
            console.log('Dispatching repair for:', transformerId);
            alert(`Emergency repair dispatch for ${transformerId} would create urgent dispatch request and notify nearest contractors.`);
        }

        function viewFaultDetails(transformerId) {
            console.log('Viewing fault details for:', transformerId);
            alert(`Fault analysis for ${transformerId} would show diagnostic data, fault history, and recommended actions.`);
        }

        // Audit Log Functions
        function exportAuditLog() {
            const filter = document.getElementById('audit-filter').value;
            const date = document.getElementById('audit-date').value;
            console.log('Exporting audit log:', { filter, date });
            alert('Audit log export started. You will receive an email when ready.');
        }

        // Dispatch Request Functions
        function createNewDispatch() {
            console.log('Creating new dispatch request');
            alert('New Dispatch Request form will open here. This would integrate with your contractor management system.');
        }

        function viewDispatchDetails(dispatchId) {
            console.log('Viewing dispatch details:', dispatchId);
            alert(`Dispatch Details for ${dispatchId} would open here with full information, photos, and progress tracking.`);
        }

        function assignContractor(dispatchId) {
            console.log('Assigning contractor to:', dispatchId);
            alert(`Contractor assignment interface for ${dispatchId} would open here with available contractors and their locations.`);
        }

        function trackProgress(dispatchId) {
            console.log('Tracking progress for:', dispatchId);
            alert(`Real-time progress tracking for ${dispatchId} would show contractor location, photos, and status updates.`);
        }

        function contactContractor(dispatchId) {
            console.log('Contacting contractor for:', dispatchId);
            alert(`Communication interface for ${dispatchId} would open here with SMS, call, and messaging options.`);
        }

        // Dashboard Interactive Functions
        function showEnergyDetails() {
            alert(`Energy Tracking Details:
            
Current: 2829.8 kWh
Peak Today: 3156.2 kWh (14:30)
Average: 2654.3 kWh
Trend: â†— 2.1% increase from last hour

Regional Breakdown:
â€¢ Greater Accra: 1,245.6 kWh (44%)
â€¢ Ashanti: 892.3 kWh (32%)
â€¢ Western: 456.7 kWh (16%)
â€¢ Other: 235.2 kWh (8%)`);
        }

        function showTheftDetails() {
            alert(`Energy Theft Analysis:
            
Current Rate: 12.6%
Previous Hour: 13.4%
Improvement: â†˜ 0.8% reduction

Critical Areas:
â€¢ Greater Accra: 35% of incidents
â€¢ Ashanti: 28% of incidents
â€¢ Central: 20% of incidents
â€¢ Western: 17% of incidents

Recent Actions:
â€¢ 3 tampered meters detected
â€¢ 2 illegal connections found
â€¢ 1 bypass attempt prevented`);
        }

        function showPolesDetails() {
            alert(`Smart Poles Status:
            
Connected: 60 poles
Online: 58 poles (96.7%)
Offline: 2 poles (maintenance)
New Connections: +1 from last hour

Regional Distribution:
â€¢ Greater Accra: 25 poles
â€¢ Ashanti: 18 poles
â€¢ Western: 12 poles
â€¢ Other regions: 5 poles

Services Active:
â€¢ LED Lighting: 100%
â€¢ LoRa Network: 98.3%
â€¢ Monitoring Nodes: 95.0%`);
        }

        function showAlertsDetails() {
            alert(`Active System Alerts:
            
Critical: 1 alert
Warning: 1 alert

Current Alerts:
1. CRITICAL: Transformer fault at TR-ACC-001
   Location: Osu Castle Area, Greater Accra
   Time: 14:23 today
   
2. WARNING: High load detected at TR-KMA-001
   Location: Kejetia Market, Ashanti
   Load: 89% capacity
   Time: 13:45 today`);
        }

        // Audit Log Interactive Functions
        function showLogDetails(logId, type) {
            const logDetails = {
                'LOG-001': {
                    title: 'Critical Tampering Alert',
                    transformer: 'TR-ACC-001 (Osu Primary Transformer)',
                    region: 'Greater Accra',
                    district: 'Accra Metropolitan',
                    zone: 'Osu Zone',
                    place: 'Osu Castle Area (Urban)',
                    contractor: 'N/A (System Alert)',
                    details: 'Unauthorized access detected on transformer housing. Voltage irregularities and physical tampering sensors triggered. Immediate investigation required.',
                    impact: '150+ households affected',
                    status: 'Under Investigation',
                    priority: 'CRITICAL'
                },
                'LOG-002': {
                    title: 'Maintenance Completed',
                    transformer: 'TR-KMA-001 (Kejetia Market Transformer)',
                    region: 'Ashanti',
                    district: 'Kumasi Metropolitan',
                    zone: 'Kumasi Central Zone',
                    place: 'Kejetia Market Area (Urban)',
                    contractor: 'John Mensah (ID: CTR-2024-045)',
                    contractorPhone: '+233 24 567 8901',
                    contractorEmail: 'j.mensah@pgx-contractors.com',
                    details: 'Scheduled quarterly maintenance completed successfully. All monitoring nodes calibrated, connections inspected, and load balancing optimized.',
                    impact: 'No service interruption',
                    status: 'Completed',
                    priority: 'ROUTINE'
                },
                'LOG-003': {
                    title: 'Smart Meter Installation',
                    transformer: 'Connected to TR-ACC-002',
                    region: 'Greater Accra',
                    district: 'Accra Metropolitan',
                    zone: 'Osu Zone',
                    place: 'Labadi Beach Area (Peri-urban)',
                    contractor: 'Sarah Asante (ID: CTR-2024-032)',
                    contractorPhone: '+233 20 345 6789',
                    contractorEmail: 's.asante@pgx-contractors.com',
                    details: 'New smart meter installed for residential customer. Meter configured with tamper detection and remote monitoring capabilities.',
                    impact: '1 new household connected',
                    status: 'Completed',
                    priority: 'NORMAL'
                },
                'LOG-004': {
                    title: 'Power Outage Report',
                    transformer: 'TR-STM-002 (Effia-Kuma Rural Transformer)',
                    region: 'Western',
                    district: 'Sekondi-Takoradi Metropolitan',
                    zone: 'Takoradi Industrial Zone',
                    place: 'Effia-Kuma Village (Rural)',
                    contractor: 'N/A (Customer Report)',
                    details: 'Power outage reported by multiple customers. Investigation revealed overloaded transformer due to illegal connections. Repair team dispatched.',
                    impact: '85 households affected',
                    status: 'Repair In Progress',
                    priority: 'HIGH'
                },
                'LOG-005': {
                    title: 'Smart Pole Activation',
                    transformer: 'Connected to TR-KMA-001',
                    region: 'Ashanti',
                    district: 'Kumasi Metropolitan',
                    zone: 'Kumasi Central Zone',
                    place: 'Kejetia Market Area (Urban)',
                    contractor: 'Michael Osei (ID: CTR-2024-078)',
                    contractorPhone: '+233 26 789 0123',
                    contractorEmail: 'm.osei@pgx-contractors.com',
                    details: 'Smart pole installed with LED lighting, LoRa base station, and monitoring nodes. All systems tested and operational.',
                    impact: 'Enhanced area lighting and network coverage',
                    status: 'Operational',
                    priority: 'NORMAL'
                },
                'LOG-006': {
                    title: 'Monitoring Nodes Calibration',
                    transformer: 'TR-TMA-001 (Tema Port Transformer)',
                    region: 'Greater Accra',
                    district: 'Tema Metropolitan',
                    zone: 'Tema Industrial Zone',
                    place: 'Tema Port Area (Urban)',
                    contractor: 'Grace Adjei (ID: CTR-2024-056)',
                    contractorPhone: '+233 23 456 7890',
                    contractorEmail: 'g.adjei@pgx-contractors.com',
                    details: 'Routine calibration of monitoring nodes completed. Voltage, current, and power quality sensors adjusted for optimal accuracy.',
                    impact: 'Improved monitoring accuracy',
                    status: 'Completed',
                    priority: 'ROUTINE'
                }
            };

            const log = logDetails[logId];
            if (log) {
                let contractorInfo = '';
                if (log.contractor !== 'N/A (System Alert)' && log.contractor !== 'N/A (Customer Report)') {
                    contractorInfo = `
Contractor Information:
â€¢ Name: ${log.contractor}
â€¢ Phone: ${log.contractorPhone || 'N/A'}
â€¢ Email: ${log.contractorEmail || 'N/A'}

`;
                }

                alert(`${log.title}

Location Details:
â€¢ Region: ${log.region}
â€¢ District: ${log.district}
â€¢ Zone: ${log.zone}
â€¢ Place: ${log.place}
â€¢ Transformer: ${log.transformer}

${contractorInfo}Activity Details:
${log.details}

Impact: ${log.impact}
Status: ${log.status}
Priority: ${log.priority}`);
            }
        }

        // Live Dashboard Simulation
        function startLiveSimulation() {
            console.log('ðŸŒ Starting live IoT cloud data simulation...');

            // Initialize intervals array if not exists
            if (!window.dashboardIntervals) {
                window.dashboardIntervals = [];
            }

            // Update dashboard every minute (60 seconds) for live cloud data
            const mainInterval = setInterval(() => {
                updateDashboardValues();
                updateEnergyChart();
                updateCloudStatus();
            }, 60000);
            window.dashboardIntervals.push(mainInterval);

            // Update energy chart more frequently (every 30 seconds)
            const chartInterval = setInterval(() => {
                updateEnergyChart();
            }, 30000);
            window.dashboardIntervals.push(chartInterval);

            // Simulate real-time alerts and notifications
            const alertsInterval = setInterval(() => {
                simulateIoTEvents();
            }, 45000);
            window.dashboardIntervals.push(alertsInterval);

            // Initial updates
            updateDashboardValues();
            updateEnergyChart();
            updateCloudStatus();

            console.log('âœ… Live simulation started with', window.dashboardIntervals.length, 'intervals');
        }

        function updateDashboardValues() {
            console.log('ðŸ“¡ Receiving live data from IoT cloud...');

            // Simulate realistic IoT data patterns based on time of day
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();

            // Energy consumption patterns (higher during day, lower at night)
            const energyValue = document.getElementById('energy-value');
            if (energyValue) {
                const baseLoad = getBaseLoadForHour(hour);
                const variation = (Math.random() * 40 - 20); // Â±20 kWh variation
                const newEnergy = baseLoad + variation;
                energyValue.textContent = newEnergy.toFixed(1) + ' kWh';

                // Add visual indicator for data update
                energyValue.style.color = '#4CAF50';
                setTimeout(() => { energyValue.style.color = ''; }, 1000);
            }

            // Theft detection (higher during peak hours)
            const theftValue = document.getElementById('theft-value');
            if (theftValue) {
                const baseTheft = getTheftRateForHour(hour);
                const variation = (Math.random() * 0.6 - 0.3); // Â±0.3% variation
                const newTheft = Math.max(0, Math.min(15, baseTheft + variation));
                theftValue.textContent = newTheft.toFixed(1) + '%';

                // Color code based on theft level
                if (newTheft > 10) {
                    theftValue.style.color = '#F44336';
                } else if (newTheft > 7) {
                    theftValue.style.color = '#FF9800';
                } else {
                    theftValue.style.color = '#4CAF50';
                }
            }

            // Smart poles (gradual increase with occasional additions)
            const polesValue = document.getElementById('poles-value');
            if (polesValue) {
                const currentPoles = parseInt(polesValue.textContent);
                // 5% chance of new pole installation per minute
                if (Math.random() < 0.05) {
                    polesValue.textContent = (currentPoles + 1).toString();
                    showNotification('ðŸ”Œ New smart pole activated!', 'success');
                }
            }

            // Active alerts (dynamic based on system health)
            const alertsValue = document.getElementById('alerts-value');
            if (alertsValue) {
                const currentAlerts = parseInt(alertsValue.textContent);
                const alertChange = Math.random() < 0.4 ? (Math.random() < 0.6 ? 1 : -1) : 0;
                const newAlerts = Math.max(0, Math.min(50, currentAlerts + alertChange));
                alertsValue.textContent = newAlerts.toString();

                // Color code alerts
                if (newAlerts > 20) {
                    alertsValue.style.color = '#F44336';
                } else if (newAlerts > 10) {
                    alertsValue.style.color = '#FF9800';
                } else {
                    alertsValue.style.color = '#4CAF50';
                }
            }

            // Update timestamp
            const timestamp = document.getElementById('last-update');
            if (timestamp) {
                timestamp.textContent = `Last updated: ${now.toLocaleTimeString()}`;
                timestamp.style.color = '#4CAF50';
                setTimeout(() => { timestamp.style.color = '#999'; }, 2000);
            }

            console.log(`ðŸ“Š Dashboard updated at ${now.toLocaleTimeString()} - Energy: ${energyValue?.textContent}, Theft: ${theftValue?.textContent}`);
        }

        function updateEnergyChart() {
            // Simulate live energy chart updates
            const chartContainer = document.querySelector('.chart-container');
            if (chartContainer) {
                const now = new Date();
                const currentHour = now.getHours();
                const currentLoad = getBaseLoadForHour(currentHour);

                // Add visual pulse effect to indicate live data
                chartContainer.style.boxShadow = '0 0 20px rgba(76, 175, 80, 0.3)';
                setTimeout(() => {
                    chartContainer.style.boxShadow = '';
                }, 1000);

                console.log(`ðŸ“ˆ Energy chart updated: ${currentLoad} kWh at ${now.toLocaleTimeString()}`);
            }
        }

        function updateCloudStatus() {
            // Simulate cloud connectivity status
            const cloudStatus = document.getElementById('cloud-status');
            if (!cloudStatus) {
                // Add cloud status indicator to dashboard
                const statusDiv = document.createElement('div');
                statusDiv.id = 'cloud-status';
                statusDiv.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: #1a1a1a;
                    color: white;
                    padding: 8px 16px;
                    border-radius: 20px;
                    font-size: 12px;
                    border: 1px solid #333;
                    z-index: 1000;
                `;
                document.body.appendChild(statusDiv);
            }

            const status = Math.random() > 0.05 ? 'connected' : 'reconnecting';
            const statusElement = document.getElementById('cloud-status');

            if (status === 'connected') {
                statusElement.innerHTML = 'ðŸŒ Cloud Connected â€¢ Live Data';
                statusElement.style.borderColor = '#4CAF50';
            } else {
                statusElement.innerHTML = 'ðŸ”„ Reconnecting...';
                statusElement.style.borderColor = '#FF9800';
            }
        }

        function simulateIoTEvents() {
            const events = [
                { type: 'meter', message: 'Smart meter TR-ACC-001 reporting normal operation', level: 'info' },
                { type: 'transformer', message: 'Transformer load balancing completed', level: 'success' },
                { type: 'alert', message: 'Unusual consumption pattern detected in Zone 5', level: 'warning' },
                { type: 'maintenance', message: 'Scheduled maintenance reminder for TR-KMA-003', level: 'info' },
                { type: 'theft', message: 'Potential energy theft detected - investigating', level: 'error' },
                { type: 'installation', message: 'New monitoring node activated', level: 'success' }
            ];

            if (Math.random() < 0.3) { // 30% chance of event
                const event = events[Math.floor(Math.random() * events.length)];
                showNotification(event.message, event.level);
                console.log(`ðŸ”” IoT Event: ${event.message}`);
            }
        }

        function showNotification(message, level = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 120px;
                right: 20px;
                background: ${level === 'error' ? '#F44336' : level === 'warning' ? '#FF9800' : level === 'success' ? '#4CAF50' : '#2196F3'};
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                font-size: 14px;
                max-width: 300px;
                z-index: 1001;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease-out;
            `;

            notification.textContent = message;
            document.body.appendChild(notification);

            // Auto remove after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // Modal System for Interactive Popups
        function showModal(title, content) {
            // Remove existing modal if any
            const existingModal = document.querySelector('.modal-overlay');
            if (existingModal) {
                existingModal.remove();
            }

            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 style="margin: 0; color: #F97316; font-size: 20px;">${title}</h2>
                        <button class="modal-close" onclick="closeModal()">âœ•</button>
                    </div>
                    <div class="modal-body">
                        ${content}
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Close modal when clicking outside
            modal.addEventListener('click', function (e) {
                if (e.target === modal) {
                    closeModal();
                }
            });

            // Close modal with Escape key
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });
        }

        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease-in';
                setTimeout(() => {
                    if (modal.parentNode) {
                        modal.parentNode.removeChild(modal);
                    }
                }, 300);
            }
        }

        function generateHourlyEnergyData(currentHour, currentLoad, currentTheft) {
            let html = '';
            for (let i = 0; i < 6; i++) {
                const hour = (currentHour - i + 24) % 24;
                const load = getBaseLoadForHour(hour) + (Math.random() * 100 - 50);
                const theft = getTheftRateForHour(hour) + (Math.random() * 2 - 1);
                const efficiency = 100 - theft;
                const status = efficiency > 90 ? 'online' : efficiency > 85 ? 'warning' : 'offline';
                const statusText = efficiency > 90 ? 'Optimal' : efficiency > 85 ? 'Monitor' : 'Alert';

                html += `
                    <tr>
                        <td>${hour.toString().padStart(2, '0')}:00 - ${((hour + 1) % 24).toString().padStart(2, '0')}:00</td>
                        <td>${load.toFixed(0)} kWh</td>
                        <td>${theft.toFixed(1)}%</td>
                        <td>${efficiency.toFixed(1)}%</td>
                        <td><span class="status-indicator-table status-${status}"></span>${statusText}</td>
                    </tr>
                `;
            }
            return html;
        }

        function getBaseLoadForHour(hour) {
            // Realistic energy consumption pattern for Ghana
            const patterns = {
                0: 2200, 1: 2100, 2: 2000, 3: 1950, 4: 1900, 5: 2100,
                6: 2400, 7: 2800, 8: 3200, 9: 3400, 10: 3600, 11: 3800,
                12: 4000, 13: 4200, 14: 4100, 15: 3900, 16: 4300, 17: 4500,
                18: 4800, 19: 4600, 20: 4200, 21: 3800, 22: 3200, 23: 2600
            };
            return patterns[hour] || 3000;
        }

        function getTheftRateForHour(hour) {
            // Theft patterns (higher during peak hours)
            if (hour >= 17 && hour <= 21) return 9.5; // Evening peak
            if (hour >= 8 && hour <= 16) return 8.2;  // Day time
            if (hour >= 22 || hour <= 5) return 5.8;  // Night time
            return 7.1; // Default
        }

        // Interactive Chart Functions
        function showEnergyTrackingDetails() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentLoad = getBaseLoadForHour(currentHour);
            const currentTheft = getTheftRateForHour(currentHour);

            showModal('Energy Tracking - Live IoT Data', `
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <span class="live-indicator"></span>
                        <strong style="color: #4CAF50;">Live Data from Smart Meters</strong>
                        <span style="margin-left: auto; color: #999; font-size: 12px;">${now.toLocaleString()}</span>
                    </div>
                </div>

                <table class="live-data-table">
                    <thead>
                        <tr>
                            <th>Time Period</th>
                            <th>Energy Tracked</th>
                            <th>Theft Detected</th>
                            <th>Efficiency</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${generateHourlyEnergyData(currentHour, currentLoad, currentTheft)}
                    </tbody>
                </table>

                <div style="margin-top: 25px; padding: 20px; background: #2a2a2a; border-radius: 8px; border-left: 4px solid #F97316;">
                    <h4 style="margin: 0 0 15px 0; color: #F97316;">ðŸ” Real-Time Analysis</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 14px;">
                        <div>
                            <strong>Current Load:</strong> ${currentLoad.toFixed(0)} kWh<br>
                            <strong>Theft Rate:</strong> ${currentTheft.toFixed(1)}%<br>
                            <strong>Active Meters:</strong> ${1247 + Math.floor(Math.random() * 10)}
                        </div>
                        <div>
                            <strong>Grid Health:</strong> <span style="color: #4CAF50;">89.2%</span><br>
                            <strong>Cloud Sync:</strong> <span style="color: #4CAF50;">Connected</span><br>
                            <strong>Last Update:</strong> ${Math.floor(Math.random() * 30)} sec ago
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: #1a3a1a; border-radius: 8px; border: 1px solid #4CAF50;">
                    <h4 style="margin: 0 0 10px 0; color: #4CAF50;">ðŸ’¡ AI Recommendations</h4>
                    <ul style="margin: 0; padding-left: 20px; font-size: 14px; line-height: 1.6;">
                        <li>Deploy additional monitoring nodes in Zone ${Math.floor(Math.random() * 10) + 1}</li>
                        <li>Schedule maintenance for transformers showing 85%+ load</li>
                        <li>Investigate unusual consumption pattern in ${['Accra', 'Kumasi', 'Takoradi'][Math.floor(Math.random() * 3)]}</li>
                    </ul>
                </div>
            `);
        }

        function showTheftRegionDetails() {
            const now = new Date();
            const regions = [
                { name: 'Greater Accra', cases: 156 + Math.floor(Math.random() * 10), percentage: 35, recovery: 78 + Math.floor(Math.random() * 5), areas: ['Osu', 'Adabraka', 'Tema'] },
                { name: 'Ashanti', cases: 124 + Math.floor(Math.random() * 8), percentage: 28, recovery: 82 + Math.floor(Math.random() * 4), areas: ['Kumasi Central', 'Kejetia Market'] },
                { name: 'Central', cases: 89 + Math.floor(Math.random() * 6), percentage: 20, recovery: 71 + Math.floor(Math.random() * 6), areas: ['Cape Coast', 'Winneba'] },
                { name: 'Western', cases: 76 + Math.floor(Math.random() * 5), percentage: 17, recovery: 69 + Math.floor(Math.random() * 7), areas: ['Takoradi', 'Sekondi'] }
            ];

            showModal('Theft Detection - Live Regional Analysis', `
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <span class="live-indicator"></span>
                        <strong style="color: #F44336;">Live Theft Detection System</strong>
                        <span style="margin-left: auto; color: #999; font-size: 12px;">${now.toLocaleString()}</span>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    ${regions.map(region => `
                        <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; border-left: 4px solid ${region.recovery > 75 ? '#4CAF50' : '#FF9800'};">
                            <h4 style="margin: 0 0 10px 0; color: #F97316;">${region.name} Region</h4>
                            <div style="font-size: 14px; line-height: 1.6;">
                                <div><strong>Active Cases:</strong> ${region.cases}</div>
                                <div><strong>Share:</strong> ${region.percentage}% of total</div>
                                <div><strong>Recovery Rate:</strong> <span style="color: ${region.recovery > 75 ? '#4CAF50' : '#FF9800'}">${region.recovery}%</span></div>
                                <div><strong>Hot Spots:</strong> ${region.areas.join(', ')}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <table class="live-data-table">
                    <thead>
                        <tr>
                            <th>Region</th>
                            <th>Live Cases</th>
                            <th>Method Detected</th>
                            <th>Recovery Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Greater Accra</td>
                            <td>${Math.floor(Math.random() * 5) + 2}</td>
                            <td>Meter Tampering</td>
                            <td><span class="status-indicator-table status-warning"></span>In Progress</td>
                            <td><button style="background: #F97316; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Investigate</button></td>
                        </tr>
                        <tr>
                            <td>Ashanti</td>
                            <td>${Math.floor(Math.random() * 3) + 1}</td>
                            <td>Bypass Connection</td>
                            <td><span class="status-indicator-table status-online"></span>Resolved</td>
                            <td><button style="background: #4CAF50; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Complete</button></td>
                        </tr>
                        <tr>
                            <td>Western</td>
                            <td>${Math.floor(Math.random() * 4) + 1}</td>
                            <td>Ghost Meter</td>
                            <td><span class="status-indicator-table status-offline"></span>Critical</td>
                            <td><button style="background: #F44336; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Urgent</button></td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top: 25px; padding: 20px; background: #3a1a1a; border-radius: 8px; border: 1px solid #F44336;">
                    <h4 style="margin: 0 0 15px 0; color: #F44336;">ðŸš¨ AI-Powered Action Plan</h4>
                    <ul style="margin: 0; padding-left: 20px; font-size: 14px; line-height: 1.8;">
                        <li><strong>Immediate:</strong> Deploy field team to Western Region critical case</li>
                        <li><strong>Today:</strong> Increase monitoring frequency in Greater Accra hot spots</li>
                        <li><strong>This Week:</strong> Schedule smart meter upgrades in high-risk areas</li>
                        <li><strong>Ongoing:</strong> Enhanced contractor training program</li>
                    </ul>
                </div>
            `);
        }

        function showEnergyDetails() {
            showEnergyTrackingDetails(); // Reuse the existing detailed function
        }

        function showTheftDetails() {
            showTheftRegionDetails(); // Reuse the existing detailed function
        }

        function showPolesDetails() {
            const now = new Date();
            const totalPoles = parseInt(document.getElementById('poles-value')?.textContent || '1247');

            showModal('Smart Poles - Live IoT Network', `
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <span class="live-indicator"></span>
                        <strong style="color: #4CAF50;">Live Smart Pole Network</strong>
                        <span style="margin-left: auto; color: #999; font-size: 12px;">${now.toLocaleString()}</span>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px;">
                    <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #4CAF50; margin-bottom: 8px;">${totalPoles}</div>
                        <div style="color: #ccc; font-size: 14px;">Total Poles</div>
                    </div>
                    <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #2196F3; margin-bottom: 8px;">${Math.floor(totalPoles * 0.94)}</div>
                        <div style="color: #ccc; font-size: 14px;">Online</div>
                    </div>
                    <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #FF9800; margin-bottom: 8px;">${Math.floor(totalPoles * 0.06)}</div>
                        <div style="color: #ccc; font-size: 14px;">Maintenance</div>
                    </div>
                </div>

                <table class="live-data-table">
                    <thead>
                        <tr>
                            <th>Pole ID</th>
                            <th>Location</th>
                            <th>Status</th>
                            <th>Load</th>
                            <th>Last Signal</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>SP-ACC-${String(Math.floor(Math.random() * 999)).padStart(3, '0')}</td>
                            <td>Osu, Greater Accra</td>
                            <td><span class="status-indicator-table status-online"></span>Online</td>
                            <td>${(Math.random() * 50 + 30).toFixed(1)}%</td>
                            <td>${Math.floor(Math.random() * 30)} sec ago</td>
                        </tr>
                        <tr>
                            <td>SP-KMA-${String(Math.floor(Math.random() * 999)).padStart(3, '0')}</td>
                            <td>Kumasi Central, Ashanti</td>
                            <td><span class="status-indicator-table status-warning"></span>Maintenance</td>
                            <td>0%</td>
                            <td>2 hours ago</td>
                        </tr>
                        <tr>
                            <td>SP-TAK-${String(Math.floor(Math.random() * 999)).padStart(3, '0')}</td>
                            <td>Takoradi, Western</td>
                            <td><span class="status-indicator-table status-online"></span>Online</td>
                            <td>${(Math.random() * 40 + 40).toFixed(1)}%</td>
                            <td>${Math.floor(Math.random() * 60)} sec ago</td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top: 25px; padding: 20px; background: #1a2a3a; border-radius: 8px; border: 1px solid #2196F3;">
                    <h4 style="margin: 0 0 15px 0; color: #2196F3;">ðŸ“¡ IoT Capabilities</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 14px;">
                        <div>
                            <strong>Monitoring:</strong> Real-time load, voltage, current<br>
                            <strong>Communication:</strong> 4G/5G cellular, LoRaWAN backup<br>
                            <strong>Analytics:</strong> Predictive maintenance, fault detection
                        </div>
                        <div>
                            <strong>Security:</strong> Tamper detection, encrypted data<br>
                            <strong>Updates:</strong> OTA firmware, remote configuration<br>
                            <strong>Integration:</strong> Cloud dashboard, mobile alerts
                        </div>
                    </div>
                </div>
            `);
        }

        function showAlertsDetails() {
            const now = new Date();
            const alertTypes = [
                { type: 'Critical', count: Math.floor(Math.random() * 5) + 2, color: '#F44336', icon: 'ðŸš¨' },
                { type: 'Warning', count: Math.floor(Math.random() * 8) + 5, color: '#FF9800', icon: 'âš ï¸' },
                { type: 'Info', count: Math.floor(Math.random() * 15) + 10, color: '#2196F3', icon: 'â„¹ï¸' }
            ];

            showModal('Active Alerts - Live Monitoring System', `
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <span class="live-indicator"></span>
                        <strong style="color: #FF9800;">Live Alert Monitoring</strong>
                        <span style="margin-left: auto; color: #999; font-size: 12px;">${now.toLocaleString()}</span>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px;">
                    ${alertTypes.map(alert => `
                        <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; border-left: 4px solid ${alert.color};">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <span style="font-size: 20px;">${alert.icon}</span>
                                <h4 style="margin: 0; color: ${alert.color};">${alert.type}</h4>
                            </div>
                            <div style="font-size: 24px; font-weight: bold; color: ${alert.color};">${alert.count}</div>
                            <div style="color: #ccc; font-size: 12px;">Active alerts</div>
                        </div>
                    `).join('')}
                </div>

                <table class="live-data-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Type</th>
                            <th>Location</th>
                            <th>Description</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>${new Date(Date.now() - Math.random() * 3600000).toLocaleTimeString()}</td>
                            <td><span style="color: #F44336;">ðŸš¨ Critical</span></td>
                            <td>TR-ACC-001</td>
                            <td>Transformer overload detected</td>
                            <td><span class="status-indicator-table status-offline"></span>Investigating</td>
                        </tr>
                        <tr>
                            <td>${new Date(Date.now() - Math.random() * 1800000).toLocaleTimeString()}</td>
                            <td><span style="color: #FF9800;">âš ï¸ Warning</span></td>
                            <td>Zone 5, Kumasi</td>
                            <td>Unusual consumption pattern</td>
                            <td><span class="status-indicator-table status-warning"></span>Monitoring</td>
                        </tr>
                        <tr>
                            <td>${new Date(Date.now() - Math.random() * 900000).toLocaleTimeString()}</td>
                            <td><span style="color: #2196F3;">â„¹ï¸ Info</span></td>
                            <td>SP-TAK-045</td>
                            <td>Scheduled maintenance reminder</td>
                            <td><span class="status-indicator-table status-online"></span>Scheduled</td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top: 25px; padding: 20px; background: #2a1a1a; border-radius: 8px; border: 1px solid #FF9800;">
                    <h4 style="margin: 0 0 15px 0; color: #FF9800;">ðŸ¤– AI Alert Management</h4>
                    <ul style="margin: 0; padding-left: 20px; font-size: 14px; line-height: 1.8;">
                        <li><strong>Auto-Classification:</strong> ML algorithms categorize alerts by severity</li>
                        <li><strong>Predictive Alerts:</strong> Early warning system for potential failures</li>
                        <li><strong>Smart Routing:</strong> Alerts automatically assigned to appropriate teams</li>
                        <li><strong>Pattern Recognition:</strong> Identifies recurring issues for proactive fixes</li>
                    </ul>
                </div>
            `);
        }

        function showTransformerDetails(transformerId) {
            console.log('Showing transformer details for:', transformerId);

            // Generate transformer data
            const transformer = {
                id: transformerId,
                name: `Primary Transformer ${transformerId.split('-')[2]}`,
                gpsAddress: generateGPSAddress('GH-AA', 'Sample Location'),
                status: Math.random() > 0.1 ? 'Active' : 'Maintenance',
                load: Math.floor(Math.random() * 40) + 60,
                singlePhaseMeters: Math.floor(Math.random() * 50) + 20,
                threePhaseMeters: Math.floor(Math.random() * 15) + 5,
                monitoringNodes: Math.floor(Math.random() * 3) + 2,
                customers: generateCustomerData(Math.floor(Math.random() * 50) + 20 + Math.floor(Math.random() * 15) + 5, transformerId, Math.floor(Math.random() * 3) + 2)
            };

            showModal(`Transformer Details - ${transformer.id}`, `
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <span style="font-size: 24px;">âš¡</span>
                        <div>
                            <h3 style="margin: 0; color: #F97316;">${transformer.name}</h3>
                            <p style="margin: 4px 0 0 0; color: #999; font-size: 14px;">ID: ${transformer.id}</p>
                        </div>
                        <div style="margin-left: auto;">
                            <span style="padding: 4px 12px; background: ${transformer.status === 'Active' ? '#4CAF50' : '#FF9800'}; color: white; border-radius: 12px; font-size: 12px; font-weight: bold;">
                                ${transformer.status}
                            </span>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    <div style="background: #2a2a2a; padding: 20px; border-radius: 8px;">
                        <h4 style="margin: 0 0 15px 0; color: #F97316;">ðŸ“Š Performance</h4>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <div><strong>Current Load:</strong> ${transformer.load}%</div>
                            <div><strong>Status:</strong> <span style="color: ${transformer.status === 'Active' ? '#4CAF50' : '#FF9800'}">${transformer.status}</span></div>
                            <div><strong>Efficiency:</strong> ${(100 - Math.random() * 10).toFixed(1)}%</div>
                        </div>
                    </div>
                    <div style="background: #2a2a2a; padding: 20px; border-radius: 8px;">
                        <h4 style="margin: 0 0 15px 0; color: #F97316;">ðŸ“ Location</h4>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <div><strong>GPS:</strong> ${transformer.gpsAddress}</div>
                            <div><strong>Installation:</strong> ${new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000).toLocaleDateString()}</div>
                        </div>
                    </div>
                </div>

                <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                    <h4 style="margin: 0 0 15px 0; color: #F97316;">ðŸ”Œ Connected Infrastructure</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: #1a1a1a; border-radius: 6px; cursor: pointer;" onclick="showSmartMeters('${transformer.id}', 'single')">
                            <div style="font-size: 24px; font-weight: bold; color: #4CAF50;">${transformer.singlePhaseMeters}</div>
                            <div style="font-size: 12px; color: #ccc;">Single-Phase Meters</div>
                            <div style="font-size: 10px; color: #666; margin-top: 4px;">Click to view â†’</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #1a1a1a; border-radius: 6px; cursor: pointer;" onclick="showSmartMeters('${transformer.id}', 'three')">
                            <div style="font-size: 24px; font-weight: bold; color: #2196F3;">${transformer.threePhaseMeters}</div>
                            <div style="font-size: 12px; color: #ccc;">3-Phase Meters</div>
                            <div style="font-size: 10px; color: #666; margin-top: 4px;">Click to view â†’</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #1a1a1a; border-radius: 6px;">
                            <div style="font-size: 24px; font-weight: bold; color: #FF9800;">${transformer.monitoringNodes}</div>
                            <div style="font-size: 12px; color: #ccc;">Monitoring Nodes</div>
                        </div>
                    </div>
                </div>

                <div style="background: #1a2a1a; padding: 20px; border-radius: 8px; border: 1px solid #4CAF50;">
                    <h4 style="margin: 0 0 15px 0; color: #4CAF50;">ðŸ“ˆ Real-Time Metrics</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 14px;">
                        <div>
                            <div><strong>Voltage:</strong> ${(220 + Math.random() * 20 - 10).toFixed(1)}V</div>
                            <div><strong>Current:</strong> ${(15 + Math.random() * 10).toFixed(1)}A</div>
                            <div><strong>Power Factor:</strong> ${(0.85 + Math.random() * 0.1).toFixed(2)}</div>
                        </div>
                        <div>
                            <div><strong>Temperature:</strong> ${(45 + Math.random() * 15).toFixed(1)}Â°C</div>
                            <div><strong>Frequency:</strong> ${(50 + Math.random() * 0.5 - 0.25).toFixed(2)}Hz</div>
                            <div><strong>Last Update:</strong> ${Math.floor(Math.random() * 30)} sec ago</div>
                        </div>
                    </div>
                </div>
            `);
        }

        function showSmartMeters(transformerId, meterType) {
            console.log('Showing smart meters for transformer:', transformerId, 'type:', meterType);

            // Generate customer data for this transformer
            const customers = generateCustomerData(meterType === 'single' ? 45 : 12, transformerId, 3);
            const filteredCustomers = customers.filter(c =>
                meterType === 'single' ? c.meterType === 'Single-Phase' : c.meterType === '3-Phase'
            );

            showModal(`${meterType === 'single' ? 'Single-Phase' : '3-Phase'} Smart Meters - ${transformerId}`, `
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <span style="font-size: 24px;">ðŸ”Œ</span>
                        <div>
                            <h3 style="margin: 0; color: #F97316;">${meterType === 'single' ? 'Single-Phase' : '3-Phase'} Smart Meters</h3>
                            <p style="margin: 4px 0 0 0; color: #999; font-size: 14px;">Transformer: ${transformerId} â€¢ ${filteredCustomers.length} customers</p>
                        </div>
                    </div>
                </div>

                <div style="max-height: 400px; overflow-y: auto;">
                    ${filteredCustomers.map(customer => `
                        <div style="margin: 8px 0; padding: 16px; background: #2a2a2a; border-radius: 8px; cursor: pointer; transition: all 0.2s; border-left: 4px solid ${customer.status === 'Active' ? '#4CAF50' : '#F44336'};" 
                             onmouseover="this.style.background='#333'; this.style.transform='translateX(4px)'" 
                             onmouseout="this.style.background='#2a2a2a'; this.style.transform='translateX(0)'"
                             onclick="showCustomerDetails('${customer.id}')">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div style="font-weight: bold; color: #fff; font-size: 16px;">${customer.name}</div>
                                <span style="padding: 2px 8px; background: ${customer.status === 'Active' ? '#4CAF50' : '#F44336'}; color: white; border-radius: 10px; font-size: 10px;">
                                    ${customer.status}
                                </span>
                            </div>
                            <div style="font-size: 12px; color: #999; line-height: 1.6;">
                                <div><strong>Meter:</strong> ${customer.meterNumber} (${customer.meterType})</div>
                                <div><strong>Monitoring Node:</strong> ${customer.monitoringNode}</div>
                                <div><strong>Monthly Usage:</strong> ${customer.consumption} kWh</div>
                            </div>
                            <div style="font-size: 11px; color: #4CAF50; margin-top: 8px;">
                                Click for detailed customer information â†’
                            </div>
                        </div>
                    `).join('')}
                </div>

                <div style="margin-top: 20px; padding: 16px; background: #2a2a2a; border-radius: 8px;">
                    <h4 style="margin: 0 0 12px 0; color: #F97316;">Meter Summary</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; font-size: 14px;">
                        <div><strong>Total Meters:</strong> ${filteredCustomers.length}</div>
                        <div><strong>Active:</strong> ${filteredCustomers.filter(c => c.status === 'Active').length}</div>
                        <div><strong>Avg. Usage:</strong> ${Math.floor(filteredCustomers.reduce((sum, c) => sum + c.consumption, 0) / filteredCustomers.length)} kWh</div>
                    </div>
                </div>
            `);
        }

        function showCustomerDetails(customerId) {
            console.log('Requesting customer details for:', customerId);

            // Show password prompt
            showModal('Access Control', `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">ðŸ”’</div>
                    <h3 style="color: #F97316; margin-bottom: 16px;">Secure Customer Information</h3>
                    <p style="color: #ccc; margin-bottom: 25px;">
                        This information is protected. Please enter the access password to continue.
                    </p>
                    <div style="margin-bottom: 20px;">
                        <input type="password" id="customer-password" placeholder="Enter password" 
                               style="padding: 12px 16px; border: 1px solid #333; border-radius: 6px; background: #2a2a2a; color: white; font-size: 16px; width: 200px; text-align: center;"
                               onkeypress="if(event.key==='Enter') checkCustomerPassword('${customerId}')">
                    </div>
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button onclick="checkCustomerPassword('${customerId}')" 
                                style="padding: 10px 20px; background: #F97316; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                            Access Information
                        </button>
                        <button onclick="closeModal()" 
                                style="padding: 10px 20px; background: #666; color: white; border: none; border-radius: 6px; cursor: pointer;">
                            Cancel
                        </button>
                    </div>
                    <div style="margin-top: 15px; font-size: 12px; color: #666;">
                        Hint: Password is !000!
                    </div>
                </div>
            `);

            // Focus on password input
            setTimeout(() => {
                const passwordInput = document.getElementById('customer-password');
                if (passwordInput) passwordInput.focus();
            }, 100);
        }

        function checkCustomerPassword(customerId) {
            const passwordInput = document.getElementById('customer-password');
            const password = passwordInput?.value;

            if (password === '!000!') {
                showCustomerFullDetails(customerId);
            } else {
                // Show error
                passwordInput.style.borderColor = '#F44336';
                passwordInput.style.background = '#3a1a1a';
                passwordInput.value = '';
                passwordInput.placeholder = 'Incorrect password - try again';

                setTimeout(() => {
                    passwordInput.style.borderColor = '#333';
                    passwordInput.style.background = '#2a2a2a';
                    passwordInput.placeholder = 'Enter password';
                }, 2000);
            }
        }

        function showCustomerFullDetails(customerId) {
            console.log('Showing full customer details for:', customerId);

            // Generate detailed customer data
            const customer = generateCustomerData(1, 'TR-ACC-001', 2)[0];
            customer.id = customerId;

            showModal(`Customer Profile - ${customer.name}`, `
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #F97316, #FF6B35); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; font-weight: bold;">
                            ${customer.name.split(' ').map(n => n[0]).join('')}
                        </div>
                        <div>
                            <h3 style="margin: 0; color: #F97316; font-size: 20px;">${customer.name}</h3>
                            <p style="margin: 4px 0 0 0; color: #999; font-size: 14px;">Customer ID: ${customer.id}</p>
                        </div>
                        <div style="margin-left: auto;">
                            <span style="padding: 4px 12px; background: ${customer.status === 'Active' ? '#4CAF50' : '#F44336'}; color: white; border-radius: 12px; font-size: 12px; font-weight: bold;">
                                ${customer.status}
                            </span>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    <div style="background: #2a2a2a; padding: 20px; border-radius: 8px;">
                        <h4 style="margin: 0 0 15px 0; color: #F97316;">ðŸ“‹ Personal Information</h4>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <div><strong>Full Name:</strong> ${customer.name}</div>
                            <div><strong>Ghana Card:</strong> ${customer.ghanaCard}</div>
                            <div><strong>Phone:</strong> ${customer.phone}</div>
                            <div><strong>Address:</strong> ${customer.address}</div>
                        </div>
                    </div>
                    <div style="background: #2a2a2a; padding: 20px; border-radius: 8px;">
                        <h4 style="margin: 0 0 15px 0; color: #F97316;">âš¡ Meter Information</h4>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <div><strong>Meter Number:</strong> ${customer.meterNumber}</div>
                            <div><strong>Meter Type:</strong> ${customer.meterType}</div>
                            <div><strong>Monitoring Node:</strong> ${customer.monitoringNode}</div>
                            <div><strong>Monthly Usage:</strong> ${customer.consumption} kWh</div>
                        </div>
                    </div>
                </div>

                <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; color: #F97316;">ðŸ‘¤ Emergency Contact</h4>
                    <div style="font-size: 14px; line-height: 1.8;">
                        <div><strong>Name:</strong> ${customer.emergencyContact.name}</div>
                        <div><strong>Phone:</strong> ${customer.emergencyContact.phone}</div>
                        <div><strong>Relationship:</strong> ${customer.emergencyContact.relationship}</div>
                        <div style="font-size: 12px; color: #999; margin-top: 8px;">
                            * Emergency contact is the designated person to reach when the primary customer is unavailable
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; text-align: center;">
                        <h4 style="margin: 0 0 15px 0; color: #F97316;">ðŸ“¸ Meter Photo</h4>
                        <div style="width: 100%; height: 120px; background: linear-gradient(135deg, #333, #555); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px;">
                            <span style="color: #999; font-size: 14px;">ðŸ“· Smart Meter Image</span>
                        </div>
                        <div style="font-size: 12px; color: #666;">Last updated: ${new Date().toLocaleDateString()}</div>
                    </div>
                    <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; text-align: center;">
                        <h4 style="margin: 0 0 15px 0; color: #F97316;">ðŸ  Building Photo</h4>
                        <div style="width: 100%; height: 120px; background: linear-gradient(135deg, #333, #555); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px;">
                            <span style="color: #999; font-size: 14px;">ðŸ  Property Image</span>
                        </div>
                        <div style="font-size: 12px; color: #666;">Last updated: ${new Date().toLocaleDateString()}</div>
                    </div>
                </div>

                <div style="background: #1a2a1a; padding: 20px; border-radius: 8px; border: 1px solid #4CAF50;">
                    <h4 style="margin: 0 0 15px 0; color: #4CAF50;">ðŸ“Š Usage Analytics</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; font-size: 14px;">
                        <div><strong>This Month:</strong> ${customer.consumption} kWh</div>
                        <div><strong>Last Month:</strong> ${customer.consumption + Math.floor(Math.random() * 50 - 25)} kWh</div>
                        <div><strong>Avg. Daily:</strong> ${(customer.consumption / 30).toFixed(1)} kWh</div>
                    </div>
                </div>
            `);
        }

        // Smart Meter and Customer Management
        const smartMeterData = {
            'TR-ACC-001': [
                {
                    id: 'SM-ACC-001-01',
                    customerName: 'Kwame Asante',
                    ghanaCard: 'GHA-123456789-0',
                    phone: '+233 24 123 4567',
                    gpsAddress: 'GA-456-7890',
                    physicalAddress: 'House No. 15, Castle Road, Osu',
                    meterType: 'Prepaid Smart Meter',
                    status: 'Active',
                    lastReading: '1,245.6 kWh',
                    balance: 'GHS 45.80',
                    installDate: '2023-08-15'
                },
                {
                    id: 'SM-ACC-001-02',
                    customerName: 'Akosua Mensah',
                    ghanaCard: 'GHA-987654321-1',
                    phone: '+233 20 987 6543',
                    gpsAddress: 'GA-456-7891',
                    physicalAddress: 'Apt 3B, Oxford Street, Osu',
                    meterType: 'Postpaid Smart Meter',
                    status: 'Active',
                    lastReading: '892.3 kWh',
                    balance: 'GHS -23.50',
                    installDate: '2023-09-22'
                },
                {
                    id: 'SM-ACC-001-03',
                    customerName: 'John Doe',
                    ghanaCard: 'GHA-456789123-2',
                    phone: '+233 26 456 7890',
                    gpsAddress: 'GA-456-7892',
                    physicalAddress: 'Shop 7, Osu Market Complex',
                    meterType: 'Commercial Smart Meter',
                    status: 'Active',
                    lastReading: '2,156.8 kWh',
                    balance: 'GHS 156.20',
                    installDate: '2023-07-10'
                }
            ],
            'TR-KMA-001': [
                {
                    id: 'SM-KMA-001-01',
                    customerName: 'Yaa Pokua',
                    ghanaCard: 'GHA-789123456-3',
                    phone: '+233 24 789 1234',
                    gpsAddress: 'AK-123-4567',
                    physicalAddress: 'Kejetia Market, Stall 45',
                    meterType: 'Commercial Smart Meter',
                    status: 'Active',
                    lastReading: '3,456.7 kWh',
                    balance: 'GHS 234.60',
                    installDate: '2023-06-05'
                }
            ]
        };

        function viewSmartMeters(transformerId) {
            const meters = smartMeterData[transformerId] || [];

            if (meters.length === 0) {
                alert(`No smart meters found for ${transformerId}`);
                return;
            }

            let meterList = `Smart Meters connected to ${transformerId}:\n\n`;

            meters.forEach((meter, index) => {
                meterList += `${index + 1}. ${meter.customerName} (${meter.id})
   Status: ${meter.status}
   Type: ${meter.meterType}
   Address: ${meter.physicalAddress}
   Last Reading: ${meter.lastReading}
   
`;
            });

            meterList += `\nClick on individual meters for detailed customer information.`;
            alert(meterList);
        }

        function showCustomerDetails(meterId) {
            // Find the meter across all transformers
            let customerMeter = null;
            let transformerId = null;

            for (const [tId, meters] of Object.entries(smartMeterData)) {
                const meter = meters.find(m => m.id === meterId);
                if (meter) {
                    customerMeter = meter;
                    transformerId = tId;
                    break;
                }
            }

            if (!customerMeter) {
                alert('Customer information not found');
                return;
            }

            alert(`Customer Information - ${customerMeter.customerName}

Personal Details:
â€¢ Full Name: ${customerMeter.customerName}
â€¢ Ghana Card: ${customerMeter.ghanaCard}
â€¢ Phone: ${customerMeter.phone}
â€¢ GPS Address: ${customerMeter.gpsAddress}
â€¢ Physical Address: ${customerMeter.physicalAddress}

Meter Information:
â€¢ Meter ID: ${customerMeter.id}
â€¢ Meter Type: ${customerMeter.meterType}
â€¢ Connected to: ${transformerId}
â€¢ Status: ${customerMeter.status}
â€¢ Install Date: ${customerMeter.installDate}

Usage & Billing:
â€¢ Last Reading: ${customerMeter.lastReading}
â€¢ Current Balance: ${customerMeter.balance}
â€¢ Payment Status: ${customerMeter.balance.includes('-') ? 'Outstanding' : 'Credit Available'}

Location Details:
â€¢ GPS Coordinates: ${customerMeter.gpsAddress}
â€¢ Service Area: ${transformerId === 'TR-ACC-001' ? 'Osu Zone, Greater Accra' : 'Kumasi Central Zone, Ashanti'}
â€¢ Area Type: Urban`);
        }

        // Link from Ghana map to specific transformer/meter
        function linkToTransformerFromMap(transformerId, meterId = null) {
            console.log(`Linking from map to transformer: ${transformerId}, meter: ${meterId}`);

            // Switch to transformers view
            showView('transformers');

            // If specific meter is provided, show customer details after a delay
            if (meterId) {
                setTimeout(() => {
                    showCustomerDetails(meterId);
                }, 1000);
            } else {
                // Show transformer smart meters
                setTimeout(() => {
                    viewSmartMeters(transformerId);
                }, 1000);
            }
        }

        // Check for JavaScript errors
        window.addEventListener('error', function (e) {
            console.error('ðŸš¨ JavaScript Error:', e.error);
            console.error('File:', e.filename, 'Line:', e.lineno);
        });

        // Initialize dashboard view on load
        document.addEventListener('DOMContentLoaded', function () {
            console.log('PowerGridX Integrated Platform loaded');

            // Force initial clean state
            currentView = null;
            window.viewSwitching = false;

            // Hide all views initially
            document.querySelectorAll('.view-container').forEach(view => {
                view.classList.remove('active');
                view.style.display = 'none';
                view.style.opacity = '0';
                view.style.visibility = 'hidden';
                view.style.zIndex = '-1';
            });

            // Hide map elements initially
            const chartDiv = document.getElementById('chartdiv');
            const sidebar = document.getElementById('sidebar');
            if (chartDiv) {
                chartDiv.classList.remove('active-map');
                chartDiv.style.display = 'none';
                chartDiv.style.visibility = 'hidden';
                chartDiv.style.opacity = '0';
            }
            if (sidebar) {
                sidebar.classList.remove('active-map');
                sidebar.style.display = 'none';
                sidebar.style.visibility = 'hidden';
                sidebar.style.opacity = '0';
            }

            // Set initial body attribute
            document.body.setAttribute('data-current-view', 'dashboard');

            // Initialize with dashboard view after a brief delay
            setTimeout(() => {
                showView('dashboard');
            }, 200);

            // Make sure Ghana map functions are available globally
            if (typeof showNoSelection === 'function') {
                window.showNoSelection = showNoSelection;
            }
            if (typeof showRegionDistricts === 'function') {
                window.showRegionDistricts = showRegionDistricts;
            }
            if (typeof showAvailableRegions === 'function') {
                window.showAvailableRegions = showAvailableRegions;
            }

            console.log('Initialization complete');
        });

        // Additional fallback to ensure sidebar always initializes
        window.addEventListener('load', function () {
            setTimeout(() => {
                if (currentView === 'grid') {
                    const districtInfo = document.getElementById('district-info');
                    if (districtInfo && districtInfo.innerHTML.trim() === '') {
                        console.log('ðŸš¨ Window loaded but grid sidebar still empty, forcing initialization...');
                        showNoSelection();
                    }
                }
            }, 2000);
        });

        // Debug function for testing sidebar visibility
        window.debugSidebarVisibility = function () {
            console.log('ðŸ” DEBUGGING SIDEBAR VISIBILITY...');

            const sidebar = document.getElementById('sidebar');
            const gridView = document.getElementById('grid-view');
            const districtInfo = document.getElementById('district-info');
            const bodyAttr = document.body.getAttribute('data-current-view');

            console.log('=== SIDEBAR DEBUG INFO ===');
            console.log('Current view:', currentView);
            console.log('Body data-current-view:', bodyAttr);
            console.log('Grid view element exists:', !!gridView);
            console.log('Grid view classes:', gridView?.className);
            console.log('Sidebar element exists:', !!sidebar);
            console.log('District info exists:', !!districtInfo);

            if (sidebar) {
                const computedStyle = window.getComputedStyle(sidebar);
                console.log('Sidebar computed display:', computedStyle.display);
                console.log('Sidebar computed visibility:', computedStyle.visibility);
                console.log('Sidebar computed opacity:', computedStyle.opacity);
                console.log('Sidebar computed z-index:', computedStyle.zIndex);
                console.log('Sidebar inline styles:', sidebar.style.cssText);

                // Force sidebar visible
                console.log('ðŸ”§ FORCING SIDEBAR VISIBLE...');
                sidebar.style.setProperty('display', 'block', 'important');
                sidebar.style.setProperty('visibility', 'visible', 'important');
                sidebar.style.setProperty('opacity', '1', 'important');
                sidebar.style.setProperty('z-index', '9999', 'important');
                sidebar.style.setProperty('background-color', '#1a1a1a', 'important');
                sidebar.style.setProperty('color', 'white', 'important');
                sidebar.style.setProperty('width', '30%', 'important');
                sidebar.style.setProperty('height', '100%', 'important');

                // Set body attribute
                document.body.setAttribute('data-current-view', 'grid');

                // Initialize content
                showNoSelection();

                console.log('âœ… Sidebar forced visible and content initialized');
            }
        };

        // Debug function for testing sidebar
        window.debugSidebar = function () {
            console.log('ðŸ” Debug: Checking sidebar state...');
            const sidebar = document.getElementById('district-info');
            const gridView = document.getElementById('grid-view');
            const chartDiv = document.getElementById('chartdiv');

            console.log('Current view:', currentView);
            console.log('Grid view element:', !!gridView);
            console.log('Grid view active:', gridView?.classList.contains('active'));
            console.log('Chart div element:', !!chartDiv);
            console.log('Sidebar element:', !!sidebar);
            console.log('Sidebar content length:', sidebar?.innerHTML.length || 0);
            console.log('Sidebar content preview:', sidebar?.innerHTML.substring(0, 100) + '...');

            if (sidebar && sidebar.innerHTML.trim() === '') {
                console.log('ðŸ”§ Sidebar is empty, initializing...');
                showNoSelection();
            }
        };

        // EMERGENCY SIDEBAR TEST - Direct bypass of all complex logic
        window.emergencyShowSidebar = function () {
            console.log('ðŸš¨ EMERGENCY SIDEBAR TEST - Bypassing all logic...');

            // Force switch to grid view
            document.body.setAttribute('data-current-view', 'grid');

            // Hide all views
            document.querySelectorAll('.view-container').forEach(view => {
                view.classList.remove('active');
                view.style.display = 'none';
            });

            // Show grid view
            const gridView = document.getElementById('grid-view');
            if (gridView) {
                gridView.classList.add('active');
                gridView.style.display = 'flex';
                gridView.style.width = '100%';
                gridView.style.height = '100%';
            }

            // Force sidebar visible
            const sidebar = document.getElementById('sidebar');
            if (sidebar) {
                sidebar.style.cssText = `
                    display: block !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    width: 30% !important;
                    height: 100% !important;
                    background-color: #1a1a1a !important;
                    color: white !important;
                    padding: 0 !important;
                    box-sizing: border-box !important;
                    overflow-y: auto !important;
                    border-left: 2px solid #333 !important;
                    z-index: 9999 !important;
                `;

                // Force content
                const districtInfo = document.getElementById('district-info');
                if (districtInfo) {
                    districtInfo.innerHTML = `
                        <div style="padding: 20px;">
                            <h2 style="color: #F97316; text-align: center; margin-bottom: 30px;">ðŸ‡¬ðŸ‡­ EMERGENCY TEST</h2>
                            
                            <div style="padding: 20px; background: linear-gradient(135deg, #2a2a2a, #333); border-radius: 12px; cursor: pointer; margin-bottom: 16px;" onclick="alert('Greater Accra works!')">
                                <div style="font-weight: bold; font-size: 18px; margin-bottom: 4px;">Greater Accra</div>
                                <div style="font-size: 13px; color: #ccc;">Click to test</div>
                            </div>
                            
                            <div style="padding: 20px; background: linear-gradient(135deg, #2a2a2a, #333); border-radius: 12px; cursor: pointer; margin-bottom: 16px;" onclick="alert('Ashanti works!')">
                                <div style="font-weight: bold; font-size: 18px; margin-bottom: 4px;">Ashanti</div>
                                <div style="font-size: 13px; color: #ccc;">Click to test</div>
                            </div>
                            
                            <div style="padding: 20px; background: linear-gradient(135deg, #2a2a2a, #333); border-radius: 12px; cursor: pointer; margin-bottom: 16px;" onclick="alert('Western works!')">
                                <div style="font-weight: bold; font-size: 18px; margin-bottom: 4px;">Western</div>
                                <div style="font-size: 13px; color: #ccc;">Click to test</div>
                            </div>
                            
                            <div style="padding: 16px; background: #1a3a1a; border-radius: 8px; border: 1px solid #4CAF50;">
                                <p style="margin: 0; color: #4CAF50; font-size: 14px;">
                                    âœ… EMERGENCY TEST SUCCESSFUL!<br>
                                    If you can see this, the sidebar CAN work.
                                </p>
                            </div>
                        </div>
                    `;
                }

                console.log('âœ… Emergency sidebar test completed');
            }
        };

        // Add keyboard shortcuts
        document.addEventListener('keydown', function (e) {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case '1':
                        e.preventDefault();
                        showView('dashboard');
                        break;
                    case '2':
                        e.preventDefault();
                        showView('grid');
                        break;
                    case '3':
                        e.preventDefault();
                        showView('transformers');
                        break;
                    case '4':
                        e.preventDefault();
                        showView('audit');
                        break;
                    case '5':
                        e.preventDefault();
                        showView('dispatch');
                        break;
                }
            }
        });

        // Add view transition animations
        function addTransitionEffects() {
            const style = document.createElement('style');
            style.textContent = `
                .view-container {
                    transition: opacity 0.3s ease-in-out;
                }
                .view-container:not(.active) {
                    opacity: 0;
                    pointer-events: none;
                }
                .view-container.active {
                    opacity: 1;
                    pointer-events: all;
                }
            `;
            document.head.appendChild(style);
        }

        // Initialize transition effects
        addTransitionEffects();
    </script>
</body>

</html>