<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerGridX Dashboard - Smart Infrastructure for Africa</title>
    <link rel="icon" href="favicon/favicon.svg" type="image/svg+xml">
    <!-- Updated: Enhanced dashboard with Chart.js, live notifications, and improved UX -->
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'ui-sans-serif', 'system-ui'],
                    },
                    colors: {
                        'pgx-green': '#10b981',
                        'pgx-blue': '#3b82f6',
                        'pgx-gray': '#f8fafc',
                    }
                }
            }
        }
    </script>
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pgx-orange': '#FF6B00',
                        'pgx-orange-light': '#FF8533',
                        'pgx-orange-dark': '#E55A00',
                        'pgx-blue': '#3B82F6',
                        'pgx-green': '#10B981',
                        'pgx-red': '#EF4444',
                        'pgx-yellow': '#F59E0B'
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Energy-themed animations and effects */

        /* Logo glow effect */
        @keyframes energy-glow {
            0%, 100% {
                box-shadow: 0 0 10px rgba(249, 115, 22, 0.5), 0 0 20px rgba(249, 115, 22, 0.3), 0 0 30px rgba(249, 115, 22, 0.1);
            }
            50% {
                box-shadow: 0 0 15px rgba(249, 115, 22, 0.8), 0 0 30px rgba(249, 115, 22, 0.5), 0 0 45px rgba(249, 115, 22, 0.2);
            }
        }

        .logo-glow {
            animation: energy-glow 3s ease-in-out infinite;
        }

        /* Energy pulse for lightning bolt */
        @keyframes energy-pulse {
            0%, 100% {
                transform: scale(1);
                filter: brightness(1);
            }
            50% {
                transform: scale(1.1);
                filter: brightness(1.3);
            }
        }

        .energy-pulse {
            animation: energy-pulse 2s ease-in-out infinite;
        }

        /* Heartbeat pulse for live indicator */
        @keyframes heartbeat {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            25% {
                transform: scale(1.2);
                opacity: 0.8;
            }
            50% {
                transform: scale(1);
                opacity: 1;
            }
            75% {
                transform: scale(1.1);
                opacity: 0.9;
            }
        }

        .heartbeat-pulse {
            animation: heartbeat 2s ease-in-out infinite;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.6);
        }

        /* Live data text pulse */
        @keyframes text-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .live-text {
            animation: text-pulse 3s ease-in-out infinite;
        }

        /* Navigation button hover effects */
        .nav-btn {
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn:hover {
            box-shadow: 0 0 15px rgba(249, 115, 22, 0.4);
            border: 1px solid rgba(249, 115, 22, 0.3);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #f97316, #ea580c) !important;
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.6);
            border: 1px solid rgba(249, 115, 22, 0.5);
        }

        /* Theme toggle animations */
        @keyframes theme-rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .theme-btn:hover .theme-icon {
            animation: theme-rotate 0.8s ease-in-out;
        }

        .theme-btn {
            position: relative;
            overflow: hidden;
        }

        .theme-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(249, 115, 22, 0.3), transparent);
            transition: all 0.3s ease;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .theme-btn:hover::after {
            width: 40px;
            height: 40px;
        }

        /* Logo container hover effect */
        .logo-container:hover .brand-text h1 {
            text-shadow: 0 0 10px rgba(249, 115, 22, 0.5);
        }

        /* Status container hover effect */
        .status-container:hover {
            transform: translateY(-1px);
            transition: transform 0.2s ease;
        }

        /* Dark theme styles */
        .dark-theme {
            background: linear-gradient(135deg, #1e293b, #334155) !important;
        }

        .dark-theme .nav-btn {
            background: #475569 !important;
        }

        .dark-theme .nav-btn:hover {
            background: #64748b !important;
        }

        /* Microinteraction ripple effect */
        @keyframes ripple {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(4);
                opacity: 0;
            }
        }

        .ripple-effect {
            position: relative;
            overflow: hidden;
        }

        .ripple-effect::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        /* Smooth transitions for all interactive elements */
        .nav-btn, .theme-btn, .logo-container, .status-container {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Glow effect for active elements */
        .glow-active {
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.6), 0 0 40px rgba(249, 115, 22, 0.4);
        }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #FF6B00;
            border-radius: 3px;
        }
        
        /* Card hover effects */
        .metric-card {
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        /* Navigation active state */
        .nav-active {
            background-color: #FF6B00 !important;
            color: white !important;
        }
        
        .nav-inactive {
            background-color: #64748b;
            color: white;
        }
        
        .nav-inactive:hover {
            background-color: #475569;
        }

        /* Enhanced navigation styles */
        .nav-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        /* Heartbeat animation */
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); opacity: 1; }
            25% { transform: scale(1.1); opacity: 0.8; }
            50% { transform: scale(1); opacity: 1; }
            75% { transform: scale(1.05); opacity: 0.9; }
        }

        .heartbeat {
            animation: heartbeat 2s ease-in-out infinite;
        }

        /* Profile dropdown */
        .profile-dropdown {
            transform: translateY(-10px) scale(0.95);
            opacity: 0;
            transition: all 0.2s ease-out;
        }

        .profile-dropdown.show {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        /* Dark mode styles */
        .dark-mode {
            background-color: #1a1a1a !important;
            color: #e5e5e5 !important;
        }

        .dark-mode header {
            background-color: #2d3748 !important;
        }

        .dark-mode .bg-white {
            background-color: #2d3748 !important;
            color: #e5e5e5 !important;
        }

        .dark-mode .bg-gray-50 {
            background-color: #1a1a1a !important;
        }

        .dark-mode .text-gray-900 {
            color: #e5e5e5 !important;
        }

        .dark-mode .text-gray-600 {
            color: #a0a0a0 !important;
        }

        .dark-mode .text-gray-500 {
            color: #888888 !important;
        }

        .dark-mode .border-gray-200 {
            border-color: #4a5568 !important;
        }

        .dark-mode .border-gray-300 {
            border-color: #4a5568 !important;
        }

        .dark-mode .bg-slate-700 {
            background-color: #1a202c !important;
        }

        .dark-mode .bg-slate-600 {
            background-color: #2d3748 !important;
        }

        .dark-mode .bg-slate-500 {
            background-color: #4a5568 !important;
        }

        .dark-mode input, .dark-mode select, .dark-mode textarea {
            background-color: #2d3748 !important;
            color: #e5e5e5 !important;
            border-color: #4a5568 !important;
        }

        .dark-mode .shadow-sm, .dark-mode .shadow-lg, .dark-mode .shadow-xl {
            box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1) !important;
        }

        /* Custom Animations */
        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes slide-up {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .pulse-soft { animation: pulse-soft 2s infinite; }
        .slide-up { animation: slide-up 0.5s ease-out; }
        .fade-in { animation: fade-in 0.3s ease-out; }

        /* Card Hover Effects */
        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 350px;
            min-width: 300px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Light Alert Styles */
        .light-alert {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            font-size: 14px;
            line-height: 1.4;
        }

        .alert-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 999;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            animation: pulse-alert 2s infinite;
            cursor: pointer;
        }

        @keyframes pulse-alert {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        /* Heartbeat animation for districts */
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { transform: scale(1); }
            75% { transform: scale(1.05); }
        }

        .heartbeat {
            animation: heartbeat 2s infinite;
        }

        /* Loading Spinner */
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Better spacing */
        .dashboard-section {
            margin-bottom: 2rem;
        }

        .metric-card {
            padding: 1.5rem;
            border-radius: 12px;
            background: white;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Navigation Header -->
    <header class="bg-slate-700 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo and Title -->
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 rounded-lg overflow-hidden">
                        <video autoplay loop muted class="w-full h-full object-cover">
                            <source src="PGXLogo.webm" type="video/webm">
                            <!-- Fallback for browsers that don't support video -->
                            <div class="w-8 h-8 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center">
                                <span class="text-white font-bold">⚡</span>
                            </div>
                        </video>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">
                            PowerGridX
                        </h1>
                        <p class="text-xs text-gray-300">Smart Infrastructure Platform</p>
                    </div>
                </div>

                <!-- Navigation -->
                <nav class="hidden lg:flex items-center space-x-2">
                    <a href="index.html" class="nav-btn bg-orange-500 text-white px-3 py-2 rounded-lg text-xs font-medium">
                        Dashboard
                    </a>
                    <a href="smart-grid.html" class="nav-btn bg-slate-600 hover:bg-slate-500 text-white px-3 py-2 rounded-lg text-xs font-medium transition-all duration-300">
                        Smart Grid
                    </a>
                    <a href="transformers.html" class="nav-btn bg-slate-600 hover:bg-slate-500 text-white px-3 py-2 rounded-lg text-xs font-medium transition-all duration-300">
                        Transformers
                    </a>
                    <a href="audit-log.html" class="nav-btn bg-slate-600 hover:bg-slate-500 text-white px-3 py-2 rounded-lg text-xs font-medium transition-all duration-300">
                        Audit Log
                    </a>
                    <a href="dispatch.html" class="nav-btn bg-slate-600 hover:bg-slate-500 text-white px-3 py-2 rounded-lg text-xs font-medium transition-all duration-300">
                        Dispatch
                    </a>
                    <a href="notifications.html" class="nav-btn bg-slate-600 hover:bg-slate-500 text-white px-3 py-2 rounded-lg text-xs font-medium relative transition-all duration-300">
                        Notifications
                        <span id="notification-badge" class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">5</span>
                    </a>
                    <a href="history.html" class="nav-btn bg-slate-600 hover:bg-slate-500 text-white px-3 py-2 rounded-lg text-xs font-medium transition-all duration-300">
                        History
                    </a>
                </nav>

                <!-- Right Side Controls -->
                <div class="flex items-center space-x-4">
                    <!-- Theme Toggle -->
                    <button id="theme-toggle" class="w-8 h-8 bg-slate-600 hover:bg-slate-500 rounded-lg flex items-center justify-center transition-all duration-300 hover:scale-110">
                        <span class="text-yellow-400 text-sm">☀️</span>
                    </button>

                    <!-- Status -->
                    <div class="flex items-center space-x-2">
                        <span class="w-2 h-2 bg-green-500 rounded-full heartbeat"></span>
                        <span class="text-sm text-gray-300">Cloud Connected • Live Data</span>
                    </div>

                    <!-- Profile -->
                    <div class="relative">
                        <button id="profile-toggle" class="flex items-center space-x-2 bg-slate-600 hover:bg-slate-500 px-3 py-2 rounded-lg transition-all duration-300">
                            <div class="w-6 h-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                                <span class="text-white text-xs font-bold">A</span>
                            </div>
                            <span class="text-white text-sm">Admin</span>
                            <svg class="w-4 h-4 text-gray-300 transition-transform duration-200" id="profile-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>

                        <!-- Profile Dropdown -->
                        <div id="profile-dropdown" class="profile-dropdown absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 hidden z-50">
                            <div class="p-4 border-b border-gray-200">
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                                        <span class="text-white text-lg font-bold">A</span>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900">Administrator</h3>
                                        <p class="text-sm text-gray-500">ADM-001</p>
                                    </div>
                                </div>
                            </div>

                            <div class="p-4 space-y-3">
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span class="text-gray-500">Role:</span>
                                        <p class="font-medium">Super Admin</p>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">Login Time:</span>
                                        <p class="font-medium">5:43:20 AM</p>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">Last Logout:</span>
                                        <p class="font-medium">Yesterday 11:30 PM</p>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">Session:</span>
                                        <p class="font-medium text-green-600">Active</p>
                                    </div>
                                </div>

                                <div class="border-t pt-3">
                                    <h4 class="text-sm font-medium text-gray-900 mb-2">Access Control</h4>
                                    <div class="grid grid-cols-2 gap-2 text-xs">
                                        <div class="flex items-center space-x-1">
                                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                            <span>Full System Access</span>
                                        </div>
                                        <div class="flex items-center space-x-1">
                                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                            <span>User Management</span>
                                        </div>
                                        <div class="flex items-center space-x-1">
                                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                            <span>Grid Control</span>
                                        </div>
                                        <div class="flex items-center space-x-1">
                                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                            <span>Audit Logs</span>
                                        </div>
                                    </div>
                                </div>

                                <button class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg text-sm font-medium transition-colors">
                                    Sign Out
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Notification Container -->
    <div id="notification-container"></div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 font-sans">
        <!-- Region Selector -->
        <div class="dashboard-section">
            <div class="metric-card card-hover slide-up">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900 mb-1">⚡ Grid Monitoring Dashboard</h2>
                        <p class="text-sm text-gray-600">Select a region to view detailed infrastructure data</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <label class="text-sm font-medium text-gray-700">📍 Current Region:</label>
                        <select id="dashboard-region-selector" class="border border-gray-300 rounded-lg px-4 py-2 text-sm font-medium bg-white hover:border-pgx-blue transition-colors" onchange="updateDashboardRegion()">
                            <option value="ashanti">🏛️ Ashanti Region</option>
                            <option value="greater-accra">🏙️ Greater Accra</option>
                            <option value="western">🌊 Western Region</option>
                            <option value="central">🏖️ Central Region</option>
                            <option value="northern">🌾 Northern Region</option>
                            <option value="eastern">🌲 Eastern Region</option>
                            <option value="upper-east">⛰️ Upper East</option>
                            <option value="upper-west">🏔️ Upper West</option>
                            <option value="volta">🏞️ Volta Region</option>
                            <option value="brong-ahafo">🌳 Brong Ahafo</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Overview -->
        <div class="dashboard-section">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8" id="system-overview"></div>
        </div>
            <!-- System Status Card -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">System Status</p>
                        <p class="text-2xl font-bold text-green-600">Operational</p>
                        <p class="text-sm text-gray-500 mt-1">All systems running</p>
                    </div>
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Active Transformers Card -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Active Transformers</p>
                        <p class="text-2xl font-bold text-gray-900">77</p>
                        <p class="text-sm text-blue-600 mt-1">1 Critical Alert</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Smart Meters Card -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Smart Meters</p>
                        <p class="text-2xl font-bold text-gray-900">14,801</p>
                        <p class="text-sm text-green-600 mt-1">85% Coverage</p>
                    </div>
                    <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Regional Performance and System Health -->
        <div class="dashboard-section">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Regional Performance Chart -->
                <div class="metric-card card-hover slide-up">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-xl font-semibold text-gray-900 mb-1">📊 Regional Performance</h2>
                            <p class="text-sm text-gray-600">Energy output by region (MW)</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button id="chart-type-bar" onclick="switchChartType('bar')" class="px-3 py-2 bg-pgx-blue text-white rounded-lg text-sm font-medium transition-all hover:bg-blue-600">
                                📊 Bar
                            </button>
                            <button id="chart-type-line" onclick="switchChartType('line')" class="px-3 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-all hover:bg-gray-300">
                                📈 Line
                            </button>
                        </div>
                    </div>

                    <!-- Chart Container -->
                    <div class="chart-container">
                        <canvas id="regional-performance-chart"></canvas>
                    </div>

                    <div class="text-xs text-gray-500 mt-4 flex items-center justify-between">
                        <span>📅 Weekly energy output • Last updated: 2 minutes ago</span>
                        <span class="text-pgx-blue">Click bars for details</span>
                    </div>
            </div>

                <!-- System Health -->
                <div class="metric-card card-hover slide-up">
                    <h2 class="text-xl font-semibold text-gray-900 mb-1">🔧 System Health</h2>
                    <p class="text-sm text-gray-600 mb-6">Overall infrastructure status</p>

                <div class="space-y-6" id="system-health-content">
                    <!-- Online Transformers -->
                    <div class="cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors" onclick="showSystemDetails('transformers')">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Online Transformers</span>
                            <span class="text-lg font-bold text-green-600">94%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-green-500 h-2 rounded-full transition-all duration-300" style="width: 94%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">72 of 77 transformers online</div>
                    </div>

                    <!-- Active Smart Nodes -->
                    <div class="cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors" onclick="showSystemDetails('nodes')">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Active Smart Nodes</span>
                            <span class="text-lg font-bold text-blue-600">89%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 89%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">156 of 175 nodes active</div>
                    </div>

                    <!-- Meter Connectivity -->
                    <div class="cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors" onclick="showSystemDetails('meters')">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Meter Connectivity</span>
                            <span class="text-lg font-bold text-purple-600">97%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-purple-500 h-2 rounded-full transition-all duration-300" style="width: 97%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">14,357 of 14,801 meters connected</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Energy Metrics -->
        <div class="dashboard-section">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Total Energy Tracked -->
                <div class="metric-card card-hover slide-up">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">⚡ Total Energy Tracked</p>
                            <p class="text-2xl font-bold text-gray-900"><span id="total-energy">2,862.7</span> <span class="text-sm font-normal text-gray-500">kWh</span></p>
                            <p class="text-sm text-pgx-green mt-1">📈 2.1% from last hour</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center pulse-soft">
                            <span class="text-2xl">⚡</span>
                        </div>
                    </div>
            </div>

            <!-- Energy Theft Detected -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Energy Theft Detected</p>
                        <p class="text-2xl font-bold text-gray-900"><span id="energy-theft">12.5</span> <span class="text-sm font-normal text-gray-500">%</span></p>
                        <p class="text-sm text-green-600 mt-1">↘ 0.8% from last hour</p>
                    </div>
                    <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Smart Poles Connected -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Smart Poles Connected</p>
                        <p class="text-2xl font-bold text-gray-900"><span id="smart-poles">65</span></p>
                        <p class="text-sm text-green-600 mt-1">↗ 1.2% from last hour</p>
                    </div>
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Active Alerts with AI Predictions -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 cursor-pointer hover:bg-gray-50 transition-colors" onclick="showAIPredictions()">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Active Alerts</p>
                        <p class="text-2xl font-bold text-gray-900"><span id="active-alerts">2</span></p>
                        <p class="text-sm text-gray-500 mt-1">Current system notifications</p>
                        <p class="text-xs text-blue-600 mt-1">🤖 AI Predictions Available</p>
                    </div>
                    <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Overview and Live Power Generation -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Grid Performance Metrics -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Grid Performance</h3>
                <div class="space-y-6">
                    <!-- Grid Performance -->
                    <div class="cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors" onclick="showPerformanceDetails('grid')">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Grid Performance</span>
                            <span class="text-lg font-bold text-blue-600">75%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div class="bg-blue-500 h-3 rounded-full transition-all duration-300" style="width: 75%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">Load balancing and distribution efficiency</div>
                    </div>

                    <!-- Efficiency -->
                    <div class="cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors" onclick="showPerformanceDetails('efficiency')">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Efficiency</span>
                            <span class="text-lg font-bold text-green-600">88%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div class="bg-green-500 h-3 rounded-full transition-all duration-300" style="width: 88%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">Energy transmission and conversion efficiency</div>
                    </div>

                    <!-- Reliability -->
                    <div class="cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors" onclick="showPerformanceDetails('reliability')">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Reliability</span>
                            <span class="text-lg font-bold text-purple-600">94%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div class="bg-purple-500 h-3 rounded-full transition-all duration-300" style="width: 94%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">System uptime and fault tolerance</div>
                    </div>
                </div>
            </div>

            <!-- Live Power Generation -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Power Generation</h3>
                        <p class="text-sm text-gray-600">Based on LoRa Base Towers near transmission stations</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <button id="power-chart-bar" onclick="switchPowerChart('bar')" class="px-2 py-1 bg-blue-500 text-white rounded text-xs transition-colors">
                                Bar
                            </button>
                            <button id="power-chart-line" onclick="switchPowerChart('line')" class="px-2 py-1 bg-gray-300 text-gray-700 rounded text-xs transition-colors">
                                Line
                            </button>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-xs text-green-600 font-medium">Live</span>
                        </div>
                    </div>
                </div>

                <div class="text-center mb-6">
                    <div class="text-3xl font-bold text-gray-900" id="live-power-generation">1,738</div>
                    <div class="text-sm text-gray-500">kW</div>
                    <div class="text-xs text-blue-600 mt-1">Real-time Power Generation</div>
                </div>

                <!-- Interactive Power Chart -->
                <div id="power-chart-container" class="relative h-32 mb-4">
                    <!-- Bar Chart -->
                    <div id="power-bar-chart" class="flex items-end justify-between h-full">
                        <div class="flex flex-col items-center flex-1">
                            <div class="w-8 bg-gradient-to-t from-blue-500 to-blue-300 rounded-t transition-all duration-1000"
                                 id="power-bar-1" style="height: 60%"></div>
                            <span class="text-xs text-gray-500 mt-1">1h ago</span>
                        </div>
                        <div class="flex flex-col items-center flex-1">
                            <div class="w-8 bg-gradient-to-t from-blue-500 to-blue-300 rounded-t transition-all duration-1000"
                                 id="power-bar-2" style="height: 75%"></div>
                            <span class="text-xs text-gray-500 mt-1">45m</span>
                        </div>
                        <div class="flex flex-col items-center flex-1">
                            <div class="w-8 bg-gradient-to-t from-blue-500 to-blue-300 rounded-t transition-all duration-1000"
                                 id="power-bar-3" style="height: 85%"></div>
                            <span class="text-xs text-gray-500 mt-1">30m</span>
                        </div>
                        <div class="flex flex-col items-center flex-1">
                            <div class="w-8 bg-gradient-to-t from-blue-500 to-blue-300 rounded-t transition-all duration-1000"
                                 id="power-bar-4" style="height: 70%"></div>
                            <span class="text-xs text-gray-500 mt-1">15m</span>
                        </div>
                        <div class="flex flex-col items-center flex-1">
                            <div class="w-8 bg-gradient-to-t from-green-500 to-green-300 rounded-t transition-all duration-1000 animate-pulse"
                                 id="power-bar-5" style="height: 90%"></div>
                            <span class="text-xs text-green-600 mt-1 font-medium">Now</span>
                        </div>
                    </div>

                    <!-- Line Chart -->
                    <div id="power-line-chart" class="hidden h-full">
                        <canvas id="power-line-canvas" class="w-full h-full"></canvas>
                    </div>
                </div>

                <div class="text-xs text-gray-500 text-center">
                    Auto-refresh every hour • Next update: <span id="next-update-time">59:42</span>
                </div>
            </div>
        </div>

        <!-- Network Coverage and LoRaWAN Infrastructure -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Network Coverage -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Network Coverage</h3>
                    <select id="region-selector" class="border border-gray-300 rounded-lg px-3 py-1 text-sm" onchange="updateNetworkCoverage()">
                        <option value="ashanti">Ashanti Region</option>
                        <option value="greater-accra">Greater Accra</option>
                        <option value="western">Western Region</option>
                        <option value="central">Central Region</option>
                        <option value="northern">Northern Region</option>
                        <option value="eastern">Eastern Region</option>
                        <option value="upper-east">Upper East</option>
                        <option value="upper-west">Upper West</option>
                        <option value="volta">Volta Region</option>
                        <option value="brong-ahafo">Brong Ahafo</option>
                    </select>
                </div>

                <div id="network-coverage-content">
                    <div class="text-center mb-6">
                        <div class="text-3xl font-bold text-gray-900">94%</div>
                        <div class="text-sm text-gray-500">Ashanti Region</div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                            <span class="text-sm font-medium text-gray-700">Urban</span>
                            <span class="text-lg font-bold text-green-600">98%</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                            <span class="text-sm font-medium text-gray-700">Rural</span>
                            <span class="text-lg font-bold text-yellow-600">87%</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                            <span class="text-sm font-medium text-gray-700">Peri-Urban</span>
                            <span class="text-lg font-bold text-blue-600">92%</span>
                        </div>
                    </div>

                    <!-- Additional Network Metrics -->
                    <div class="mt-6 pt-4 border-t border-gray-200">
                        <h4 class="text-sm font-medium text-gray-900 mb-3">Network Performance</h4>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div class="bg-gray-50 p-2 rounded">
                                <div class="text-gray-600">Data Transmission</div>
                                <div class="font-bold text-gray-900"><span id="data-transmission">1.2</span> TB</div>
                                <div class="text-xs text-gray-500">Data transmitted today</div>
                            </div>
                            <div class="bg-gray-50 p-2 rounded">
                                <div class="text-gray-600">Success Rate</div>
                                <div class="font-bold text-green-600"><span id="success-rate">99.8</span>%</div>
                            </div>
                            <div class="bg-gray-50 p-2 rounded">
                                <div class="text-gray-600">Avg Latency</div>
                                <div class="font-bold text-blue-600"><span id="avg-latency">12</span>ms</div>
                            </div>
                            <div class="bg-gray-50 p-2 rounded">
                                <div class="text-gray-600">Power Monitoring</div>
                                <div class="font-bold text-purple-600"><span id="total-transmission">211</span> MWh</div>
                                <div class="text-xs text-gray-500">Total transmission</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LoRaWAN Infrastructure Overview -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">LoRaWAN Infrastructure</h3>
                    <button class="text-blue-600 text-sm hover:text-blue-800 transition-colors">View All</button>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <!-- LoRaWAN Base Stations -->
                    <div class="cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors" onclick="showInfrastructureDetails('base-stations')">
                        <div class="text-center">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path>
                                </svg>
                            </div>
                            <div class="text-sm font-medium text-gray-700">LoRaWAN Base Stations</div>
                            <div class="text-lg font-bold text-gray-900">5</div>
                            <div class="text-xs text-green-600">4 Active • 1 Maintenance</div>
                        </div>
                    </div>

                    <!-- Smart Meters -->
                    <div class="cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors" onclick="showInfrastructureDetails('smart-meters')">
                        <div class="text-center">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                            </div>
                            <div class="text-sm font-medium text-gray-700">Smart Meters</div>
                            <div class="text-lg font-bold text-gray-900">13,743</div>
                            <div class="text-xs text-blue-600">LoRa-enabled monitoring</div>
                        </div>
                    </div>

                    <!-- Monitored Transformers -->
                    <div class="cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors" onclick="showInfrastructureDetails('transformers')">
                        <div class="text-center">
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </div>
                            <div class="text-sm font-medium text-gray-700">Monitored Transformers</div>
                            <div class="text-lg font-bold text-gray-900">77</div>
                            <div class="text-xs text-purple-600">LoRa sensors attached</div>
                        </div>
                    </div>

                    <!-- Telecom Towers -->
                    <div class="cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors" onclick="showInfrastructureDetails('telecom-towers')">
                        <div class="text-center">
                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            <div class="text-sm font-medium text-gray-700">Telecom Towers</div>
                            <div class="text-lg font-bold text-gray-900">12</div>
                            <div class="text-xs text-orange-600">MTN • Vodafone • AirtelTigo</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Energy Metrics with AI Predictions -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <!-- Grid Performance -->
                    <div class="text-center">
                        <div class="relative w-16 h-16 mx-auto mb-2">
                            <svg class="w-16 h-16 transform -rotate-90" viewBox="0 0 36 36">
                                <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#E5E7EB" stroke-width="2"/>
                                <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#F59E0B" stroke-width="2" stroke-dasharray="75, 100"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span class="text-sm font-bold text-gray-900">75%</span>
                            </div>
                        </div>
                        <p class="text-xs text-gray-600">Grid Performance</p>
                    </div>

                    <!-- Efficiency -->
                    <div class="text-center">
                        <div class="relative w-16 h-16 mx-auto mb-2">
                            <svg class="w-16 h-16 transform -rotate-90" viewBox="0 0 36 36">
                                <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#E5E7EB" stroke-width="2"/>
                                <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#EC4899" stroke-width="2" stroke-dasharray="88, 100"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span class="text-sm font-bold text-gray-900">88%</span>
                            </div>
                        </div>
                        <p class="text-xs text-gray-600">Efficiency</p>
                    </div>

                    <!-- Reliability -->
                    <div class="text-center">
                        <div class="relative w-16 h-16 mx-auto mb-2">
                            <svg class="w-16 h-16 transform -rotate-90" viewBox="0 0 36 36">
                                <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#E5E7EB" stroke-width="2"/>
                                <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#10B981" stroke-width="2" stroke-dasharray="94, 100"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span class="text-sm font-bold text-gray-900">94%</span>
                            </div>
                        </div>
                        <p class="text-xs text-gray-600">Reliability</p>
                    </div>
                </div>
            </div>

            <!-- Real-time Chart -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Power Generation</h3>
                    <div class="flex items-center space-x-2">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            Live
                        </span>
                        <span class="text-sm text-gray-500">1,738 kW</span>
                    </div>
                </div>
                <div class="h-48 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg flex items-center justify-center">
                    <div class="text-center">
                        <svg class="w-12 h-12 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <p class="text-sm text-gray-500">Real-time Power Generation Chart</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- LoRaWAN Infrastructure Overview -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">LoRaWAN Infrastructure Overview</h3>
                <button class="text-sm text-blue-600 hover:text-blue-700 font-medium">View All</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Base Stations -->
                <div class="metric-card bg-white rounded-lg shadow p-6 border-l-4 border-purple-500">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-500">LoRaWAN Base Stations</h3>
                        <span class="text-xs text-purple-600 bg-purple-100 px-2 py-1 rounded">Active</span>
                    </div>
                    <div class="text-3xl font-bold text-gray-900" id="base-stations">5</div>
                    <div class="text-xs text-gray-500 mt-1">4 Active • 1 Maintenance</div>
                </div>

                <!-- Smart Meters -->
                <div class="metric-card bg-white rounded-lg shadow p-6 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-500">Smart Meters</h3>
                        <span class="text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded">Connected</span>
                    </div>
                    <div class="text-3xl font-bold text-gray-900" id="smart-meters">13,743</div>
                    <div class="text-xs text-gray-500 mt-1">LoRa-enabled monitoring</div>
                </div>

                <!-- Transformers -->
                <div class="metric-card bg-white rounded-lg shadow p-6 border-l-4 border-green-500">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-500">Monitored Transformers</h3>
                        <span class="text-xs text-green-600 bg-green-100 px-2 py-1 rounded">Online</span>
                    </div>
                    <div class="text-3xl font-bold text-gray-900" id="active-transformers">77</div>
                    <div class="text-xs text-gray-500 mt-1">LoRa sensors attached</div>
                </div>

                <!-- Telecom Towers -->
                <div class="metric-card bg-white rounded-lg shadow p-6 border-l-4 border-orange-500">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-500">Telecom Towers</h3>
                        <span class="text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded">Integrated</span>
                    </div>
                    <div class="text-3xl font-bold text-gray-900" id="telecom-towers">12</div>
                    <div class="text-xs text-gray-500 mt-1">MTN • Vodafone • AirtelTigo</div>
                </div>
            </div>
        </div>


    </main>

    <!-- Interactive JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Theme toggle functionality
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = themeToggle.querySelector('span');
            let isDarkTheme = localStorage.getItem('darkTheme') === 'true';

            // Apply saved theme
            if (isDarkTheme) {
                document.body.classList.add('dark-mode');
                themeIcon.textContent = '🌙';
            }

            themeToggle.addEventListener('click', function() {
                isDarkTheme = !isDarkTheme;
                localStorage.setItem('darkTheme', isDarkTheme);

                if (isDarkTheme) {
                    document.body.classList.add('dark-mode');
                    themeIcon.textContent = '🌙';
                } else {
                    document.body.classList.remove('dark-mode');
                    themeIcon.textContent = '☀️';
                }
            });

            // Profile dropdown functionality
            const profileToggle = document.getElementById('profile-toggle');
            const profileDropdown = document.getElementById('profile-dropdown');
            const profileArrow = document.getElementById('profile-arrow');
            let isProfileOpen = false;

            profileToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                isProfileOpen = !isProfileOpen;

                if (isProfileOpen) {
                    profileDropdown.classList.remove('hidden');
                    setTimeout(() => profileDropdown.classList.add('show'), 10);
                    profileArrow.style.transform = 'rotate(180deg)';
                } else {
                    profileDropdown.classList.remove('show');
                    profileArrow.style.transform = 'rotate(0deg)';
                    setTimeout(() => profileDropdown.classList.add('hidden'), 200);
                }
            });

            // Close profile dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (isProfileOpen && !profileToggle.contains(e.target) && !profileDropdown.contains(e.target)) {
                    isProfileOpen = false;
                    profileDropdown.classList.remove('show');
                    profileArrow.style.transform = 'rotate(0deg)';
                    setTimeout(() => profileDropdown.classList.add('hidden'), 200);
                }
            });
        });
    </script>

    <!-- Dashboard JavaScript -->
    <script src="dashboard.js"></script>

    <!-- Additional Interactive Functions -->
    <script>
        // Regional Performance Details
        function showRegionalDetails(region, output) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">${region} Region</h3>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>

                        <div class="space-y-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-medium text-blue-900">Weekly Energy Output</h4>
                                <p class="text-2xl font-bold text-blue-600">${output} MW</p>
                                <p class="text-sm text-blue-700">Average daily: ${Math.round(output/7)} MW</p>
                            </div>

                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-500">Peak Load:</span>
                                    <p class="font-medium">${Math.round(output * 1.2)} MW</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Efficiency:</span>
                                    <p class="font-medium">${Math.round(85 + Math.random() * 10)}%</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Transformers:</span>
                                    <p class="font-medium">${Math.round(output/50)} units</p>
                                </div>
                                <div>
                                    <span class="text-gray-500">Coverage:</span>
                                    <p class="font-medium">${Math.round(80 + Math.random() * 15)}%</p>
                                </div>
                            </div>

                            <div class="border-t pt-4">
                                <h4 class="text-sm font-medium text-gray-900 mb-2">Weekly Trend</h4>
                                <div class="text-xs text-gray-600">
                                    <p>• Monday: ${Math.round(output * 0.9)} MW</p>
                                    <p>• Tuesday: ${Math.round(output * 0.95)} MW</p>
                                    <p>• Wednesday: ${Math.round(output * 1.1)} MW</p>
                                    <p>• Thursday: ${Math.round(output * 1.05)} MW</p>
                                    <p>• Friday: ${Math.round(output * 1.15)} MW</p>
                                    <p>• Saturday: ${Math.round(output * 0.8)} MW</p>
                                    <p>• Sunday: ${Math.round(output * 0.75)} MW</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            window.currentModal = modal;
        }

        // System Health Details
        function showSystemDetails(type) {
            let title, data;

            if (type === 'transformers') {
                title = 'Online Transformers';
                data = [
                    { name: 'TXF-001', region: 'Greater Accra', district: 'Accra Metropolitan', gps: '5.6037, -0.1870', health: 98 },
                    { name: 'TXF-002', region: 'Greater Accra', district: 'Tema Metropolitan', gps: '5.6698, -0.0166', health: 95 },
                    { name: 'TXF-003', region: 'Ashanti', district: 'Kumasi Metropolitan', gps: '6.6885, -1.6244', health: 92 },
                    { name: 'TXF-004', region: 'Ashanti', district: 'Obuasi Municipal', gps: '6.2027, -1.6634', health: 89 },
                    { name: 'TXF-005', region: 'Western', district: 'Sekondi-Takoradi', gps: '4.9344, -1.7719', health: 96 },
                    { name: 'TXF-006', region: 'Central', district: 'Cape Coast Metropolitan', gps: '5.1053, -1.2466', health: 94 },
                    { name: 'TXF-007', region: 'Northern', district: 'Tamale Metropolitan', gps: '9.4034, -0.8424', health: 87 },
                    { name: 'TXF-008', region: 'Eastern', district: 'Koforidua Municipal', gps: '6.0898, -0.2594', health: 91 }
                ];
            } else if (type === 'nodes') {
                title = 'Active Smart Nodes';
                data = [
                    { name: 'NODE-001', region: 'Greater Accra', district: 'Accra Metropolitan', gps: '5.6037, -0.1870', health: 97 },
                    { name: 'NODE-002', region: 'Greater Accra', district: 'Ga East Municipal', gps: '5.7413, -0.1995', health: 94 },
                    { name: 'NODE-003', region: 'Ashanti', district: 'Kumasi Metropolitan', gps: '6.6885, -1.6244', health: 89 },
                    { name: 'NODE-004', region: 'Ashanti', district: 'Ejisu Municipal', gps: '6.7394, -1.3692', health: 92 },
                    { name: 'NODE-005', region: 'Western', district: 'Tarkwa-Nsuaem', gps: '5.3006, -1.9969', health: 88 },
                    { name: 'NODE-006', region: 'Central', district: 'Awutu Senya East', gps: '5.4503, -0.6731', health: 95 },
                    { name: 'NODE-007', region: 'Northern', district: 'Tamale Metropolitan', gps: '9.4034, -0.8424', health: 86 },
                    { name: 'NODE-008', region: 'Eastern', district: 'New-Juaben Municipal', gps: '6.0898, -0.2594', health: 93 }
                ];
            } else {
                title = 'Meter Connectivity';
                data = [
                    { name: 'METER-ZONE-001', region: 'Greater Accra', district: 'Accra Metropolitan', gps: '5.6037, -0.1870', health: 99 },
                    { name: 'METER-ZONE-002', region: 'Greater Accra', district: 'Tema Metropolitan', gps: '5.6698, -0.0166', health: 97 },
                    { name: 'METER-ZONE-003', region: 'Ashanti', district: 'Kumasi Metropolitan', gps: '6.6885, -1.6244', health: 96 },
                    { name: 'METER-ZONE-004', region: 'Ashanti', district: 'Obuasi Municipal', gps: '6.2027, -1.6634', health: 94 },
                    { name: 'METER-ZONE-005', region: 'Western', district: 'Sekondi-Takoradi', gps: '4.9344, -1.7719', health: 98 },
                    { name: 'METER-ZONE-006', region: 'Central', district: 'Cape Coast Metropolitan', gps: '5.1053, -1.2466', health: 95 },
                    { name: 'METER-ZONE-007', region: 'Northern', district: 'Tamale Metropolitan', gps: '9.4034, -0.8424', health: 92 },
                    { name: 'METER-ZONE-008', region: 'Eastern', district: 'Koforidua Municipal', gps: '6.0898, -0.2594', health: 97 }
                ];
            }

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">${title}</h3>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="p-6 overflow-y-auto max-h-[60vh]">
                        <div class="grid gap-4">
                            ${data.map(item => `
                                <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="font-medium text-gray-900">${item.name}</h4>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium ${item.health >= 95 ? 'text-green-600' : item.health >= 90 ? 'text-yellow-600' : 'text-red-600'}">
                                                ${item.health}%
                                            </span>
                                            <div class="w-16 bg-gray-200 rounded-full h-2">
                                                <div class="h-2 rounded-full ${item.health >= 95 ? 'bg-green-500' : item.health >= 90 ? 'bg-yellow-500' : 'bg-red-500'}"
                                                     style="width: ${item.health}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-3 gap-4 text-sm text-gray-600">
                                        <div>
                                            <span class="font-medium">Region:</span> ${item.region}
                                        </div>
                                        <div>
                                            <span class="font-medium">District:</span> ${item.district}
                                        </div>
                                        <div>
                                            <span class="font-medium">GPS:</span> ${item.gps}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            window.currentModal = modal;
        }

        // Close Modal Function
        function closeModal() {
            if (window.currentModal) {
                document.body.removeChild(window.currentModal);
                window.currentModal = null;
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (window.currentModal && e.target === window.currentModal) {
                closeModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && window.currentModal) {
                closeModal();
            }
        });

        // Enhanced Notification System
        let notificationId = 0;
        let unreadNotifications = 0;
        let allNotifications = JSON.parse(localStorage.getItem('pgx_notifications') || '[]');

        const notificationTemplates = [
            { type: 'error', message: 'Transformer TXF-003 offline in Kumasi Metro', icon: '⚡', priority: 'high', category: 'infrastructure' },
            { type: 'warning', message: '12 smart meters pending validation in Ashanti', icon: '⚠️', priority: 'medium', category: 'validation' },
            { type: 'error', message: 'Energy theft detected – Est. 8.7 kWh in Sector 5', icon: '🚨', priority: 'high', category: 'security' },
            { type: 'info', message: 'LoRa Base Station BS-002 maintenance scheduled', icon: '🔧', priority: 'low', category: 'maintenance' },
            { type: 'warning', message: 'Grid load exceeding 85% capacity in Greater Accra', icon: '📊', priority: 'medium', category: 'capacity' },
            { type: 'error', message: 'Communication lost with 3 smart poles in Western', icon: '📡', priority: 'high', category: 'communication' },
            { type: 'info', message: 'Scheduled backup to PGX Cloud completed', icon: '☁️', priority: 'low', category: 'system' },
            { type: 'warning', message: 'Voltage fluctuation detected in Central Region', icon: '⚡', priority: 'medium', category: 'power_quality' }
        ];

        function showLightAlert(notification) {
            const container = document.getElementById('notification-container');
            const id = ++notificationId;

            // Create notification object for storage
            const notificationObj = {
                id: id,
                ...notification,
                timestamp: new Date().toISOString(),
                status: 'unread',
                assignedTo: null,
                workStarted: null,
                completed: null
            };

            // Store notification
            allNotifications.unshift(notificationObj);
            localStorage.setItem('pgx_notifications', JSON.stringify(allNotifications));
            unreadNotifications++;
            updateNotificationIndicator();

            const alertEl = document.createElement('div');
            alertEl.className = `notification light-alert ${getNotificationClass(notification.type)}`;
            alertEl.innerHTML = `
                <div class="flex items-center space-x-3">
                    <span class="text-lg">${notification.icon}</span>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-800">${notification.message}</p>
                        <p class="text-xs text-gray-500 mt-1">${notification.category} • ${notification.priority} priority</p>
                    </div>
                    <button onclick="viewNotification(${id})" class="text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                        View
                    </button>
                </div>
            `;

            container.appendChild(alertEl);

            // Show alert
            setTimeout(() => alertEl.classList.add('show'), 100);

            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                alertEl.classList.remove('show');
                setTimeout(() => alertEl.remove(), 300);
            }, 5000);

            return id;
        }

        function updateNotificationIndicator() {
            let indicator = document.getElementById('notification-indicator');
            if (!indicator && unreadNotifications > 0) {
                indicator = document.createElement('div');
                indicator.id = 'notification-indicator';
                indicator.className = 'alert-indicator';
                indicator.onclick = () => window.open('notifications.html', '_blank');
                document.body.appendChild(indicator);
            }

            if (indicator) {
                if (unreadNotifications > 0) {
                    indicator.textContent = unreadNotifications > 99 ? '99+' : unreadNotifications;
                    indicator.style.display = 'flex';
                } else {
                    indicator.style.display = 'none';
                }
            }
        }

        function viewNotification(id) {
            // Mark as read
            const notification = allNotifications.find(n => n.id === id);
            if (notification && notification.status === 'unread') {
                notification.status = 'read';
                unreadNotifications--;
                localStorage.setItem('pgx_notifications', JSON.stringify(allNotifications));
                updateNotificationIndicator();
            }

            // Open notifications page
            window.open('notifications.html', '_blank');
        }

        function getNotificationClass(type) {
            const classes = {
                'info': 'bg-blue-50 border-blue-200 text-blue-800',
                'warning': 'bg-yellow-50 border-yellow-200 text-yellow-800',
                'error': 'bg-red-50 border-red-200 text-red-800',
                'success': 'bg-green-50 border-green-200 text-green-800'
            };
            return classes[type] || classes.info;
        }

        function dismissNotification(id) {
            const notification = document.querySelector(`.notification:nth-child(${id})`);
            if (notification) {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }
        }

        function retryAction(id) {
            dismissNotification(id);
            showNotification({ type: 'success', message: 'Reconnection attempt successful!', icon: '✅' });
        }

        // Start notification system
        function startNotificationSystem() {
            // Show alerts every 1 minute
            setInterval(() => {
                const randomNotification = notificationTemplates[Math.floor(Math.random() * notificationTemplates.length)];
                showLightAlert(randomNotification);
            }, 60000); // Every 1 minute

            // AI monitoring system - check pending tasks every 2 minutes
            setInterval(() => {
                checkPendingTasks();
            }, 120000); // Every 2 minutes
        }

        // AI Task Monitoring System
        function checkPendingTasks() {
            const pendingTasks = allNotifications.filter(n =>
                n.status === 'in_progress' &&
                n.workStarted &&
                (new Date() - new Date(n.workStarted)) > 600000 // 10 minutes
            );

            pendingTasks.forEach(task => {
                if (!task.aiAlerted) {
                    const aiAlert = {
                        type: 'warning',
                        message: `AI Alert: Task "${task.message}" has been pending for over 10 minutes`,
                        icon: '🤖',
                        priority: 'high',
                        category: 'ai_monitoring'
                    };
                    showLightAlert(aiAlert);

                    // Mark as AI alerted
                    task.aiAlerted = true;
                    localStorage.setItem('pgx_notifications', JSON.stringify(allNotifications));
                }
            });
        }

        // Initialize notification count from storage
        function initializeNotifications() {
            unreadNotifications = allNotifications.filter(n => n.status === 'unread').length;
            updateNotificationIndicator();
        }

        // Chart.js Implementation
        let regionalChart = null;
        let powerChart = null;

        function initializeCharts() {
            // Regional Performance Chart
            const regionalCtx = document.getElementById('regional-performance-chart').getContext('2d');

            const regionalData = {
                labels: ['Greater Accra', 'Ashanti', 'Western', 'Central', 'Northern', 'Eastern', 'Upper East', 'Upper West', 'Volta', 'Brong Ahafo'],
                datasets: [{
                    label: 'Energy Output (MW)',
                    data: [1200, 1000, 750, 650, 450, 520, 320, 280, 420, 380],
                    backgroundColor: [
                        '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6',
                        '#06b6d4', '#84cc16', '#f97316', '#ec4899', '#6366f1'
                    ],
                    borderColor: '#ffffff',
                    borderWidth: 2,
                    borderRadius: 8,
                    borderSkipped: false,
                }]
            };

            regionalChart = new Chart(regionalCtx, {
                type: 'bar',
                data: regionalData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: '#1f2937',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#3b82f6',
                            borderWidth: 1,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    return `${context.parsed.y} MW`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#e5e7eb',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    family: 'Inter'
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    family: 'Inter'
                                },
                                maxRotation: 45
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const region = regionalData.labels[index];
                            const value = regionalData.datasets[0].data[index];
                            showRegionalDetails(region, value);
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // View on Map Function
        function viewOnMap(equipmentName, gps) {
            const [lat, lng] = gps.split(', ').map(coord => parseFloat(coord.trim()));
            const url = `smart-grid.html?equipment=${encodeURIComponent(equipmentName)}&lat=${lat}&lng=${lng}&zoom=15`;
            window.open(url, '_blank');
        }

        // Chart Type Switching for Regional Performance
        function switchChartType(type) {
            const barBtn = document.getElementById('chart-type-bar');
            const lineBtn = document.getElementById('chart-type-line');

            if (type === 'bar') {
                regionalChart.config.type = 'bar';
                barBtn.classList.add('bg-pgx-blue', 'text-white');
                barBtn.classList.remove('bg-gray-200', 'text-gray-700');
                lineBtn.classList.add('bg-gray-200', 'text-gray-700');
                lineBtn.classList.remove('bg-pgx-blue', 'text-white');
            } else {
                regionalChart.config.type = 'line';
                regionalChart.data.datasets[0].backgroundColor = 'rgba(59, 130, 246, 0.1)';
                regionalChart.data.datasets[0].borderColor = '#3b82f6';
                regionalChart.data.datasets[0].fill = true;
                lineBtn.classList.add('bg-pgx-blue', 'text-white');
                lineBtn.classList.remove('bg-gray-200', 'text-gray-700');
                barBtn.classList.add('bg-gray-200', 'text-gray-700');
                barBtn.classList.remove('bg-pgx-blue', 'text-white');
            }
            regionalChart.update('active');
        }

        // Chart Type Switching for Power Generation
        function switchPowerChart(type) {
            const barChart = document.getElementById('power-bar-chart');
            const lineChart = document.getElementById('power-line-chart');
            const barBtn = document.getElementById('power-chart-bar');
            const lineBtn = document.getElementById('power-chart-line');

            if (type === 'bar') {
                barChart.classList.remove('hidden');
                lineChart.classList.add('hidden');
                barBtn.classList.add('bg-blue-500', 'text-white');
                barBtn.classList.remove('bg-gray-300', 'text-gray-700');
                lineBtn.classList.add('bg-gray-300', 'text-gray-700');
                lineBtn.classList.remove('bg-blue-500', 'text-white');
            } else {
                barChart.classList.add('hidden');
                lineChart.classList.remove('hidden');
                lineBtn.classList.add('bg-blue-500', 'text-white');
                lineBtn.classList.remove('bg-gray-300', 'text-gray-700');
                barBtn.classList.add('bg-gray-300', 'text-gray-700');
                barBtn.classList.remove('bg-blue-500', 'text-white');
                drawPowerLineChart();
            }
        }

        // Draw Line Chart for Regional Performance
        function drawLineChart() {
            const canvas = document.getElementById('line-chart-canvas');
            const ctx = canvas.getContext('2d');

            // Set canvas size
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;

            const data = [1200, 1000, 750, 650, 450, 520, 320, 280, 420, 380];
            const labels = ['Greater Accra', 'Ashanti', 'Western', 'Central', 'Northern', 'Eastern', 'Upper East', 'Upper West', 'Volta', 'Brong Ahafo'];

            const padding = 60;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            const maxValue = Math.max(...data);

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw grid lines
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
            }

            // Draw line
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            ctx.beginPath();

            data.forEach((value, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                const y = padding + chartHeight - (value / maxValue) * chartHeight;

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });

            ctx.stroke();

            // Draw points
            ctx.fillStyle = '#3b82f6';
            data.forEach((value, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                const y = padding + chartHeight - (value / maxValue) * chartHeight;

                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });

            // Draw labels
            ctx.fillStyle = '#6b7280';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';

            data.forEach((value, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                ctx.fillText(labels[index].split(' ')[0], x, canvas.height - 20);

                // Draw value labels
                const y = padding + chartHeight - (value / maxValue) * chartHeight;
                ctx.fillText(value + ' MW', x, y - 10);
            });

            // Draw Y-axis labels
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const value = (maxValue / 5) * (5 - i);
                const y = padding + (chartHeight / 5) * i;
                ctx.fillText(Math.round(value), padding - 10, y + 4);
            }
        }

        // Draw Line Chart for Power Generation
        function drawPowerLineChart() {
            const canvas = document.getElementById('power-line-canvas');
            const ctx = canvas.getContext('2d');

            // Set canvas size
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;

            const data = [1650, 1720, 1680, 1750, 1738];
            const labels = ['1h ago', '45m', '30m', '15m', 'Now'];

            const padding = 40;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            const maxValue = Math.max(...data) + 100;
            const minValue = Math.min(...data) - 100;

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw line
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 2;
            ctx.beginPath();

            data.forEach((value, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                const y = padding + chartHeight - ((value - minValue) / (maxValue - minValue)) * chartHeight;

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });

            ctx.stroke();

            // Draw points
            data.forEach((value, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                const y = padding + chartHeight - ((value - minValue) / (maxValue - minValue)) * chartHeight;

                ctx.fillStyle = index === data.length - 1 ? '#10b981' : '#3b82f6';
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, 2 * Math.PI);
                ctx.fill();
            });

            // Draw labels
            ctx.fillStyle = '#6b7280';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';

            data.forEach((value, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                ctx.fillText(labels[index], x, canvas.height - 5);
            });
        }

        // Regional Dashboard Data
        const regionalData = {
            'ashanti': {
                name: 'Ashanti Region',
                systemStatus: 'Operational',
                transformers: 77,
                criticalAlerts: 1,
                smartMeters: 14801,
                coverage: 85,
                onlineTransformers: 94,
                onlineCount: '72 of 77',
                smartNodes: 89,
                nodesCount: '156 of 175',
                meterConnectivity: 97,
                metersCount: '14,357 of 14,801',
                energyTracked: 2862.7,
                energyTheft: 12.5,
                smartPoles: 65,
                activeAlerts: 2,
                dataTransmission: 1.2,
                successRate: 99.8,
                avgLatency: 12,
                totalTransmission: 211
            },
            'greater-accra': {
                name: 'Greater Accra',
                systemStatus: 'Operational',
                transformers: 95,
                criticalAlerts: 0,
                smartMeters: 18500,
                coverage: 92,
                onlineTransformers: 98,
                onlineCount: '93 of 95',
                smartNodes: 94,
                nodesCount: '187 of 199',
                meterConnectivity: 99,
                metersCount: '18,315 of 18,500',
                energyTracked: 3456.2,
                energyTheft: 8.3,
                smartPoles: 89,
                activeAlerts: 1,
                dataTransmission: 1.8,
                successRate: 99.9,
                avgLatency: 8,
                totalTransmission: 298
            },
            'western': {
                name: 'Western Region',
                systemStatus: 'Operational',
                transformers: 62,
                criticalAlerts: 2,
                smartMeters: 11200,
                coverage: 78,
                onlineTransformers: 89,
                onlineCount: '55 of 62',
                smartNodes: 82,
                nodesCount: '124 of 151',
                meterConnectivity: 94,
                metersCount: '10,528 of 11,200',
                energyTracked: 2145.8,
                energyTheft: 15.7,
                smartPoles: 43,
                activeAlerts: 3,
                dataTransmission: 0.9,
                successRate: 99.2,
                avgLatency: 18,
                totalTransmission: 167
            }
            // Add more regions as needed
        };

        // Update Dashboard Based on Region
        function updateDashboardRegion() {
            const selector = document.getElementById('dashboard-region-selector');
            const region = selector.value;
            const data = regionalData[region] || regionalData['ashanti'];

            // Update System Overview
            const systemOverview = document.getElementById('system-overview');
            systemOverview.innerHTML = `
                <!-- System Status Card -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">System Status</p>
                            <p class="text-2xl font-bold text-green-600">${data.systemStatus}</p>
                            <p class="text-sm text-gray-500 mt-1">All systems running</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Active Transformers Card -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Active Transformers</p>
                            <p class="text-2xl font-bold text-gray-900">${data.transformers}</p>
                            <p class="text-sm ${data.criticalAlerts > 0 ? 'text-red-600' : 'text-green-600'} mt-1">
                                ${data.criticalAlerts} Critical Alert${data.criticalAlerts !== 1 ? 's' : ''}
                            </p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Smart Meters Card -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Smart Meters</p>
                            <p class="text-2xl font-bold text-gray-900">${data.smartMeters.toLocaleString()}</p>
                            <p class="text-sm text-green-600 mt-1">${data.coverage}% Coverage</p>
                        </div>
                        <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            `;

            // Update other sections with regional data
            updateSystemHealthForRegion(data);
            updateEnergyMetricsForRegion(data);
            updateNetworkDataForRegion(data);
        }

        // Update System Health for Region
        function updateSystemHealthForRegion(data) {
            // Update the system health percentages and counts
            const healthSection = document.querySelector('#system-health-content');
            if (healthSection) {
                healthSection.innerHTML = `
                    <div class="cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors" onclick="showSystemDetails('transformers')">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Online Transformers</span>
                            <span class="text-lg font-bold text-green-600">${data.onlineTransformers}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-green-500 h-2 rounded-full transition-all duration-300" style="width: ${data.onlineTransformers}%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">${data.onlineCount} transformers online</div>
                    </div>

                    <div class="cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors" onclick="showSystemDetails('nodes')">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Active Smart Nodes</span>
                            <span class="text-lg font-bold text-blue-600">${data.smartNodes}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: ${data.smartNodes}%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">${data.nodesCount} nodes active</div>
                    </div>

                    <div class="cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors" onclick="showSystemDetails('meters')">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Meter Connectivity</span>
                            <span class="text-lg font-bold text-purple-600">${data.meterConnectivity}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-purple-500 h-2 rounded-full transition-all duration-300" style="width: ${data.meterConnectivity}%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">${data.metersCount} meters connected</div>
                    </div>
                `;
            }
        }

        // Update Energy Metrics for Region
        function updateEnergyMetricsForRegion(data) {
            // Update energy tracking values
            const energyElements = {
                'total-energy': data.energyTracked,
                'energy-theft': data.energyTheft,
                'smart-poles': data.smartPoles,
                'active-alerts': data.activeAlerts
            };

            Object.keys(energyElements).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = energyElements[id];
                }
            });
        }

        // Update Network Data for Region
        function updateNetworkDataForRegion(data) {
            // Update additional network metrics
            const networkElements = {
                'data-transmission': data.dataTransmission,
                'success-rate': data.successRate,
                'avg-latency': data.avgLatency,
                'total-transmission': data.totalTransmission
            };

            Object.keys(networkElements).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = networkElements[id];
                }
            });
        }

        // Performance Details
        function showPerformanceDetails(type) {
            let title, description, metrics;

            if (type === 'grid') {
                title = 'Grid Performance - 75%';
                description = 'Load balancing and distribution efficiency';
                metrics = [
                    { name: 'Load Balancing', value: '82%', status: 'Good' },
                    { name: 'Distribution Efficiency', value: '78%', status: 'Moderate' },
                    { name: 'Peak Load Management', value: '71%', status: 'Needs Improvement' },
                    { name: 'Grid Stability', value: '85%', status: 'Excellent' }
                ];
            } else if (type === 'efficiency') {
                title = 'System Efficiency - 88%';
                description = 'Energy transmission and conversion efficiency';
                metrics = [
                    { name: 'Transmission Efficiency', value: '92%', status: 'Excellent' },
                    { name: 'Conversion Efficiency', value: '89%', status: 'Good' },
                    { name: 'Power Factor', value: '0.95', status: 'Excellent' },
                    { name: 'Line Losses', value: '3.2%', status: 'Good' }
                ];
            } else {
                title = 'System Reliability - 94%';
                description = 'System uptime and fault tolerance';
                metrics = [
                    { name: 'System Uptime', value: '99.2%', status: 'Excellent' },
                    { name: 'Fault Recovery Time', value: '2.3 min', status: 'Good' },
                    { name: 'Redundancy Level', value: '87%', status: 'Good' },
                    { name: 'Maintenance Schedule', value: '96%', status: 'Excellent' }
                ];
            }

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">${title}</h3>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>

                        <p class="text-sm text-gray-600 mb-4">${description}</p>

                        <div class="space-y-3">
                            ${metrics.map(metric => `
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <div class="font-medium text-gray-900">${metric.name}</div>
                                        <div class="text-sm text-gray-600">${metric.status}</div>
                                    </div>
                                    <div class="text-lg font-bold text-blue-600">${metric.value}</div>
                                </div>
                            `).join('')}
                        </div>

                        <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                            <div class="text-sm text-blue-800">
                                <strong>Measurement Method:</strong> Real-time monitoring through LoRaWAN sensors,
                                SCADA systems, and smart meter data aggregation with 5-minute interval updates.
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            window.currentModal = modal;
        }

        // Network Coverage Update
        function updateNetworkCoverage() {
            const selector = document.getElementById('region-selector');
            const content = document.getElementById('network-coverage-content');
            const region = selector.value;

            const coverageData = {
                'ashanti': { name: 'Ashanti Region', overall: 94, urban: 98, rural: 87, periUrban: 92 },
                'greater-accra': { name: 'Greater Accra', overall: 97, urban: 99, rural: 92, periUrban: 96 },
                'western': { name: 'Western Region', overall: 89, urban: 95, rural: 78, periUrban: 88 },
                'central': { name: 'Central Region', overall: 91, urban: 96, rural: 82, periUrban: 90 },
                'northern': { name: 'Northern Region', overall: 76, urban: 89, rural: 65, periUrban: 78 },
                'eastern': { name: 'Eastern Region', overall: 88, urban: 94, rural: 79, periUrban: 87 },
                'upper-east': { name: 'Upper East', overall: 72, urban: 85, rural: 58, periUrban: 74 },
                'upper-west': { name: 'Upper West', overall: 69, urban: 82, rural: 55, periUrban: 71 },
                'volta': { name: 'Volta Region', overall: 84, urban: 91, rural: 73, periUrban: 83 },
                'brong-ahafo': { name: 'Brong Ahafo', overall: 81, urban: 88, rural: 70, periUrban: 80 }
            };

            const data = coverageData[region];

            content.innerHTML = `
                <div class="text-center mb-6">
                    <div class="text-3xl font-bold text-gray-900">${data.overall}%</div>
                    <div class="text-sm text-gray-500">${data.name}</div>
                </div>

                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-700">Urban</span>
                        <span class="text-lg font-bold text-green-600">${data.urban}%</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-700">Rural</span>
                        <span class="text-lg font-bold text-yellow-600">${data.rural}%</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-700">Peri-Urban</span>
                        <span class="text-lg font-bold text-blue-600">${data.periUrban}%</span>
                    </div>
                </div>
            `;
        }

        // Infrastructure Details
        function showInfrastructureDetails(type) {
            let title, data;

            if (type === 'base-stations') {
                title = 'LoRaWAN Base Stations';
                data = [
                    { name: 'BS-001', district: 'Kumasi Metropolitan', gps: '6.6885, -1.6244', geocode: 'AK-001-001', lastMaintenance: '2024-07-15', contractors: [{ name: 'Kwame Asante', id: 'PGX-005' }, { name: 'Ama Osei', id: 'PGX-006' }] },
                    { name: 'BS-002', district: 'Obuasi Municipal', gps: '6.2027, -1.6634', geocode: 'AK-002-001', lastMaintenance: '2024-07-20', contractors: [{ name: 'Mike Johnson', id: 'PGX-003' }] },
                    { name: 'BS-003', district: 'Ejisu Municipal', gps: '6.7394, -1.3692', geocode: 'AK-003-001', lastMaintenance: '2024-07-10', contractors: [{ name: 'Sarah Wilson', id: 'PGX-004' }] },
                    { name: 'BS-004', district: 'Bosomtwe', gps: '6.5833, -1.4167', geocode: 'AK-004-001', lastMaintenance: '2024-07-25', contractors: [{ name: 'John Doe', id: 'PGX-001' }] },
                    { name: 'BS-005', district: 'Asante Akim North', gps: '6.8167, -1.0833', geocode: 'AK-005-001', lastMaintenance: '2024-07-18', contractors: [{ name: 'Jane Smith', id: 'PGX-002' }] }
                ];
            } else if (type === 'smart-meters') {
                title = 'Smart Meters (LoRa-enabled)';
                data = [
                    { name: 'SM-ZONE-001', district: 'Kumasi Metropolitan', gps: '6.6885, -1.6244', geocode: 'AK-SM-001', lastMaintenance: '2024-07-22', contractors: [{ name: 'Kwame Asante', id: 'PGX-005' }] },
                    { name: 'SM-ZONE-002', district: 'Obuasi Municipal', gps: '6.2027, -1.6634', geocode: 'AK-SM-002', lastMaintenance: '2024-07-19', contractors: [{ name: 'Ama Osei', id: 'PGX-006' }] },
                    { name: 'SM-ZONE-003', district: 'Ejisu Municipal', gps: '6.7394, -1.3692', geocode: 'AK-SM-003', lastMaintenance: '2024-07-16', contractors: [{ name: 'Mike Johnson', id: 'PGX-003' }] },
                    { name: 'SM-ZONE-004', district: 'Bosomtwe', gps: '6.5833, -1.4167', geocode: 'AK-SM-004', lastMaintenance: '2024-07-21', contractors: [{ name: 'Sarah Wilson', id: 'PGX-004' }] }
                ];
            } else if (type === 'transformers') {
                title = 'Monitored Transformers (LoRa sensors)';
                data = [
                    { name: 'TXF-001', district: 'Kumasi Metropolitan', gps: '6.6885, -1.6244', geocode: 'AK-TXF-001', lastMaintenance: '2024-07-14', contractors: [{ name: 'John Doe', id: 'PGX-001' }, { name: 'Jane Smith', id: 'PGX-002' }] },
                    { name: 'TXF-002', district: 'Obuasi Municipal', gps: '6.2027, -1.6634', geocode: 'AK-TXF-002', lastMaintenance: '2024-07-17', contractors: [{ name: 'Kwame Asante', id: 'PGX-005' }] },
                    { name: 'TXF-003', district: 'Ejisu Municipal', gps: '6.7394, -1.3692', geocode: 'AK-TXF-003', lastMaintenance: '2024-07-23', contractors: [{ name: 'Ama Osei', id: 'PGX-006' }] }
                ];
            } else {
                title = 'Integrated Telecom Towers';
                data = [
                    { name: 'MTN-001', district: 'Kumasi Metropolitan', gps: '6.6885, -1.6244', geocode: 'AK-MTN-001', lastMaintenance: '2024-07-12', contractors: [{ name: 'Mike Johnson', id: 'PGX-003' }] },
                    { name: 'VOD-001', district: 'Obuasi Municipal', gps: '6.2027, -1.6634', geocode: 'AK-VOD-001', lastMaintenance: '2024-07-20', contractors: [{ name: 'Sarah Wilson', id: 'PGX-004' }] },
                    { name: 'ATL-001', district: 'Ejisu Municipal', gps: '6.7394, -1.3692', geocode: 'AK-ATL-001', lastMaintenance: '2024-07-15', contractors: [{ name: 'Kwame Asante', id: 'PGX-005' }] }
                ];
            }

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">${title}</h3>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="p-6 overflow-y-auto max-h-[60vh]">
                        <div class="grid gap-4">
                            ${data.map(item => `
                                <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                                    <div class="flex items-center justify-between mb-3">
                                        <h4 class="font-medium text-gray-900">${item.name}</h4>
                                        <div class="flex space-x-2">
                                            <button onclick="viewOnMap('${item.name}', '${item.gps}')"
                                                    class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                                View on Map
                                            </button>
                                            <button onclick="showContractors('${item.name}', ${JSON.stringify(item.contractors).replace(/"/g, '&quot;')})"
                                                    class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                                View Contractors
                                            </button>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3">
                                        <div><span class="font-medium">District:</span> ${item.district}</div>
                                        <div><span class="font-medium">GPS:</span> ${item.gps}</div>
                                        <div><span class="font-medium">Geocode:</span> ${item.geocode}</div>
                                        <div><span class="font-medium">Last Maintenance:</span> ${item.lastMaintenance}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            window.currentModal = modal;
        }

        // Show Contractors
        function showContractors(equipmentName, contractors) {
            // Close any existing modal first
            if (window.currentModal) {
                document.body.removeChild(window.currentModal);
                window.currentModal = null;
            }

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Contractors - ${equipmentName}</h3>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>

                        <div class="space-y-3">
                            ${contractors.map(contractor => `
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <div class="font-medium text-gray-900">${contractor.name}</div>
                                        <div class="text-sm text-gray-600">ID: ${contractor.id}</div>
                                    </div>
                                    <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-sm">
                                        ${contractor.name.split(' ').map(n => n[0]).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            window.currentModal = modal;
        }

        // AI Predictions Modal
        function showAIPredictions() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">🤖 AI Predictions & Anomaly Detection</h3>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="p-6 overflow-y-auto max-h-[60vh]">
                        <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                            <h4 class="font-medium text-blue-900 mb-2">AI Integration Status</h4>
                            <p class="text-sm text-blue-800">
                                AI predictions will be activated based on data availability and deployment scale.
                                We begin with AI anomaly detection and SMS triage tools in the pilot phase.
                            </p>
                        </div>

                        <div class="space-y-4">
                            <div class="border border-green-200 rounded-lg p-4 bg-green-50">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-medium text-green-900">AI Anomaly Detection</h4>
                                    <span class="text-xs bg-green-200 text-green-800 px-2 py-1 rounded">Ready for Pilot</span>
                                </div>
                                <p class="text-sm text-green-800 mb-3">
                                    AI-powered anomaly detection to flag possible theft or faults automatically.
                                </p>
                                <div class="text-xs text-green-700">
                                    <strong>Features:</strong> Real-time pattern analysis, theft detection algorithms,
                                    fault prediction models, automated alert generation.
                                </div>
                            </div>

                            <div class="border border-blue-200 rounded-lg p-4 bg-blue-50">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-medium text-blue-900">SMS Triage Tool</h4>
                                    <span class="text-xs bg-blue-200 text-blue-800 px-2 py-1 rounded">Ready for Pilot</span>
                                </div>
                                <p class="text-sm text-blue-800 mb-3">
                                    Intelligent SMS classification and response system for customer fault reports.
                                </p>
                                <div class="text-xs text-blue-700">
                                    <strong>Features:</strong> Natural language processing, automatic categorization,
                                    priority assignment, response templates, escalation rules.
                                </div>
                            </div>

                            <div class="border border-yellow-200 rounded-lg p-4 bg-yellow-50">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-medium text-yellow-900">Predictive Maintenance</h4>
                                    <span class="text-xs bg-yellow-200 text-yellow-800 px-2 py-1 rounded">Phase 2</span>
                                </div>
                                <p class="text-sm text-yellow-800 mb-3">
                                    Machine learning models for equipment failure prediction and maintenance scheduling.
                                </p>
                                <div class="text-xs text-yellow-700">
                                    <strong>Planned Features:</strong> Equipment health scoring, failure probability,
                                    optimal maintenance windows, cost optimization.
                                </div>
                            </div>

                            <div class="border border-purple-200 rounded-lg p-4 bg-purple-50">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-medium text-purple-900">Load Forecasting</h4>
                                    <span class="text-xs bg-purple-200 text-purple-800 px-2 py-1 rounded">Phase 3</span>
                                </div>
                                <p class="text-sm text-purple-800 mb-3">
                                    Advanced AI models for energy demand prediction and grid optimization.
                                </p>
                                <div class="text-xs text-purple-700">
                                    <strong>Planned Features:</strong> Weather-based forecasting, seasonal patterns,
                                    economic indicators, demand response optimization.
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-medium text-gray-900 mb-2">Current Active Alerts</h4>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-red-600">⚠️ Transformer TXF-003 - Unusual load pattern detected</span>
                                    <span class="text-xs text-gray-500">2 min ago</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-yellow-600">🔍 Smart Meter Zone SM-007 - Potential theft indicator</span>
                                    <span class="text-xs text-gray-500">15 min ago</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            window.currentModal = modal;
        }

        // Live Power Generation Update
        function updateLivePowerGeneration() {
            const powerElement = document.getElementById('live-power-generation');
            const bars = ['power-bar-1', 'power-bar-2', 'power-bar-3', 'power-bar-4', 'power-bar-5'];

            // Generate random power value between 1500-2000 kW
            const newPower = Math.floor(Math.random() * 500) + 1500;
            powerElement.textContent = newPower.toLocaleString();

            // Update bars with animation
            bars.forEach((barId, index) => {
                const bar = document.getElementById(barId);
                const height = Math.floor(Math.random() * 40) + 50; // 50-90%
                bar.style.height = height + '%';
            });
        }

        // Update countdown timer
        function updateCountdown() {
            const timerElement = document.getElementById('next-update-time');
            if (!timerElement) return;

            let minutes = 59;
            let seconds = 59;

            setInterval(() => {
                seconds--;
                if (seconds < 0) {
                    seconds = 59;
                    minutes--;
                    if (minutes < 0) {
                        minutes = 59;
                        updateLivePowerGeneration();
                    }
                }
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // Initialize live updates
        document.addEventListener('DOMContentLoaded', function() {
            updateCountdown();
            updateDashboardRegion(); // Load default region data
            initializeCharts(); // Initialize Chart.js charts
            initializeNotifications(); // Initialize notification system
            startNotificationSystem(); // Start live notifications

            // Update power generation every hour (3600000 ms)
            setInterval(updateLivePowerGeneration, 3600000);

            // Add loading states
            document.querySelectorAll('.metric-card').forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
                card.classList.add('slide-up');
            });
        });
    </script>
</body>
</html>
